Quantifying lymphocyte receptor diversity
1 Laboratoire de physique statistique CNRS UPMC and Ecole normale superieure 24 rue Lhomond Paris France and
2 Laboratoire de physique theorique CNRS UPMC and Ecole normale superieure 24 rue Lhomond Paris France
Thierry Mora1 Aleksandra M Walczak2
To recognize pathogens B and T lymphocytes are endowed with a wide repertoire of receptors
generated stochastically by VDJ recombination Measuring and estimating the diversity of these
receptors is of great importance for understanding adaptive immunity In this chapter we review
recent modeling approaches for analyzing receptor diversity from high-throughput sequencing data
We rst clarify the various existing notions of diversity with its many competing mathematical
indices and the dierent biological levels at which it can be evaluated We then describe inference
methods for characterizing the statistical diversity of receptors at dierent stages of their history
generation selection and somatic evolution We discuss the intrinsic diculty of estimating the
diversity of receptors realized in a given individual from incomplete samples Finally we emphasize
the limitations of diversity dened at the level of receptor sequences and advocate the more relevant
notion of functional diversity relative to the set of recognized antigens
INTRODUCTION
To protect its host against pathogens the adaptive im-
mune system of jawed vertebrates expresses a large reper-
toire of distinct receptors on its B- and T lymphocytes
These receptors must recognize a wide range of pathogens
to trigger the response of the adaptive immune system
Since each receptor is specialized in recognizing specic
pathogens a very diverse repertoire of receptors is re-
quired to cover all possible threats While one can now
sequence the repertoires of individuals with some depth
it remains unclear how to quantify or even dene their
diversity and what aspects of this diversity are relevant
for recognition These fundamental questions are further
obscured by the purely technical but important issue of
reliably sampling immune repertoires
The actual number of lymphocytes varies from species
to species but in all cases is large Estimates of the num-
ber of T cells in humans are of the order of 3  1011 cells
1 Each cell expresses only one type of receptor Cells
proliferate and form clones so that many distinct cells
may share a common receptor As we will discuss further
the number of unique distinct receptors is very hard to
estimate However even a conservative lower bound of
106 unique receptors 2 3 is much larger than the total
number of genes in the human genome  20 000 This
broad diversity of receptors is not hard-coded but is in-
stead generated by a unique gene rearrangement process
that couples a combinatoric choice of genomic templates
with additional randomness
Each receptor is made up of two arms B-cell recep-
tors BCR have a light and a heavy chains while T-cell
receptors TCR have analogous  and  chains Each
chain is composed of three segments called V D and J in
the case of heavy or  chains and two segments V and J
in the case of light or  chains These segments are com-
binatorically picked out of several genomic templates for
each type in a process called VDJ recombination 4 as
schematized in Fig 1A This recombination is achieved
by looping DNA and excising the template genes that lie
between the selected gene segments In the case of heavy
or  chains the D-J junction is assembled rst followed
by the V-D junction The precise number of templates
for each segment diers from species to species but gen-
erally results in a combinatoric diversity of  1000 for
each chain This combinatoric assortment is followed by
stochastic nucleotide deletions and insertions at the junc-
tions between the newly assorted V-D and D-J fragments
or V-J fragment for the shorter chain forming what is
termed junctional diversity This stochastic step largely
increases the repertoire diversity as we will show in de-
tail As a result of this procedure the receptor DNA
may be out-of-frame or the encoded protein may not be
functional or correctly folded The newly assembled 
chain sequences then are tested with a surrogate  chain
for their binding and expression properties If they pass
this selection step the second chain is assembled and
the whole receptor undergoes a similar round of selection
against proteins that are natural to the organism or self
proteins Receptors that do not bind any self-protein or
bind too strongly to self-proteins are discarded If a re-
ceptor fails these tests the cell may attempt to recombine
its second chromosome
The processes of recombination and selection are
stochastic and therefore are characterized by their own
intrinsic diversity which we may view as a statistical or
potential diversity It is distinct from the diversity real-
ized in a given individual at a given time with its nite
number of recombined receptors much like the potential
diversity of the English language is distinct from  and
much larger than  the diversity of texts found in a sin-
gle library While most previous discussions with the
expection of 5 have focused on the realized rather than
potential diversity of receptors in this chapter we will
discuss both
After generation and selection B- and T cells feed the
naive repertoire where they attempt to recognize foreign
antigens Fig 1B The dynamics of lymphocytes vary
widely between B and T cells as well as between species
However a common feature is that cells whose receptors
successfully bind to antigens proliferate producing either
identical ospring T-cells or that dier by somatic point
hypermutations B-cells A fraction of the cells that
have undergone proliferation are kept in what is called
the memory repertoire while cells that have not received
a proliferation signal stay in the naive repertoire Cells
that share a common receptor or clonotype dene a
clone The clonal structure of the lymphocyte repertoire
is one of the characteristics of repertoire diversity
The diversity of lymphocyte receptors can be studied
with the help of repertoire high-throughput sequencing
experiments 2 68 which have been developing rapidly
over the last few years 914 These experiments focus
on the region of the chain that encompasses the junc-
tions between the recombined segments allowing for the
complete identication of the receptor chain This re-
gion includes the Complementarity Determining Region
3 CDR3 dened from roughly the end of the V segment
to the beginning of the J segment which is believed to
play an important role in recognition Because sequence
reads can only cover one of the two chains making up the
receptor most studies have focused on the diversity of
one chain at a time However new techniques make it
possible to pair the two chains together 1517 opening
the way for the analysis of repertoires of complete recep-
tors In general a tissue blood lymph node thymus
germinal center etc sample is taken and the mRNA
or DNA of the lymphocytes of interest are sorted out
Dierent technologies have been developed for DNA and
mRNA Data are usually clustered and error-corrected
for PCR and sequencing errors 18 Many recent ex-
periments use unique molecular barcodes associated to
each initial mRNA molecule which help correct for PCR
amplication noise 1921 and allow for the direct mea-
surement of relative clone sizes using sequence counts
Unless an error occurred in the rst round of PCR bar-
codes can reliably pick up even very rare sequences as
long as they are present in the sample These experi-
ments result in a list of unique receptor chain sequences
and if the data was barcoded of reliable counts for the
corresponding number of RNA molecules in the initial
sample This information is the staring point for the
analysis of repertoire diversity
In this chapter we discuss approaches for estimating
repertoire diversity from the datasets generated by these
new technologies We rst review and discuss the dif-
ferent denitions of diversity  species richness entropy
and other diversity indices  and their relation to the
distribution of clonotype frequencies We also emphasize
the need to distinguish the dierent levels at which di-
versity may be evaluated recombination diversity post-
selection potential diversity actual diversity realized in
a particular individual in a particular tissue or with a
particular phenotype etc We review recent eorts to
calculate accurately the diversity of receptors generated
by VDJ recombination using high-throughput sequenc-
ing data We discuss the challenges of estimating diver-
sity when the clonal structure is scale-free as is generi-
cally the case in many reported cases We conclude by
FIG 1 A VDJ recombination of T- and B cell receptors
TCR and BCR TCRs and BCRs are made of two chains
one shorter and one longer called the  and  chains for
TCRs and the light and heavy chains for BCRs Each chain
is obtained by a gene rearrangement process called VDJ re-
combination by which two for the shorter chain or three
for the longer chain segments are assembled together from
palettes of templates encoded in the genome At each of the
junction between these segments further diversity is added by
stochastic deletions and insertions of random non-templated
nucleotides B Evolution of repertoires of TCR and BCR
After their generation by VDJ recombination receptors rst
pass a selection process called thymic selection for TCRs
whereby nonfunctional and self-reactive receptors are dis-
carded They are then released into the periphery where they
may divide die proliferate and dierentiate as a function of
the signals they receive from antigens or other immune cells
In addition BCRs are subject to somatic hypermutations as
B cells mature in germinal centers following an infection
discussing the importance of sequence diversity and con-
trast it with more biologically relevant but elusive notion
of functional diversity
II A FAMILY OF DIVERSITY MEASURES
A number of dierent diversity measures have been
proposed to quantify the vastness of lymphocyte reper-
VDJV1392V1D51J2J5D2DJV923random insertionsDJV923deletionsVJV1852V1J2J5JV373random insertionsJV372deletionsheavy or beta chainlight or alpha chainBCR or TCRVDJrecombinationthymicselectionor equivalentperipheralselectiongenerationdiversityfunctionaldiversityactualdiversityanitymaturationBcellssomatichypermutationsA VDJ recombinationB Diversities at different levels of repertoire maturation3
toires 2224 the Shannon entropy 25 the Simpson in-
dex 26 and most commonly the total number of clono-
types or species richness 2 3 2729 These diversity
measures are taken from ecology where they are used to
quantify the diversity of species They are all related to a
generalized family of diversity measures called the Renyi
entropy 30 parametrized by  and dened as
cid35
cid34cid88
1  
where ps is the probability frequency or abundance of
a given receptor sequence or clonotype s For   1 we
recover Shannons entropy
H1  cid88
ps ln ps
The exponential of the Renyi entropy denes a general-
ized class of diversity indices called Hill diversities 31
D  expH
of Simpsons diversity index D2  1cid80
This index can be interpreted as an eective number of
clonotypes in the data For   1 it is simply the ex-
ponential of Shannons entropy and we will refer to it as
Shannons diversity For   2 it reduces to the inverse
s ps2 The
Simpson index gives the probability that two sequences
drawn at random from the distribution are identical and
is related to a common measure of inequality the Gini-
Simpson index dened as 1  1D2 D0 is the species
richness while D  1 maxs ps is the inverse of the
Berger-Parker index
Each of these diversity indices is a summary statis-
tics of the information contained in the distribution of
clonotype frequencies ie the distribution of values of
ps themselves This frequency distribution may in fact
be viewed as the most complete description of the diver-
sity of the repertoire Conversely the whole spectrum
of Renyi entropies H is sucient to reconstruct the full
clonotype frequency distribution
In other words the
functions H D and the distribution of frequencies
carry the exact same information 32 The choice of
a single diversity measure D rather than the full fre-
quency distribution is often useful to make comparisons
between individuals tissues experiments etc When  is
large enough it may also be less sensitive to experimental
noise than the frequency distribution
It is possible to get a rough estimate of Hill diversi-
ties by simple inspection of the frequency distribution
represented as a rank-frequency graph with a double log-
arithmic scale 32 A simple geometric construction il-
lustrated by Fig 2 helps understand the meaning of the
various indices what properties of the underlying cumu-
lative clone size distribution they are most likely to cap-
ture and where one should stop trusting them because
of insucient sampling The intersection of the the tan-
gents of slope 1 and 1 to the rank-frequency curve
cid80
FIG 2 Geometric construction of Hill diversities from a
rank-frequency curve The Hill diversity of order  D 
s ps11 can be approximated from the intersection
between the tangents of slope -1 and 1 D0 is the total
number of types or species richness D1 is the exponential of
Shannons entropy and D2 is the inverse of Simpsons diver-
sity index
gives the Hill diversity index D This construction em-
phasizes the fact that dierent diversity measures focus
on sequences of various frequencies large values of  tend
to favor very common clonotypes while low values favor
rare ones Geometrically tangents of small slopes large
 eg Simpsons index or Shannons entropy osculate
the rank-frequency curve at high frequencies while large
slopes do so at low frequencies Thus diversity indices
D with a small  rely very strongly on correclty cap-
turing the tail of rare clonotypes This is particularly
true for D0 the species richness which is very hard to
estimate as it requires to estimate the number of un-
seen clonotypes This observation warns us against the
pitfalls of estimating diversity when dealing with incom-
plete samples The larger the  the more reliable the Hill
index D should be In general estimates of the species
richness D0 should be taken with extreme caution as we
will further discuss in concrete examples
III QUANTIFYING VDJ RECOMBINATION
The repertoire is a dynamic ensemble of receptors that
evolves somatically As the repertoire is shaped its diver-
sity changes signicantly Repertoires at dierent func-
tional stages from generation to memory show dierent
levels of potential and realized diversity By analyzing
unique receptors from high-throughput sequencing data
one can track these changes We start by decribing the
diversity of the initial stochastic recombination of recep-
Each cell has two sets of chromosomes
If the rst
VDJ rearrangement results in a non-functional recep-
rank100101010201030frequency10-3510-3010-2510-2010-1510-1010-5100slope1D0slope1D1slope112D2tor the second one recombines 33 When this sec-
ond rearrangement is successful the cell expresses the
functional receptor but keeps the rearranged nonfunc-
tional DNA This nonfunctional receptor is expressed at
a basal leaky level despite allelic exclusion especially
for  chains and may also be captured by genomic DNA
sequencing These out-of-frame receptors oer unique in-
sight into the raw generation process because they were
never selected for as they owe their survival to the gene
expressed from the other chromosome We can therefore
use these sequences to gain insight into the generation
process and analyze the potential diversity of recombi-
nation ie the statistics of unique receptors that can
ever be formed as a result of VDJ recombination As
already noted this diversity of the generation process
should not be confused with the actually realized diver-
sity in a given individual which is generically smaller
As the numbers will show the recombination proba-
bility of each generated sequence is so small that it is
hopeless to sample their distribution by simply counting
how often we observe them Besides this counting num-
ber is not expected to reect the frequency of generation
alone because of lymphocyte population dynamics As
we pointed out cell proliferation is independent of the
identity of the out-of-frame sequence of interest and in
the limit of innite data should not in principle aect
such an estimate However for any dataset coming from
a single individual these heterogeneities in the clone size
completely dominate the sequence counts For this rea-
son it is suitable to count each unique sequence only
once to remove these possible biases Starting with a
dataset of unique realizations of the recombination pro-
cess we need a model to describe their probability dis-
tribution This model is based on what we know about
the recombination process choice of VDJ segments
stochastic number of deletions of each gene segments
stochastic number and identities of inserted nucleotides
at each junction Thus taking the simpler case of  or
light chains the probability of a given recombination sce-
nario r can be written as
Prearrr  P V JP delV V P delJJP ins
where delV and delJ denote the number of deletions at
the V and J ends and ins is the list of inserted nu-
cleotides A very similar expression accounting for three
genes and two junctions can be written for the  or heavy
chains The form of the model is motivated by biophysi-
cal considerations the number of deletions of the J end
does not depend on the choice of the V segment the num-
ber and identities of insertions does not depend on the
gene choice and follows a Markov chain These assump-
tions however should and can be checked consistently
by verifying that no correlations in the data remains un-
accounted for by the model 34
The parameters of the generation model 4 cannot be
directly read o the sequences because it is impossible in
general to assign with certainty a recombination scenario
to a given sequence as many distinct scenarios can lead
to the same sequence through convergent recombination
35 As we will quantify below this eect is very signif-
icant and cannot be ignored Importantly it forces us to
think of scenarios or sequence annotation in a probabilis-
tic manner rather than try to select the most probable
one as is often done in annotation software 3638 The
generation parameters can be inferred using a standard
implementation of the Expectation-Maximization algo-
rithm an iterative procedure that maximizes the like-
lihood of the data The algorithm works by collecting
summary statistics about the elements of the recombina-
tion scenarios to build the model distribution 4 The
recombination scenarios are themselves assigned proba-
bilistically using the previous iteration of the model The
algorithm which relies on the enumeration of all plausi-
ble scenarios giving rise to each sequence is computa-
tionnally heavy but can be signicantly sped up after
mapping the problem onto a hidden Markov model and
using standard dynamic programming tools 39
Once a recombination model such as Eq 4 has been in-
ferred it can be used to generate and analyse sequences
with the same statistical properties as the original data
It can also be used to quantity the various types of di-
versity indices discussed in the previous section Note
that because of convergent recombination the diversity
of generated sequences is expected to be smaller than the
diversity of the scenarios that produce them The gen-
eration probability of a sequence s is given by the sum
of the probabilities of all scenarios that could have given
rise to this sequence
cid88
Pgens 
Prearrr
The diversity measures calculated from Pgen and Prearr
are therefore distinct
Recombination models have been inferred for T cell 
34 and  39 chains as well as for B cell heavy chains
In all these cases the distributions inferred from
dierent individuals were found to be surprisingly simi-
lar with some variability in the gene segment usage but
very reproducible deletion and insertion proles consis-
tent with a common biophysical mechanism of enzyme
function The entropy H1 of sequences and recombina-
tion scenarios obtained from these models are reported
in Fig 3A Because the distribution of scenarios 4 is
a product of its various elements gene choice deletions
insertions its entropy can also be broken up into their
respective contributions The entropy dierence between
recombination events in purple and sequences in red
is the entropy of convergent recombination in gray
which quanties the diversity of scenarios resulting in
the same sequence For example it is 5 bits for TCR 
chains corresponding to a fairly large Shannon diversity
number D1  30 Note that the total number of possible
scenarios for a given sequence D0 is much larger but its
precise denition depends on the cuto we impose on the
possible number of deletions and insertions
Diversity in the heavy chain of B-cells is larger than
FIG 3 Entropies and diversity indices of the receptor generation and selection process A Entropy of the VDJ recombination
process in TCR  and  chains and in BCR heavy chains The entropy of recombination events purple can be decomposed
into contributions for the choice of the VDJ genes blue the number and identity of insertions yellow and deletions light
green The sequence entropy red is slightly smaller than the recombination entropy because several recombination events
can lead to the same sequence convergent recombination in gray Following thymic selection or the B-cell counterpart the
entropy is further reduced green B Rank-frequency curves of TCR  chain sequences upon generation red and following
thymic selection green C Hill diversities for the same statistical ensembles The Shannon diversity D1 is the exponential
of the entropies shown in black boxes in A
that of T-cells This dierence can be attributed to
longer CDR3 regions due to many more insertions at
the junctions between the genes The receptor genera-
tion process is characterized by an entropy of  70 bits
for BCR heavy chains and  43 bits for TCR  chains
These numbers correspond to a Shannon diversity index
D1  1021 and  1014 respectively
Although most studies have focused on the Shannon
diversity index D1 the full diversity spectrum of the gen-
eration process can be calculated In Fig 3B we show
the rank-frequency curve of human TCR  chains taken
from Ref 32 based on the model of Ref 34 As ex-
plained in the previous section the full range of diversity
indices D can be calculated from that curve and are
shown in Fig 3C In addition to the Shannon diversity
D1 already discussed of special interest is the inverse
of the Simpson index D2 The Simpson index corre-
sponds to the probability that the same nucleotide se-
quence is obtained from two independent draws It gives
the expected number of shared sequences between two
individuals normalized by the product of their reper-
toire sizes assuming that their receptor sequences were
generated independently from the same source Thus
it is deeply linked to the notion of public sequences
found in several individuals and making up the public
repertoire 26 35 41 This number estimated to be
1D2  3  1010 for human TCR  chains from the
model is in fact very close to that measured in the data
for out-of-frame sequences 34
It is important to stress that however large these
numbers are not the total number of possible receptor
sequences D0 which is much larger As we can see from
the rank-frequency plot of generated TCR  chain se-
quences Fig 3B red generation probabilities span over
20 orders of magnitude The largest rank of  1030 is
in fact a lower bound to D0 limited by the nite sam-
pling of sequences by the model To better estimate D0
one may count the total number of possible deletion pro-
les reported for each gene and multiply that number
by the total number of possible insertion proles of at
most Lmax nucleotides 4Lmax13 for each of the two
junctions Doing so with Lmax  26 the largest number
of insertions reported in 34 yields an upper bound of
D0  2  1039 for the TCR  chain alone However be-
cause this estimate is very sensitive to the value of Lmax
which is not precisely known and may depend on the
115225DiversityD106108101010121014101610181020Recombination Events 52 bitsNucleotide Sequence 47 bitsConvergentRecombVDJ 9 bitsDeletions 13 bitsDJ ntsVD insertions 15 bitsDJ insertions 15 bitsPost-selection 38 bitsRecombination Events 32 bitsNucleotide Sequence 30 bitsVJ 11 bitsInsertions 15 bitsDel 6 bitsPost-selection 26 bitsT-cell receptor alpha chainbeta chainRecombination Events 74 bitsNucleotide Sequence 70 bitsVDJ 11 bitsDeletions 14 bitsVD insertions 245 bitsDJ insertions 245 bitsPost-selection 57 bitsB-cell receptor heavy chainABpost-selectiongenerationexpentropy1  Simpsonrank100101010201030frequency10-3510-3010-2510-2010-1510-1010-5CTCR beta chainTCR beta chainsample size it must be taken with some caution
take the factorized form
Lcid89
qiLai
The above estimates only include heavy or  chains
Coupling this chain with the light or  chain adds further
diversity Since the shorter  and light chains have only
one junctional region between the V and J genes their
diversity is much lower For example TCR  chains
were estimated to have a generation Shannon entropy
of H1  30 bits or D1  109 39 The part of the
entropy that is attributable to the gene choice is similar
to that reported for the  chain of the order of 10 bits
While that contribution was only a small fraction of the
overall diversity for the  chain it is comparable to that
of insertions for the  chain The number of possible
 chain sequences can be estimated similarly to the 
chain yielding D0  5  1021
Assuming that the two chain rearrangements are in-
dependent the overall diversity of the pool from which
TCRs are generated is about H1  75 bits or D1  1023
and a total potential repertoire of size D0  1061 Note
that this last estimate is much larger than the classically
quoted number of 1015 from 42 which assumed a much
more restricted junctional diversity Analysis of recently
published - sequence pairings should allow for more
precise estimates of these diversity numbers for TCRs
17 and BCRs 15
All these diversity numbers are very large Clearly a
single individual is only able to sample a tiny fraction
of the potential pool of receptor sequences with a total
T-cells count of  3  1011 in humans 1
IV THYMIC SELECTION AND
HYPERMUTATIONS
After sequences have been generated by VDJ recom-
bination they undergo an initial selection process For T-
cells this takes place in the thymus and is called thymic
selection An analogous process occurs for B-cells Se-
quences that bind too strongly to the hosts own self-
proteins as well as those that bind too weakly to them
are discarded By analyzing the in-frame naive receptor
repertoire one can study how the diversity of the reper-
toire is aected by this initial selection process While
the recombination diversity Pgens described the po-
tential variability from the gene rearrangement process
this post-selection naive diversity Psels describes the
statistics of sequences actually found in the naive reper-
It is still a potential diversity as it refers to a
statistical ensemble of receptors rather than a nite set
of receptors found in a given individual
One can dene a sequence-dependent selection factor
Qs  PselsPgens quantifying how the distribution
of sequences is aected by thymic selection As before
sampling from Psels is impossible in practice because
of the too large number of sequences and models of the
selection factor Qs are needed For example it may
where a1 a2     aL is the amino-acid sequence of the
CDR3 region of length L and the single-position fac-
tors qiLa are inferred from the data using maximum
likelihood This model describes very well the statis-
tics of naive and memory TCR -chain sequences 43
-chain sequences 44 and naive BCR heavy chain se-
quences 40 The selection factors Qs were shown to
depend only on the amino-acid rather than nucleotide
sequence consistent with our hypothesis that selection
acts on the protein product and its functional proper-
ties folding stability binding etc Although selection
factors may vary signicantly from individual to individ-
ual in the statistical sense these dierences are relatively
small In addition models inferred from the memory and
naive sequence repertoires were found to be similar sug-
gesting that the selection factors Qs capture universal
functional properties of the receptor proteins
Diversity numbers can be estimated from the model
of Eq 6 The entropy of the post-selection distributions
of receptor sequences Psels  QsPgens are shown
in green in Fig 3A The rank-frequency distribution and
Hill diversities D of the post-selection ensemble of TCR
 chain sequences are shown in green in Fig 3B and C
Diversity is reduced by selection from 47 to 38 bits
for TCR  chains from 30 to 26 bits for  chains and
from 70 to 58 bits for BCR heavy chains corresponding
to D1  3  1011 for  chains D1  7  107 for  chains
or a combined TCR diversity of 2  1019 assuming in-
dependence between the two chains and D1  3  1017
for heavy chains About 2 bits of this reduction are due
to the removal of visibly nonfunctional sequences out-
of-frame or having stop codons However most of the
diversity loss is caused by negative selection against se-
quences that were unlikely to be produced in the rst
place Frequent sequences are enriched by the selection
process while rare ones are more likely to be removed
This enhancement of inequalities between sequences is
the main source of entropy reduction by selection
It should be noted that these estimate rely on an eec-
tive model 6 which may miss many important aspects
of the selection process
In particular negative selec-
tion which prunes the repertoire of specic sequences
that bind to self-antigens is likely not accounted for by
the model This further diversity loss would be specic
to each individual and its set of self-antigens which de-
pends on its HLA types To assess whether all the aspects
of selection that are not individual specic are well cap-
tured by Eq 6 one can ask whether the Simpson index
calculated with the model 1D2 is consistent with the
observed repertoire overlap between distinct individuals
as it should if the two repertoires were drawn indepen-
dently from the same distribution Psels
Indeed the
model and data showed good agreement 43 conrm-
ing that the model describes the statistics of sequences
accurately
Following their release into the periphery cells undergo
a somatic evolution process by which they divide die
or proliferate depending on the signals they receive In
the case of T cells it is not clear how this evolution af-
fects the potential naive diversity as TCR -chain se-
quences expressed by memory cells are statistically in-
distinguishable from naive ones 43 In contrast BCRs
experience somatic hypermutations as B cells proliferate
upon antigen recognition during the process of anity
maturation These hypermutations are stochastic but do
not occur uniformly across the receptor favoring instead
sequence context dependent hotspots 45 46 High-
throughput repertoire sequencing now makes it possi-
ble to build predictive statistical models of hypermuta-
tions by disentangling mutation from substitution rates
using either synonymous mutants 47 or out-of-frame se-
quences 40 48 Out-of-frame sequences have a raw mu-
tation rate ranging from a 5 to 10 implying an addi-
tional 04 bits per nucleotide This additional diversity is
a huge boost if this estimate holds for the whole length
of the receptor sequence However the increase in diver-
sity due to hypermutations should depend on how long
cells have been allowed to evolve As anity maturation
consists of alternating cycles of mutation and selection
the eects of hypermutations on diversity cannot entirely
be decoupled from selective pressures The inference of
selection during anity maturation using repertoire se-
quencing is currently a very active eld of study 23 49
V REALIZED DIVERSITY
Thus far we have focused on the potential diversity
Its object is the probability
of lymphocyte receptors
that each receptor sequence has been generated selected
in the case of BCR hypermutated into its nal
form One can also study the realized diversity of recep-
tor clonotypes actually present in a given individual at
a given time The relative frequency of clonotypes in an
individual can vary greatly depending on the history of
cell divisions and deaths and is in general distinct from
the probabilities Pgen and Psel discussed so far Measur-
ing accurate clonotype frequencies relies on trustworthy
counts made possible by unique molecular barcodes as-
sociated to original mRNA molecule 1921 with the
caveat that cells may express variable amounts of mRNA
molecules One can build the rank-frequency relation as
before by ranking clonotypes in a given individual from
most common to rarest This relation can be measured
for dierent phenotypes naive or memory CD4 or CD8
in dierent tissues or organs or at dierent ages to study
the organisation and evolution of diversity
In Fig 4 we plot the rank-frequency relation for the
unpartitioned TCR -chain repertoires sampled from the
blood of six individuals 44 and sequenced using unique
FIG 4 Clonotype frequency vs rank in the sequenced un-
partitioned repertoires of six individuals from 44 These re-
lations are close to a power law with exponents ranging from
065 to 1 The dashed line shows a slope of 1
molecular barcodes A striking feature of these rela-
tions is that they seem to follow a power law f  1r
where f and r denote the clonotype frequency and rank
with exponent  ranging from 065 to 1 with a mean
of 078 This observation is consistent with previous re-
ports on zebrash BCR 6 25 or mouse TCR repertoires
5 These power laws cannot be explained by a neutral
model in which cells divide and die stochastically at a
constant rate
Instead they are consistent with mod-
els where each clone evolves under a uctuating tness
shaped by its changing antigenic environment 56
tion strongly depends on the maximal rank ascid80
Power-law frequency distributions make it challenging
to estimate diversity measures D 32 This diculty
can be understood by considering the geometric construc-
tion of diversities of Fig 2 examining the rank-frequency
curve of Fig 4 no tangent of slope 1 can be easily de-
ned Mathematically the normalization of the distribu-
r 1r is
a diverging series meaning that the distribution is dom-
inated by a very large number of very small clonotypes
This is particularly problematic as these rare clonotypes
are not well captured by incomplete sampling
Most past studies of repertoire diversity have actually
focused on the hardest diversity measure to estimate in
the face of these sampling issues namely the species rich-
ness index D0 By sequencing a subset of the repertoire
with low-throughput techniques and extrapolating to the
entire repertoire Arstila and collaborators found a lower
bound to the total size of the TCR repertoire of 106 dis-
tinct  chains each pairing to 25 distinct  chains ie
25107 distinct TCRs 27 This bound has since been re-
visited using high-throughput sequencing data yielding
the same order of magnitude of a few millions 2 3
In practice most experiments are performed on sam-
ples of blood or tissues and do not sequence every single
rank100101102103104105frequency10-610-510-410-310-210-1cell Even experiments using a whole tissue are subject
to losses The problem of species richness estimation
from incomplete samples is not specic to lymphocyte
repertoires and has been extensively discussed in ecol-
ogy A number of estimators of D0 such as Chao1 57
the abundance-based coverage estimator 58 or more re-
cently DivE proposed in the context of TCRs 29 have
been developed to address this issue Another estimator
using multiple samples Chao2 59 has recently been
used to yield a lower bound of 108 distinct TCR  chains
in humans 28 All these estimators implictly assume
that the distribution of frequencies is reasonably peaked
and may not be appropriate for broad distributions such
as power laws
To illustrate the inadequacy of most estimators to cap-
ture the true species richness of power-law distributed
clone sizes we numerically generated D0  107 distinct
clonotypes and xed their abundance to
Cr  D0r
where r  1     D0 is the rank of the clonotype or-
dered by abundance and   08 to mimick the data
of Fig 4 We simulated a sample comprising 1 of the
entire dataset by drawing Sr the size of clonotype of
rank r in the sample from a Poisson distribution of mean
Cr100 We calculated Chao1
D0  Draw
where Draw
is the number of sampled clonotypes Sr  0
n1 is the number of singletons Sr  1 and n2 the
number of doubletons S2  2 This estimate gave
D0  3  106 instead of the true value of 107 Dividing
the dataset into 5 subsamples as in 28 and calculating
Chao2 yields a similar estimate 32  106 The reason for
this underestimation is deep and does not depend much
on the details of the estimator When downsampling one
loses information about the rare clones which dominate
the species richness Extrapolating their number from
larger clones must rely on implicit or explicit assump-
tions about the clonal distribution which are likely not
satised by fat-tailed distributions such as power laws It
is therefore likely that most current estimates from high-
throughput sequencing data are only lower bounds to the
true species richness
In fact simple theoretical arguments based on thymic
output estimates and neutral models of clonal evolution
give upper bounds of 1010-101160 61 However since
we have argued that the power-law in the rank-frequency
curve did not support the hypothesis of neutrality it is le-
gitimate to ask what species richness would be predicted
from a power-law distribution of clone sizes Assuming
that the rank-size relation is given by Eq 7 the average
clonotype size reads
D0cid88
cid18 D0
cid104Ccid105 
cid19  D1
cid90 D0
1  
where we have approximated the sum by an integral
which is valid for large D0 Plugging   08 gives an
average clone size of 5 cells and hence a species richness
D0  3 10115  1011 of the same order of magnitude as
total number of T cells Note however that this estimate
is very sensitive to the value of  as the average clone
size becomes  lnD0 for   1 and  D1
  1 where  is the Riemann zeta function
Although the validity of the power law across the entire
spectrum of clone sizes is a matter of debate this example
emphasizes the need for models to extrapolate the size
distribution to the very rare clonotypes the knowledge
of which is essential for evaluating species richness
VI TOWARDS A FUNCTIONAL DIVERSITY
All the diversities discussed in this chapter apply to
nucleotide sequences These estimates demonstrate the
potential of the adaptive immune system to generate a
huge diversity of sequences while identifying the biases
of their generation and selection However they do not
directly inform us about the functional diversity of the
repertoire dened as its capacity to recognize a wide va-
riety of antigens First of all the binding properties of
receptors are determined by their amino-acid sequences
the diversity of which is smaller due to the degeneracy
of the genetic code But more fundamentally a given
antigen can be recognized by many receptors  a phe-
nomenon termed cross-reactivity or polyspecicity Ma-
son 62 argued that if not for cross-reactivity an indi-
vidual would need a repertoire as large as the number
of antigens it can encounter or  1015 for TCRs which
is well beyond the number of lymphocytes a human or
a mouse can aord Simple models can help estimate
the minimal size of the functional repertoire 5 63 64
Theoretical arguments also suggests that cross-reactivity
gives a certain freedom in the identity and binding prop-
erties of the receptors implying that two individuals ex-
periencing similar antigenic environments need not share
common receptors through the convergent evolution of
their repertoires 65
Quantifying the functional diversity of the repertoire
is arduous because it requires to precisely characterize
cross-reactivity by mapping the sequence of receptors to
their binding properties The identication of TCRs that
bind to specic antigens using tetramer experiments in
mouse 66 shows that a single antigen is bound by 20-
200 out of 4  107 CD4 T cells ie a fraction 5  107-
5  106 of the total population Conversely a single
TCR can recognize many antigens A lower bound of
106 has been reported for an autoimmune TCR from a
human patient 67 but that number must be much larger
 5  107  1015  5  108 so that the TCR repertoire
may cover the entire set of possible peptides
Assessing cross-reactivity in a more quantitative and
systematic way requires to massively measure the binding
properties of a huge numbers of receptor-antigens pairs
High-throughput mutational scans combining binding as-
says with next-generation sequencing technologies now
make it possible to measure the binding properties of a
single receptor against many peptides 68 or of many
mutagenized receptors againt a single antigen 69 In-
tegrating these measurements into predicitve models of
receptor-antigen binding would provide powerful tools for
analysing lymphocyte repertoires The diversity of re-
ceptor sequences could then be augmented by the more
relevant diversity of antigens that can be recognized by
them with varying potencies and frequencies
This work was supported in part by grant ERCStG n
306312 and by the National Science Foundation under
Grant No NSF PHY11-25915 through the KITP where
part of the work was done
1 Jenkins MK Chu HH McLachlan JB Moon JJ 2009
On the composition of the preimmune repertoire of T
cells specic for Peptide-major histocompatibility com-
plex ligands Annu Rev Immunol 28275294
2 Robins HS et al 2009 Comprehensive assessment of
T-cell receptor beta-chain diversity in alphabeta T cells
Blood 11440994107
3 Warren RL et al
2011 Exhaustive T-cell repertoire
sequencing of human peripheral blood samples reveals
signatures of antigen selection and a directly measured
repertoire size of at least 1 million clonotypes Genome
Res 21790797
4 Hozumi N Tonegawa S 1976 Evidence for somatic rear-
rangement of immunoglobulin genes coding for variable
and constant regions Proc Natl Acad Sci 733628
5 Zarnitsyna VI Evavold BD Schoettle LN Blattman JN
Antia R 2013 Estimating the diversity completeness
and cross-reactivity of the T cell repertoire Front Im-
munol 4485
6 Weinstein Ja Jiang N White Ra Fisher DS Quake SR
2009 High-throughput sequencing of the zebrash an-
tibody repertoire Science 324807810
7 Freeman JD Warren RL Webb JR Nelson BH Holt Ra
2009 Proling the T-cell receptor beta-chain repertoire
by massively parallel sequencing Genome Res 191817
8 Robins HS et al
2010 Overlap and eective size of
the human CD8 T cell receptor repertoire Sci Transl
Med 247ra64
9 Benichou J Ben-Hamo R Louzoun Y Efroni S
2012 Rep-Seq Uncovering the immunological reper-
toire through next-generation sequencing Immunology
135183191
10 Warren EH Matsen Fa Chou J 2013 High-throughput
sequencing of B- and T-lymphocyte antigen receptors in
hematology Blood 1221922
11 Six A et al
2013 The past present and future of
immune repertoire biology - the rise of next-generation
repertoire analysis Front Immunol 4413
12 Woodsworth DJ Castellarin M Holt Ra
2013 Se-
quence analysis of T-cell repertoires in health and dis-
ease Genome Med 598
tibody repertoire Nat Med 2118
16 Turchaninova Ma et al 2013 Pairing of T-cell receptor
chains via emulsion PCR Eur J Immunol 432507
17 Howie B et al 2015 High-throughput pairing of T cell
receptor a and b sequences Sci Transl Med 7301ra131
18 Shugay M et al 2014 Towards error-free proling of
immune repertoires Nat Methods 116535
19 Vollmers C Sit RV Weinstein Ja Dekker CL Quake
SR 2013 Genetic measurement of memory B-cell recall
using antibody repertoire sequencing Proc Natl Acad
Sci 110134638
20 Egorov ES et al 2015 Quantitative Proling of Im-
mune Repertoires for Minor Lymphocyte Counts Using
Unique Molecular Identiers J Immunol 194615563
21 Best K Oakes T Heather JM Shawe-Taylor J Chain
B 2015 Computational analysis of stochastic hetero-
geneity in PCR amplication eciency revealed by single
molecule barcoding Sci Rep 514629
22 Grei V Miho E Menzel U Reddy ST 2015 Bioin-
formatic and Statistical Analysis of Adaptive Immune
Repertoires Trends Immunol 36738749
23 Yaari G Kleinstein SH 2015 Practical guidelines for
B-cell receptor repertoire sequencing analysis Genome
Med 7121
24 Grei V et al
2015 A bioinformatic framework for
immune repertoire diversity proling enables detection
of immunological status Genome Med 749
25 Mora T Walczak AM Bialek W Callan CG 2010 Max-
imum entropy models for antibody diversity Proc Natl
Acad Sci 10754055410
26 Venturi V Kedzierska K Turner SJ Doherty PC Dav-
enport MP 2007 Methods for comparing the diversity
of samples of the T cell receptor repertoire J Immunol
Methods 321182195
27 Arstila TP et al 1999 A direct estimate of the human
alphabeta T cell receptor diversity Science 286958961
28 Qi Q et al 2014 Diversity and clonal selection in the
human T-cell repertoire Proc Natl Acad Sci
29 Laydon DJ et al 2014 Quantication of HTLV-1 Clon-
ality and TCR Diversity PLoS Comput Biol 10113
30 Renyi A 1961 On measures of entropy and information
Entropy 547547561
13 Georgiou G et al 2014 The promise and challenge of
high-throughput sequencing of the antibody repertoire
Nat Biotechnol 3215868
14 Calis JJ Rosenberg BR 2014 Characterizing immune
strategies
repertoires by high throughput sequencing
and applications Trends Immunol pp 110
15 Dekosky BJ et al 2014 In-depth determination and
analysis of the human paired heavy- and light-chain an-
31 Hill AMO 1973 Diversity and Evenness  A Unifying
Notation and Its Consequences Ecology 54427432
32 Mora T Walczak AM 2016 Renyi entropy abundance
distribution and the equivalence of ensembles
qbio160305458
33 Janeway C Murphy KP Travers P Walport M 2008
Janeways immunobiology Garland Science
34 Murugan A Mora T Walczak AM Callan CG 2012
Statistical inference of the generation probability of T-
cell receptors from sequence repertoires Proc Natl
Acad Sci 1091616116166
35 Venturi V et al 2006 Sharing of T cell receptors in
antigen-specic responses is driven by convergent recom-
bination Proc Natl Acad Sci 1031869118696
36 Volpe JM Cowell LG Kepler TB 2006 SoDA imple-
mentation of a 3D alignment algorithm for inference of
antigen receptor recombinations Bioinformatics 22438
37 Gaeta BA et al 2007 iHMMune-align Hidden Markov
model-based alignment and identication of germline
genes in rearranged immunoglobulin gene sequences
Bioinformatics 2315801587
38 Munshaw S Kepler TB 2010 SoDA2 a Hidden Markov
Model approach for identication of immunoglobulin re-
arrangements Bioinformatics 2686772
39 Elhanati Y Marcou Q Mora T Walczak AM 2016
repgenHMM a dynamic programming tool to infer the
rules of immune receptor generation from sequence data
Bioinformatics In press
40 Elhanati Y et al 2015 Inferring processes underlying
B-cell repertoire diversity Philos Trans R Soc Lond B
Biol Sci 37020140243
41 Venturi V et al
2011 A mechanism for TCR shar-
ing between T cell subsets and individuals revealed by
pyrosequencing J Immunol 18642854294
42 Davis MM Bjorkman PJ 1988 T-cell antigen receptor
genes and T-cell recognition Nature 334395402
43 Elhanati Y Murugan A Callan CG Mora T Walczak
AM 2014 Quantifying selection in immune receptor
repertoires Proc Natl Acad Sci 11198759880
44 Pogorelyy MV et al 2016 Persisting fetal clonotypes
inuence the structure and overlap of adult human T cell
receptor repertoires arXiv qbio121
45 Shapiro GS Aviszus K Ikle D Wysocki LJ 1999 Pre-
dicting regional mutability in antibody V genes based
solely on di- and trinucleotide sequence composition J
Immunol 16325968
46 Cowell LG Kepler TB
2000 The Nucleotide-
Replacement Spectrum Under Somatic Hypermutation
Exhibits Microsequence Dependence That Is Strand-
Symmetric and Distinct from That Under Germline Mu-
tation J Immunol 16419711976
47 Yaari G et al 2013 Models of somatic hypermutation
targeting and substitution based on synonymous muta-
tions from high-throughput immunoglobulin sequencing
data Front Immunol 4358
48 Dunn-Walters DK Dogan A Boursier L MacDonald
CM Spencer J 1998 Base-Specic Sequences That Bias
Somatic Hypermutation Deduced by Analysis of Out-of-
Frame Human IgVH Genes J Immunol 16023602364
2011 Detecting selection in im-
munoglobulin sequences Nucleic Acids Res 39W499
49 Uduman M et al
50 Yaari G Uduman M Kleinstein SH 2012 Quantifying
selection in high-throughput Immunoglobulin sequencing
data sets Nucleic Acids Res 40e134
51 Kepler TB et al 2014 Reconstructing a B-cell Clonal
Lineage II Mutation Selection and Anity Matura-
tion Front Immunol 5
52 Laserson U et al 2014 High-resolution antibody dy-
namics of vaccine-induced immune responses Proc Natl
Acad Sci 11149284933
53 Uduman M Shlomchik MJ Vigneault F Church GM
Kleinstein SH 2014 Integrating B cell lineage infor-
mation into statistical tests for detecting selection in Ig
sequences J Immunol 19286774
54 Mccoy CO et al 2015 Quantifying evolutionary con-
straints on B-cell anity maturation Philos Trans R Soc
Lond B Biol Sci 37020140244
55 Yaari G Benichou JIC Heiden JAV Kleinstein SH
Louzoun Y 2015 The mutation patterns in B-cell im-
munoglobulin receptors reect the inuence of selection
acting at multiple time-scales Philos Trans R Soc Lond
B Biol Sci 37020140242
56 Desponds J Mora T Walczak AM 2016 Fluctuating t-
ness shapes the clone-size distribution of immune reper-
toires Proc Natl Acad Sci 1132749
57 Chao A 1984 Nonparametric estimation of the number
of classes in a population Scand J Stat 11265270
58 Chao A Lee SM 1992 Estimating the Number of
Classes via Sanple Coverage J Am Stat Assoc 87210
59 Chao A Bunge J
2002 Estimating the number of
species in a stochastic abundance model Biometrics
58531539
60 Kesmir C Borghans J de Boer RJ 2000 Diversity of
Human T Cell Receptors Science 2881135
61 Lythe G Callard RE Hoare R Molina-Pars C 2015
How many TCR clonotypes does a body maintain J
Theor Biol 389214224
62 Mason D 1998 A very high level of crossreactivity is an
essential feature of the T- cell receptor Immunol Today
19395404
63 Perelson AS Oster GF 1979 Theoretical studies of
clonal selection minimal antibody repertoire size and re-
liability of self non self discrimination J Theor Biol
81645670
64 de Boer RJ Perelson AS 1993 How diverse should
the immune system be Proc R Soc Lond B Biol Sci
252171
65 Mayer A Balasubramanian V Mora T Walczak AM
2015 How a well-adapted immune system is organized
Proc Natl Acad Sci 11259505955
66 Moon JJ et al 2007 Naive CD4 T Cell Frequency
Varies for Dierent Epitopes and Predicts Repertoire Di-
versity and Response Magnitude Immunity 27203213
67 Wooldridge L et al 2012 A single autoimmune T cell
receptor recognizes more than a million dierent pep-
tides J Biol Chem 28711681177
68 Birnbaum ME et al 2014 Deconstructing the peptide-
MHC specicity of t cell recognition Cell 15710731087
69 Adams RM Kinney JB Mora T Walczak AM 2016
Measuring the sequence-anity landscape of antibod-
ies with massively parallel titration curves
qbio160102160
