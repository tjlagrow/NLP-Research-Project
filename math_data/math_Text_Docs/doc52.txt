Modelling Bid and Ask prices using constrained Hawkes
processes
Ergodicity and scaling limit
Ban Zheng 
Francois Roue 
Frederic Abergel 
February 14 2014
Abstract
We introduce a multivariate point process describing the dynamics of the Bid and
Ask price of a nancial asset The point process is similar to a Hawkes process with
additional constraints on its intensity corresponding to the natural ordering of the best
Bid and Ask prices We study this process in the special case where the fertility function
is exponential so that the process is entirely described by an underlying Markov chain
including the constraint variable Natural explicit conditions on the parameters are
established that ensure the ergodicity of the chain Moreover scaling limits are derived
for the integrated point process
Keywords Point processes Hawkes processes Limit order book Microstructure
noise Bid-Ask Spread Ergodicity Scaling limit Markov model
Mathematics Subject Classication 37A25 60F05 60G55 60J05
JEL Classication C62
Natixis Equity Markets E-mail banzhengmelixnet The authors would like to thank the members of
Natixis quantitative research team for fruitful discussions
Telecom ParisTech CNRS LTCI Insitut Mines-Telecom E-mail francoisrouetelecom-paristechfr
Corresponding author Chair of Quantitative Finance Ecole Centrale Paris MAS Laboratory E-mail
fredericabergelecpfr
Introduction
Modelling the mechanisms of liquidity taking and providing is key to understanding the
ner scale microscopic dynamics of the price of a nancial asset
In the context of
electronic order-driven markets the modelling eort naturally occurs at the order-book
level and the study of order-driven markets has received much attention over the past two
decades On the one hand extensive statistical studies of the limit order book dynamics
and information content have been performed see eg 9 23 33 19 25 10 22 14 36
on the other hand stochastic models including equilibrium models agent-based models
and Markov models have emerged as a mathematical representation of the limit order
book see 31 32 17 15 1 16
It is quite clear from the references above or better from a direct inspection of limit
order book high frequency data that a full-edged order-book model rapidly becomes
cumbersome and may sometimes hide simple yet essential mechanisms One may there-
fore question the level of complexity required to understand the essential features of the
evolution of a nancial asset in the high frequency realm Obviously a minimal descrip-
tion should model the BidAsk spread since this quantity reveals essential information on
liquidity Such a description should also endogenously account for the interplay between
the spread and the mid-price It is our goal in this paper to introduce a phenomenological
point-process-based description of the joint dynamics of the mid-price and the spread or
equivalently of the respective best Bid and Ask prices This description can be viewed
as a simplied form of an order-book model with only two limits and innite liquidity
available at each best bid and ask prices so that its aim is to represent the joint dynamics
of the price and the spread in the absence of liquidity costs Therefore it can be viewed as
an upgrade of the classical modelling approach that addresses only the mid-price dynam-
ics Actually we introduce a more general model that can deal with several constraints a
situation that can happen when studying for instance the joint dynamics of the Bid and
Ask prices of several tradable assets
The theory of point processes provides a natural tool to model the dynamics of the price
of a nancial asset at the level of individual changes or tick level Bauwens and Hautsch
8 is a comprehensive introduction to the application of point processes in nancial time
series Such processes allow one to directly model the arrival of events aecting the price
dynamics Recently Hawkes processes have been introduced in market microstructure
Hawkes processes belong to the class of self-exciting point processes where the intensity is
driven by a weighted function of the time distance to previous points of the process These
processes originate from the literature in seismology where they were introduced to model
the arrival of replicas in the aftermath of an earthquake Later they have been successfully
applied to nancial markets in the context of default risk modelling 21 contagion across
equity markets 2 or foreign exchange modelling 20 To the best of our knowledge the
rst application of Hawkes processes in nancial time series is 11 Since then there has
been a growing interest in using Hawkes processes to model high frequency nancial data
see 7 24 12 26 5 29 6 There are some very convincing reasons to this growing interest
rst Hawkes processes oer a very natural way to model the dependence structures of
5 4 leading to
the arrival of changes in the price of one or several assets see eg
nice representations for high frequency volatility and correlation Moreover the mutual
excitation mechanism built in multivariate Hawkes processes is consistant with phenomena
observed in market microstructure where the interplay between liquidity providing and
taking is crucial see 29 for empirical evidence Obviously other important phenomena
also aect the price dynamics and liquidity supply macro-economic news idiosyncratic
news private information but they are exogenous and cannot be built directly into a
price model In this work we do not address that aspect of the modelling but rather
concentrate on the endogenous interplay between orders of various types
It is noteworthy that previous studies using point processes focus on the description of
the evolution of the mid-price of one or several assets without incorporating the spread-
price interaction In this contribution we wish to model the dynamics of the best Bid
and Ask prices in a stylized limit order book and use Hawkes processes to that aim
There is however a main diculty in using classical Hawkes processes there is a natural
ordering between the best Bid and Ask prices and they must evolve according to specic
constraints
In particular the BidAsk spread is always nonnegative and is therefore
bounded away from zero by its lower bound the tick size This means that as soon
as the minimal bid-ask spread is attained the best bid price cannot increase until the
best ask price goes up and conversely the best Ask price cannot go down until the best
Bid price does Hence we add a constraint variable to the classical multivariate Hawkes
process to model the dynamics of the best limit prices in a situation where one of the
prices is constrained the intensity of the arrival process of events that would violate the
constraint becomes zero and stays there until the constraint becomes inactive
Below is an example of a concrete problem that motivates our theoretical approach
Figure 1 shows a snapshot of the price evolution of a tradable asset both in physical time
and event time The simplest description of the dynamics of the best Bid and Ask prices
BestBidBestAsk dynamics FTEPA
BestBidBestAsk dynamics FTEPA
BestBidBestAsk dynamics FTEPA
BestBidBestAsk dynamics FTEPA
BestBid
BestAsk
BestBid
BestAsk
GMT Time s
GMT Time s
MidPrice Event time
MidPrice Event time
Figure 1 Limit order book of Orange  Evolution of Best Bid and Best Ask prices over
a short time window of April 1 2011 The evolution is displayed in physical time left
and in event time right
is based on four types of events
 Event 1  Best Ask price moves upward one tick
 Event 2  Best Ask price moves downward one tick
 Event 3  Best Bid price moves upward one tick
 Event 4  Best Bid price moves downward one tick
The arrival of these events is described by a marked point process N
As argued above Hawkes processes oer a sensible framework to model the arrival
times of these events However since the Best Bid has to remain at least one tick below
the Best Ask we need to introduce a constraint Namely dening the spread as S 
BestAsk  BestBid in ticks events 2 and 3 cannot happen whenever S  1
Our results show that under some explicit drift conditions the spread variable is
stationary and the rescaled price behaves like a random walk More generally we study
Hawkes processes with multivariate constraints
in a Markovian setting with exponen-
tial fertility functions we provide sucient conditions that ensure the ergodicity of the
embedded chain and study the scaling limits of the integrated point process The main
methodology is based on establishing geometric drift conditions as detailed in 28 Chap-
ter 15
The paper is structured as follows
in Section 2 we introduce the constrained mul-
tivariate Hawkes processes and present the main assumptions and notation Section 3
gives the main results on the geometrical ergodicity and the large scale behavior The
application to a limit order book is presented in Section 4 We have gathered the detailed
proofs in Section 5 Some useful technical results are postponed to Appendix A
2 Main assumptions and notation
21 Multivariate Hawkes process with constraints
Let p q be two positive integers We introduce a constrained multivariate Hawkes process
dened by a couple S N where St t  0 is a multivariate spread process taking its
values in Zq
  1 2   q and N is a p-dimensional multivariate point process We shall
describe the dynamics of this model by the conditional intensity of N as dened in 13
and an evolution equation for S
We assume that S is right-continuous with left limits and denote by St its left
limit at time t The conditional intensity of the multivariate point process N at time t
shall depend on the spread variable St For notational compactness we will see N as
a marked point process having arrivals in R with marks in 1     p We will denote by
Nj j  1     p the p point processes corresponding to each mark j namely
Nj  j 
In other words each thinned unmarked process Nj is given from N by the formula
Njg  Ng  1j 
for all non-negative measurable function g dened on R Here and all along the paper
point processes are seen as random point measures and we use the notation g for the
integral of a function g with respect to a measure  We further use the symbol  for the
product of measures that is   A  B  AB and for the tensor product of
functions that is g  hx y  gx hy The spread variable St acts on the point
process by constraining the set of possible marks for the rst event arriving after time t
in N The constraint is added in the usual expression of the conditional intensity of a
multivariate Hawkes process More precisely for all time t  0 and any mark i  1     p
the conditional intensity of Ni given Nt and St is set as
t i 
0i 
Xj1Zt
ijt  u Njdu
if St  Ai
otherwise 
where 0i is the immigrant rate of mark i ij is the fertility rate for producing a
mark i event from a mark j event and A1     Ap are products of nite subsets of Zq
Ai  Ai1    Aiq
In turn an arrival in N increases the value of the spread by a value only depending
on the mark More precisely the spread process S satises the evolution equation for all
t  u  0
St  Su  N1ut  J 
where J is dened on 1     p with values in Zq In other words at each arrival in N
with mark equal to i S jump by an increment given by Ji
Note that equations 21 and 22 are valid for t  0 and t  u  0 respectively so
that the distribution of the process
St Nj0 t  t  0 j  1     p
is dened conditionally to the initial conditions given by S0 and N restricted to
 0 To summarize this distribution is parameterized by the constrained sets A1     Ap
the immigrants rates 0i i  1     p the crossfertility rate functions ij  0 
0 i j  1     p and the jump increments Ji  Zq for i  1     p
Meanwhile we dene an unconstrained multivariate Hawkes process N with the same
fertility rate and immigrant intensity but without constraints that is with conditional
intensity on 0 satisfying for i  1     p
t i  0i 
Xj1Zt
j  N  1j for j  1     p
The average fertility matrix is dened by
where N
ij t  u N
t  0 
  ijij1p with ij Z 
ij tdt
1  i j  p 
The following assumption ensures the existence of a stationary version of the uncon-
strained multivariate Hawkes process N see 18 Example 83c
Assumption 1 The spectral radius of  is strictly less than 1
Under Assumption 1 we will use the following well dened vector
u  Idp  T 11p Xk0
k1p 
where 1p denotes p-dimensional ones vector
1p  1  1
and Idp denotes the p  p identity matrix
In the following by convention we use bold faces symbols only when q may be larger
than one In the case where q is set to 1 we shall write J and Sn in unbold faces since
they are scalar valued and similarly we write Ai in unbold face for the constraint sets
For a real valued function w dened on 1     p we shall use the notation
w  w1     wpT 
If w is vector-valued we use the same notation to obtain a matrix For instance J is a
p  q matrix
22 A very special case
When we study the ergodicity of the process we investigate the joint ergodicity of the
spread variable and of the point process A very special case is obtained by setting
ij  0
i j  1    p 
and q  1 In this case we only need to study the stationarity of the spread variable
since the intensities are constant Suppose moreover that J only takes values 1 and
1 and the constraint sets Ai are all equal to 1 if Ji  1 and to  if Ji 
In this case St t  0 is a birth-death process on Z with constant birth rate
  XiI
0i where I I is the partition of
1     p corresponding to the indices where J takes values 1 and 1 respectively By
3 Corollary 25 Stt0 is ergodic if and only if
0i and constant death rate   XiI
    J T 0 
Ji0i  0 
Here and in the following AT denotes the transpose of matrix A
23 A simple order book
In the introduction we presented a simple order book with only two limit prices namely
the best BidAsk prices We now detail how the constrained multivariate Hawkes process
can be used to model this situation Recall that the four possible events are Best Ask
price moves upward one tick i  1 Best Ask price moves downward one tick i  2
Best Bid price moves upward one tick i  3 Best Bid price moves downward one tick
i  4 Moreover the spread variable S is the standard univariate Bid-Ask spread In
the formalism of Section 21 this case corresponds to p  4 q  1 and the constrained
sets Ai are dened by
Ai  
i  1 or 4
i  2 or 3
The spread variable S evolves according to 22 with a scalar J dened by
Ji 1 
i  1 or 4
i  2 or 3
Hence the constrained multivariate Hawkes process provides a general framework for mod-
elling this simple order book If   0 as in Section 22 Condition 25 for the ergodicity
of the model becomes
02  03  01  04 
This condition can be interpreted as a drift that forces the mean intensity of decreases
of the spread variable S to be larger than the mean intensity of increases of the spread
variable S However in such a special case given N and S up to time t the conditional
distribution of N restricted to t only depends on St and not on the past events
Hence this model has very limited interest for modelling the dynamics of the limit order
book Therefore we wish to investigate the case where  is non-zero and in particular
to determine how the ergodicity condition 28 should be adapted to this case This will
be answered in Section 4
24 The Markov assumption
We shall consider a particular shape of the fertility functions ij which implies a Markov
property for the model This allows us to obtain very precise results on the ergodicity
of S N and is also of interest in applications since the model is parameterized by a
restricted set of well understood parameters
From now on we suppose that there exists   0 such that
1  i j  p 
ij u  ijeu 
This parameter is the reciprocal of a time  the larger  is the shorter the dependence
persists along the time between successive events We denote a new process dened in
the state space X  Zq
 by Xt  St t where t  t 1     t pT
with for all i  1     p
  Rp
t i 
Xj1Zt
ij t  uNjdu 
Proposition 21 The process Xt t  0 is a Markov process
This property directly follows from the exponential form of the fertility functions ij
see 30 21 27 in the unconstrained case We omit the proof of Proposition 21 which
is similar to the unconstrained case
0 denote an arbitrary positive constant say 0
In the following we shall essentially rely on a Markov chain Znn0 for describing
the dynamics of the process Xt t  0 We now detail the construction of this Markov
chain Let 0
0  1 An embedded Markov
chain Xnn0 shall be dened by sampling the continuous time process Xt t  0 at
increasing discrete times Tnn0 gathering the arrivals of N the unconstrained Hawkes
process dened in Section 21 and the arrivals of an independent homogeneous Poission
point process PPP n0 with intensity 0
0 Observe that St is constant between two
consecutive arrivals of the point process N Other sampling points are those generated
by n0 and those present in N but not in N which correspond to the arrivals of N
that violate the constraint To these points we shall assign a mark of new type i  0
see the second line in 29 below Hence almost surely S does not change at arrivals
corresponding to marks of this type The sample time instants with marks of type i  0
are articially added to avoid the periodicity of the embedded chain see the end of the
proof of Proposition 53
Each jump of t corresponds to an arrival in the point process N We denote its
mark by In which takes values in 1     p where n is the positive integer such that the
corresponding jump instant t equals Tn For other sample times Tn which thus correspond
to the arrivals of n0 we set In  0 Hence the marks of the embedded chain will take
values in the set 0 1     p
Finally we dene 1  T1 and for each n  2 n  Tn  Tn1 Sn  STn
n  Tn and Xn  XTn  Sn n Then given S0 0 and T0  0 we can
generate the sequence n Sn n n  0 1    iteratively as follows
n1  min0
n1 1
n1  p
where given X0     Xn 1     n and I1     In the conditional distribution of 0
n1  and p
are determined by hazard rates Hr0 Hr1     Hrp dened for each i and t  0 by
n1 is that of positive independent variables whose marginal distributions
0i  niet1Ac
i  0 
Hrit 
1Aj Sn0j  njet
i  0 
Then the event type at time Tn1 is
In1  arg min
i0 p
the spread variable at time Tn1 is given by
Sn1  STn1  Sn  JoIn1 
where Jo is the extension of J to 0 1     p dened by
if i  1
if i  0 
Joi Ji
and for all i  1     p the self-excitation intensities at time Tn1 are given by
n1i  Tn1 i  nien1  iIn1 
Observe that for all Tn  t  Tn1 the continuous time process is interpolated as
St  Sn
t i  niet 
  Rp
For any probability distribution  on X  Zq
 we denote by P the probability
corresponding to the initial distribution  at time t  0 Notation E corresponds to the
corresponding expectation If  is a Dirac distribution at point x  X we will simply
write Px and Ex
The above facts thus imply that Xn  Sn n Yn  In Sn n and Zn 
n In Sn n dened for n  0 1    are Markov chains respectively valued in X 
  Rp
 We shall
denote by Q Q and Q the transition kernels of these Markov processes respectively We
shall use these three transition kernels depending on the context As we shall see the
ergodicity of Q and Q essentially follow from that of Q However the kernel Q turned out
to be easier to handle for proving the ergodicity when q  2 see Theorem 37 below This
is the reason why we introduced the chain Ynn0 The chain Znn0 was introduced
because the processes N0 t and St can be deterministically expressed for all t  R
using this chain This fact is used in Theorem 39
 and Z  R  0     p  Zq
  Rp
 Y  0 1     p  Zq
  Rp
Remark 1 Observe that from the description above the conditional distribution of
1 I1 S1 1 given 0 I0 S0 0 does not depend on 0 I0 In particular the whole
path Zn n  1 only depends on the initial condition set on X0 and we may write for
all z   i x  Z and all A  BZ
Qz A  Px1 I1 X1  A 
Clearly the same remark holds for Q namely Qy A  PxI1 X1  A for all y 
i x  Y and A  BY
Because the ergodicity of Q will be proved using an induction on the number of
constraints q we need to introduce further Markov chains and transition kernels To
initiate the induction we dene the Markov chain  In n n  0 as the chain valued
in 0 1     p  Rq
 that starts at the same state as I0 0 but with transition kernel
Q which is dened as Q but with all the Ais replaced by the empty set and without the
spread variable We will call this chain the unconstrained Hawkes embedded chain since
it is associated to a classical unconstrained multivariate Hawkes point process This
chain corresponds to the case q  0
Remark 2 As in the case q  1 the conditional distribution of  In n n  1
given the initial condition  I0 0 does not depend on I0 Hence we will use the notation
E or P to underline this fact for instance for any y  i   0 1     p  Rp
j  0 1     p and Borel subset A  Rp
Qyj  A  P I1  j 1  A 
Furthermore for any J  1     q we denote by QJ  the transition kernel dened
on 0 1     p  ZqJ
 dened as the transition kernel Q but without the spread
variable Sj j  J and their corresponding constraint sets A1j     Apj In particular
we have Q  Q and Q1q  Q Meanwhile for any J  1     q we
denote by QJ  the transition kernel dened on 0 1     p  ZJ
 dened as the
transition kernel Q with the spread variable Sj j  J and their corresponding constraints
A1j     Apj In particular Q1q  Q and Q  Q
  Rp
3 Main results
We now present the main results of this work All the results will rely on the Markov
assumption introduced in Section 24 Under this Markov framework in Section 31 we
show that the kernel Q and Q dened in Section 24 are -irreducible and aperiodic We
provide a partial drift condition in Section 32 and then prove that Q is V -geometrically
ergodic in Section 33 where V is unbounded o petite sets Then we study the ergodicity
in the case q  1 in Section 34 The general case is presented in Section 35 Finally we
determine the scaling limit of the point process in physical time in Section 36
Irreducibility
Because of the constraints sets Ai and the function J the path of the process S cannot
evolve arbitrarily The following denitions will be useful
Denition 1 Let m be a positive integer and s  Zq
is dened as the set of j1  jm  0     pm such that
 the set of admissible paths Ams
j1  s  Joj1  Ac
Jojn  Ac
j2   s 
s  Ac
An admissible path j1  jm  Ams implies that for any i  0 1     p and
  0p given Y0  i s  the conditional probability to have I1  j1     Im  jm
and thus by 210 Sk  s 
Jojn for all k  1 2     m is positive
The main assumption of this section is the following one
Assumption 2 The fertility matrix  dened in 23 is invertible Moreover if q  1
there exists so  Zq
 such that the following assertion holds For all integer K  1 there
exists an integer m  p  1 such that for all s  1     Kq there exists an admis-
sible path j1  jm  Ams such that s 
Jojn  so and jmp1  jm 
1  p possibly in a dierent order
We say that C is an m  -small set for the kernel Q if for all x  C and A  BX
Qmx A   A 
where m is a positive integer   0 and  a probability measure Following 28 the
existence of small sets is related to -irreducibility The assumption on the invertibility
of  will be useful for proving the irreducibility of the embedded Markov chain The
second assumption says that there exists an admissible path see Denition 1 with the last
p steps containing the p dierent marks We will check this condition for the application
of the constrained Hawkes process to a limit order book in Section 4 It will be used to
establish the existence of small sets for Q see Proposition 53 Most of the time we will
rather refer to the notion of petite sets which is a slight extension of small sets Following
28 we say that A is a petite set for the kernel Q if for some probability measure a on
0 1 2      0 and some probability measure  on X it is a 1  -small set for the
a-sampled chain which has kernel Xm0
amQm
We can now state the main result of this section
 and 0 1     p  Zq
Theorem 31 Let Q and Q be the transition kernels dened in Section 24 on the spaces
  Rp
 respectively with p  1 and q  0 Suppose
moreover that Assumption 2 holds Then then kernels Q and Q are aperiodic and -
irreducible Moreover for all K  1 and M  0 1     Kq  0 M p and 0     p 
1     Kq  0 M p are petite sets for Q and Q respectively
  Rp
The proof is postponed to Section 51
32 Partial drift condition
We now derive a partial drift condition that will be useful to obtain a complete drift
condition on the process Xt t  0
In the following result the drift condition is
partial in the sense that it does not control Sn It only says that under Assumption 1
independently of the process Sn n should not have large excursions away of a compact
Proposition 32 Let Q be the kernel dened in Section 24 on the space Zq
p  1 and q  0 Suppose that Assumption 1 holds Then there exists   0   0 1
M  0 and b  0 such that for all s  Zq
 and   Rp
  Rp
 we have
  V1s    V1  b10Mp 
V1  euT  
with u dened as in 24
The proof is postponed to Section 52
33 The case q  0
If q  0 the process N is a standard unconstrained multivariate Hawkes process In this
case the process n n  1 is a Markov chain the spread variable Sn vanishes and the
partial drift condition of Proposition 32 becomes a complete drift condition for this
chain Moreover if q  0 in Theorem 31 Assumption 2 boils down to assuming that the
fertility matrix  dened in 23 is invertible We also note that the sublevel sets of V1
are petite sets by Theorem 31 Hence we obtain that n n  0 is V1-geometrically
ergodic see 28 Chapter 15 and also 28 Theorem 918 to get the Harris recurrence
In fact the same result holds on the extended chain  In n n  0 whose transition
kernel has been denoted by Q in Section 24
Proposition 33 Let Q be the transition kernel dened in Section 24 on the space
0 1     p  Rp
 Suppose that  is invertible and that Assumption 1 holds Then there
exists   0 such that Q is 10p  V1-geometrically ergodic where V1 is dened
in 33
Proof As explained above Theorem 31 and Proposition 32 apply to the case q  0 and
as a consequence n n  0 is a V1-geometrically ergodic This conclusion also applies
for the kernel Q of the chain  In n n  0 with V1 replaced by 10p  V1
because the conditional probability of  I1 1 given  I0 0 does not depend on I0
Having proved the ergodicity of Q we can establish the following result on its station-
ary distribution It will be used to obtain the case q  1
Corollary 34 Under the same assumptions as Proposition 33 denote by  the sta-
tionary distribution of Q Let w  1     p  R Let wo be the extension of w to
0 1     p obtained by setting wo0  0 Then we have
wo  1Rp
  w T Idp  10
p Idp  10
The proof is postponed to Section 53
34 The case q  1
We shall further denote
s  1  max
 j1p
In the case q  1 we need a drift function that applies to Xn  Sn n which is
unbounded o petite sets that is the drift function must diverge as at least one component
of Xn goes to innity while in Proposition 32 the drift function goes to innity only
when one of the components of n goes to innity To this end we dene
V0s  es 
We introduce the following assumption
Assumption 3 The following inequality holds
J T Idp  10  0 
Note that Condition 25 corresponds to Assumption 3 in the special case   0
Theorem 35 Let q  1 and p  1 and suppose that Assumption 1 2 and 3 hold Let
Q be the kernel dened in Section 24 on the space 0 1     p  Z  Rp
 with p  1
0  Q is
Then for all 1  0 small enough there exists 
10p  V00  V11 -geometrically ergodic where V00 and V11 are dened in 36
and 33
0  0 such that for all 0  0 
The proof of Theorem 35 is omitted as it is a particular case of Theorem 37 which
is proved in Section 55
Assumptions 1 and 2 appear to be very mild Assumption 1 is related to the stability
of the underlying unconstrained Hawkes process Assumption 2 is used to obtain small
sets for the chains Q and Q A natural question is to ask whether Assumption 3 J T Idp
10  0 is sharp The following theorem partially answers to this question
Theorem 36 Let Sn n n  0 be the Markov chain on the space Z  Rp
transition kernel Q dened in Section 24 Suppose that Assumptions 1 and 2 hold Then
Q is -irreducible Moreover the two following assertions holds
i If s s  1     0p  0 then Q is 11s1  V11 -geometrically
ii Otherwise if
ergodic where s is dened by 35
J T Idp  10  0 
then Q is transient
The proof is postponed to Section 54
Remark 3 The fact that Q is -irreducible follows from Theorem 31 Then by deni-
tion of  in the proof of Proposition 53 Assumption 2 implies that s0 0p  0
Thus if s0 in Assumption 2 satises s0  s then the case i does not happen
35 General case
To obtain a drift function in the general case q  1 we shall use the function V0 dened
by 36 applied multiplicatively to each component of Sn and the function V11 dened
by 33 applied to intensity n
We shall see that the proof of the ergodicity for q  1 relies on an induction on q see
the details in Section 55 For q  1 the induction applies under the simple Assumption 3
because using Corollary 34 it allows us to compute some moment under the stationary
distribution of the unconstrained chain with kernel Q In general the induction is more
involved We shall need some additional notation For any set J  1     q we dene
J J  1     p  Z by
J J i  XjJ
Jji 
o 0  0
o the extension of J J on 0     p dened by J J
  Rp
We further denote by J J
Theorem 37 Let q  1 and p  1 and suppose that Assumption 1 and 2 hold Let Q
be the kernel dened in Section 24 on the space 0 1     p  Zq
 Dene for all
J  1     q the kernel QJ  as in Section 24 Check the following conditions in this
order 
for k  1 2 3     q do
for J  1     q such that J  k do
Jcid19T
Idp  10  0 
Check that
cid18J
for J   J with J   J do
Check that
Then for all 1  0 small enough there exists 
o  1Zq
J hJ J
i  0 
0  0 such that for all 0  0 
 V11-geometrically ergodic We denote by J  its stationary
QJ  is 10p V J 
distribution
Then for all 1  0 small enough there exists 
is 10p  V q
00  V11 -geometrically ergodic
0  0 such that for all 0  0 
0  Q
The proof is postponed to the end of Section 55
Remark 4 By Corollary 34 Condition 310 is equivalent to 311 with J   
Remark 5 Observe that Condition 311 makes sense at this step Indeed since J 
k and J   k we have already checked that QJ  is geometrically ergodic Thus the
stationary distribution J  is well dened In practice one may check this assumption
using Monte Carlo simulations since the law of large number holds in this case see 28
Theorem 1717
36 Scaling limit
In the application of this model to the limit order book an increment of the best bid price
or the best ask price at time Tk is specied by the mark Ik  0     p see the details in
Section 4 It is interesting to investigate the microscopic behavior of the mid-price mean
of the best bid price and the best ask price at large scales see 5 for the non-constrained
Suppose that the Assumptions of Theorem 37 hold then Q is 10pV q
00V11-
geometrically ergodic for some 0 1  0 and V00 and V11 dened in 36 and 33
Applying the results of 28 Theorem 1742 we obtain a functional central limit theorem
FCLT in discrete time for the chain Q To obtain a result in physical continuous time
we actually need a functional CLT for the kernel Q dened in Section 24 Hence we must
rst check that Q is geometrically ergodic
Let us dene V2  R  R by
We provide the ergodicity property of Q in the following corollary
V2  e 
Corollary 38 Let q p  1 and Q be the kernel dened in Section 24 on the space
R  0 1     p Zq
 Suppose that the Assumptions of Theorem 37 hold Then
for all 1  0 small enough there exists 
0  and all
2  0 small enough Q is V22  10p  V q
0  0 such that for all 0  0 
00  V11 -geometrically ergodic
  Rp
The proof is postponed to Section 56
By Corollary 38 Q admits a stationary distribution  We shall use the notation E
for the expectation under the stationary distribution
Let now g  Z  R be such that for all 0 1 2  0
V22  10p  V q
00  V11 z
  
By Corollary 38 under this condition we have g   Let g  g  g Using
Corollary 38 and 28 Theorem 1744 for all 0 1 2  0 there exists R  0 such that
the Poisson equation gQg  g see 28 Chapiter 17 admits a solution g satisfying the
00  V11   1cid1 Moreover we have for all z  Z
bound g  Rcid0V22  10p  V q
gz 
z g 
It also follows that g2   Let us denote the linearly interpolated partial sums of
gZn by
snt g  ntg  nt  ntcid2nt1g  ntgcid3 
where kh 
hZj Applying 28 Theorem 1744 if the nonnegative constant
is strictly positive we have for any initial distribution as n  
g  cid0g2  Qg2cid1
g12snt g d Bt 
where d denotes the weak convergence Here the weak convergence holds in C0 1
the space of continuous functions dened on 0 1 and B denotes a standard Brownian
motion on 0 1
Remark 6 Note that 2
g  1R  Jo  1Zq
  1Rp
 In this case we have ng  Sn  S0 and thus
g may not be strictly positive An interesting example is given by
ng  Sn  S0  ESn  ES0 
EJoIk  g 
Hence we get that ng  0P1 which implies 2
We now derive the main result of this section which determines the scaling limit of
the constrained Hawkes process We need some additional notation before stating the
result Let w  1     p  R Dene
Further dene
EwI1
E1
vw  2
where 2
z   i s 
g is dened as in 314 with g  Z  R dened by gz  wi  Ew for all
Theorem 39 Under the assumptions of Theorem 37 if vw  0 we have for any
initial condition as T  
T 12cid0N10tT   w  t T Ewcid1 d vwE112 Bt 
where the weak convergence holds in D0 1 the space of cadlag functions dened on
0 1
The proof is postponed to Section 57
4 Application to a limit order book
Let us apply our results to the simple limit order book presented in the introduction The
function J and the sets Ai of the corresponding constrained multivariate Hawkes process
are detailed in Section 23 The Markov assumption of Section 24 allows us to use a nite
set of parameters for this model namely  and 0
Assumptions 1 and 3 then amount to assumptions on the parameters 0 and  As-
sumption 2 says that  has to be invertible and requires an additional property which
only depends on the constrained sets Ai and J Hence to apply Theorem 35 we only
need to check that this additional property holds We set so  2 For any K  1 we set
m  K  2  p Then given s  1     K we need to show that there is an admissible
path j1     jm  Ams such that s 
1  i  s  2
Jojk  2 so To see why let us set for
if s  2
of s  1
s2
Then by 27 we have s 
Jjk  2 To conclude we set ji  0 for s  2 
i  m  4 and jm3  1 jm2  4 jm1  2 and jm  3 so that by 27 and 211
Jojk  2 Moreover we easily check that 31 holds for this choice of j1     jm
and that jm3 jm2 jm1 jm  1     4 Hence Assumption 2 holds and Theo-
rem 35 applies provided that  is invertible and has spectral radius smaller than 1 and
0 satises 37 with J dened by 27 The ergodicity of the underlying chain allows one
to perform meaningful statistical analysis of the data This will be done in a forthcoming
For the moment we focus on the scaling limit of the mid-price dened as the middle
price between the Best Bid and Best Ask prices This value is often considered as the
continuous time price of the asset In the framework of our model the mid price satises
the following equation
P t  P u  Ncid01ut  wcid1 
where wi takes values 1212 12 and 12 for i  1     4 respectively Note that
similar equations hold for the Best Bid and Best Ask prices with dierent functions ws
Applying Theorem 39 we get the scaling limit of the mid-price in physical time is
given by
T 12 P tT   P 0  t T E w d vw E112 Bt 
where E w and v w are respectively dened in 316 and 317 provided that v w 
0 Although it does not seem easy to check that v w  0 except perhaps by numerical
means we do expect this to be true
Indeed while the spread behaves as a station-
ary variable yielding a vanishing asymptotic variance in the large scale behavior see
Remark 6 the best-bid best-ask and mid prices behave as co-integrated random walks
In practice we can apply our results in several ways We refer to the forthcoming thesis
35 for details about the estimation methods related to constrained Hawkes processes and
their applications to limit order books data Let us here briey illustrate an application
on a real data example Using all intraday data from 1st April 2011 to 10th April 2011
parameters estimations for Eni SpA and Total yield the following results The decaying
rate  is estimated to 165 for Eni SpA and to 179 for Total which correspond to half-
times respectively equal to 06 and 055 seconds The spectral radii of the estimated
fertility matrices  are equal to 05723 and 06221 for Eni SpA and Total respectively so
Assumption 1 holds for the estimated parameters We also computed the corresponding
constants appearing in the left-hand side of the drift condition 37 and obtained 00115
and 00682 respectively for Eni SpA and Total We note that for these estimated values
Assumption 3 holds and thus Theorem 35 applies Following 5 to illustrate the relevance
of our model we shall briey present empirical signature plots and compare them with
the signature plots of the tted models For a given asset price best bid best ask or
mid-price at time t P t the empirical signature plot is dened as an empirical estimate
of the quadratic variation of P t over 0 T  expressed as a function of the scale   0
namely
C  
P n   P n  1 2 
This can be compared with a theoretical signature plot based on the tted model namely
C  
EhP t     P t2i 
where E here denotes the expectation of the model with parameter  and  is the param-
eter estimated from the data In practice this expectation is computed via Monte Carlo
simulations of the tted model
In contrast with 5 where only the mid-price is considered and the signature plot
is always decreasing we observe in Figure 2 that the empirical signature plot diers
depending whether the considered price is the best bid best ask or mid-price In Figure
3 we present the corresponding theoretical signature plots using the tted models We
observe that with a limited number of parameters the model is able to recover shapes
somewhat similar to the empirical ones
Signature Plot ENIMI 2011040120110410
Signature Plot TOTFPA 2011040120110410
BestBid
BestAsk
MidPrice
BestBid
BestAsk
MidPrice
t   s
t   s
Figure 2 Signature Plot of Eni SpA left and Total right calculated on the data of best
bid best ask and mid-price over the period from 1st April 2011 to 10th April 2011
5 Postponed proofs
51 Proof of Theorem 31
In the following we shall denote
0  max
0j 0  min
0j
  max
ij   min
ij 
J  max
i1p
J ij 
Signature Plot Simulation ENIMI 2011040120110410
Signature Plot Simulation TOTFPA 2011040120110410
BestBid
BestAsk
MidPrice
BestBid
BestAsk
MidPrice
t   s
t   s
Figure 3 Signature plots calculated with simulated data where the parameters are cal-
ibrated from the mid-quotes data of Eni SpA left and Total right with p  4 and
and the j-th column vector of  by j so that   cid01
existence of small sets we need two preliminary results
Lemma 51 Let x  s   X j  A1s with j 6 0 and g  X  R Then
   pcid1 To establish the
get  je20tdt 
Excid2g11I1jcid3  0Z 
where   max
i
Proof Using 212 we get that
1  j1j
Excid2g11I1jcid3  Exhgej
 Expcid00  cid1 where Expz denotes the exponential distribution
1 are independent we have
1 and U j
where U j
1  min
Observe that U j
with mean
 thus since j
Excid2g11I1jcid3  Exhgej
Since j  A1s using that the hazard rate of j
see that the density of j
get 54
1  je0j
1 is bounded between 0 and 0   we
1 is bounded from below by 0e0t on t  R Hence we
Corollary 52 Let m be an integer  1 M  R and g  X  R Let x  s   X
with   0 M p and j1  jm  Ams with ji 6 0 for i  1     m Then we have
Excid2gm1I1j1 Imjmcid3
i1 ti  e Pm
ge Pm
 0
i2 tij1    jm 
 eCmM Pm
i1 ti dtm  dt1 
where CmM  20  M  m  1
Proof The case m  1 is given by Lemma 51
To get the result for any m  2 we proceed by induction Let x  s   X with
  0 M p and j1  jm  1     pm if j1     jm  Ams We have
Recall that given I1 X1 the distribution of Ik Xk k  2 does not depend on I1
hence with the Markov property we obtain that
Excid2gm1I1j1 Imjmcid3 Excid21I1j1Ecid2gm1I2j2 ImjmI1 X1cid3cid3 
Ecid2gm1I2j2 ImjmI1 X1cid3  EX1cid2gm11I1j2 Im1jmcid3 
Note that using 212 and 52 X0  x and   0 M p implies 1  0 M  p
Thus in the event X0  x the right-hand side of the last display can be bounded from
below by applying the induction hypothesis with j1  jm1 replaced by j2  jm
  1 and the constant
Cm1M  20  M    m  2  CmM 
Plugging this bound in 55 we get that
Excid2gm1I1j1 Imjmcid3
 0
m1Ex1I1j1ZRm1
g      eCmM Pm1
i1 ti dtm1  dt1 
where the omitted argument of g reads
     e Pm1
i1 ti1  e Pm1
i2 tij2    jm 
Using again Lemma 51 we have
Excid21I1j1g    cid3  0Z 
 0Z 
g    e20tdt
g    eCmM tdt 
where the omitted argument in the right-hand side reads
    e Pm1
 e Pm1
i1 tiet  j1   e Pm1
i1 tit  e Pm1
i2 tij2    jm
i1 tij1    jm 
Hence we get the result by applying the Tonelli theorem in 56 and then using 57
Proposition 53 Let Q be the transition kernel dened in Section 24 on the space
  Rp
 with p q  1 Suppose that Assumption 2 holds Then there exists a probability
measure  on X such that for all K  1 and M  0 there exists   0 and a positive
integer m such that 1     Kq  0 M p is an m   and m  1  -small set for Q
Before providing the proof of this result let us state the following corollary which
follows by observing that the conditional distribution of I1 S1 1 given I0 S0 0
does not depend on I0
Corollary 54 Let Q be the transition kernel dened in Section 24 on the space 0 1     p
  Rp
 with p q  1 Suppose that Assumption 2 holds Then there exists a probability
measure  on X such that for all K  1 and M  0 there exists   0 and a positive
integer m such that 1     p1     Kq0 M p is an m   and m1  -small
set for Q
Proof of Proposition 53 Let K  1 and M  0 and denote C  1     Kq  0 M p
Let x  s   C By Assumption 2 there exists an integer m  0 and an admissible
path j1  jm such that s 
Jjn  so and jmp1  jm  1  p where
so  Zq
 we may write
 is independent of m M and K
Now for all subsets A  BZq
 and B  BRp
Qmx A  B  Ex 1ASm1Bm
 Ex1ASm1Bm
 1AsoExmp
1Iiji
1Iijmpi 
1IijiEXmp1Bp
where we used that given Yi i  0 1     m  p the conditional distribution of Yj
j  m  p only depends on Xmp and the Markov property
Take now K  1 and M  0 and let x  1  Kq  0 M p By 212 and 52
under X0  x we have mp  0 M p where M   M  m  p Moreover
under X0  x Ii  ji i  1     m  p the last p-steps path jmp1  jm is
admissible that is jmp1  jm  ApSmp Applying Corollary 52 we get that
under X0  x Ii  ji i  1     m  p
EXmp
1Bm
 0
Yimp1
1Iiji
1Bcid16e Pp
i1 ti  e Pp
i2 tij1    jpcid17
 eCmM  Pp
i1 ti dtp  dt1 
i1 ti    1  p 1T
ij1 ti for j  1     p  1 Inequality 59 yields under X0 
where CmM   20  M   m 1 Setting u  e Pp
where j  e Pp
x Ii  ji i  1     m  p
EXmp
Yimp1
1Bm
1Iiji
 0
p1 ZD
1B u  
mM 
ddu 
where D  u   0  u  1    p  1  1 Applying Lemma A1 with
   and  
in 510 we get that there exists 1  0 and a probability
measure 1 such that under X0  x Ii  ji i  1     m  p
CmM 
EXmp
1B m
Yimp1
1Iiji
  11B 
512
Using Inequalities 58 and 511 we get that
Moreover it is important to note that 1 only depends on  and 
1Iiji 
Qmx A  B  11Aso 1BExmp
Using that x  1  Kq  0 M p and Corollary 52 with g  1 we further have that
Exmp
1Iiji  0
eCmM Pm
i1 ti dtm  dt1 cid18 0
CmMcid19m
From Inequality 512 we get that Qmx A B  A B for some positive constant
 not depending on x and  is the measure on X dened by A  B  1Aso1B
which does neither depend on M nor K In other words C is a m  -small set see
To obtain that C is also an m  1  -small set by possibly decreasing  we simply
observe that we can carry out the same proof as above with m replaced by m  1 and the
sequence of marks j1  jm replaced by 0 j1  jm
Proof of Theorem 31 In Proposition 53 the measure  does not depend on the set C
which can be chosen to contain any arbitrary point x in the state space X Hence the chain
is -irreducible with    Moreover the set C is m  -small and m  1  -small
hence the chain is aperiodic sse 28 Section 543 These arguments hold for the Kernel
Q and thus we obtain Theorem 31
52 Proof of Proposition 32
Recall the denition of u in 24 We shall further denote
1  u  min
i1p
ui  u  max
i1p
ui   
The inequality u  1 follows from the fact that k has non-negative entries for all k  1
 the hazard rate of
1  mini
Observe that given the initial condition x  s   Zq
  Rq
1 i  0     p reads
Hru 
Hriu  0
p 0  1T
p eu 
where we used 29 Moreover for any i  0 1  p we get that given 1 the
conditional probability that the rst arrivals mark is i is given by
PxI1  i1  Hri1Hr1 
Using 212 we have 1  e1  I1 1I160 and thus
 Excid2expcid0uT e1  uTI1 1I160cid1cid3
 Exexpcid0uT e1cid1
  V1x
PxI1  i1eui1 
by conditioning on 1 and using that T u  u  1p see 24 and setting u0  1
Inserting Formula 514 we get
  V1x  Ex p
expcid0uT e1  ui  1cid1Hri1Hr1 
Using the hazard rate of 1 under Px the corresponding probability density function is
given by u 7 HrueIru on R where
Irit Z t
Irt 
Hence we get
Hriu du
t  0 
Irit  0
0t  1T
p 0t 
1  et 
  V1x Z 
euT euIru p
eui1Hriu du 
Using that eu01  eui1 for all i  1     p and the particular form of Hr0
and Hri in 29 we easily obtain that
eui1Hriu 0
eui1cid00i  ieucid1 
Consequently we have
V1
  V1x
eui10i 1
 0
eui1i 1
V1Z 
V1Z 
euT euIrudu
euT euIruudu 
Using 515 we have
V1Z 
euT euIrudu Z 
euT 
 eu10
p 0udu
where we used Lemma A2 with a  uT  
and   0
Similarly applying Lemma A2 with     0
p 0 we obtain
p    
 0 as 1T
euT euIruudu
exp uT  
eu  1    0
p 0udu
V1Z 
uT   1T
p    
Therefore inserting 517 and 518 in 516 we get
lim sup
p 
V1
  V1x  sup
0pPp
i1 eui1i
uT   1T
Now observe that using 513 we have
0  u  uT 1T
p   u   
and thus for   0 small enough using a Taylor expansion of the exponential function
at the origin we have
i1 eui1i
uT   1T
p   uT   1T
p   C 21T
uT   1T
 1  
 1  
uT   1T
 C 2 
 C 2  1    O2 
1  u
where C C do not depend on  Hence taking 1  0 small enough we have for all
  0 1
  sup
0pPp
i1 eui1i
uT   1T
Hence choosing such a  and setting    we get 32 for  out of 0 M p provided
that M large enough Since V1 is bounded on 0 M p this achieves the proof
53 Proof of Corollary 34
By 5 Theorem 1 using the denitions and notation of Section 21 we have
T 
N10T   w  w T Idp  10
On the other hand by the law of large numbers for Harris recurrent chains see 28
Theorem 1717 we have
n
wo Ik  wo  1Rp
 asP 
Here P means that the result holds for any initial distribution on  I0 0 In particular
taking 0  0 we get that
n
N10 Tn  w  wo  1Rp
where Tn is dened as Tn in Section 24 but for the unconstrained chain Note that we
used that wo0  0 so that only the marks in 1     p are counted in the sum of the
left-hand side of 520 Observe now that under the event 0  0 we have
n00 Tn  N10 Tn  11p  n 
Recall that n0 is an independent homogeneous Poission point process which corresponds
to the events with marks equal to 0 Since  Tn is an increasing sequence we get that
it diverges as and thus applying 519 with w  11p we have under the event
0  0
n
N10 Tn  11p  1T
p Idp  10
The last two displays yield under the event 0  0
n
p Idp  10
Applying 519 521 and the last display we get 34
54 Proof of Theorem 36
The case i follows from Proposition 32
We next consider the case ii so that s2  0p  0 for some s2  s
By 38 there exists i  1     p such that Ji  0 Thus for any m  1 the
constant sequence i     i of length m belongs to Ams2 see Denition 1 It follows
that s2  mJi  0p  0 for all m  1 We shall prove that for all s  1 and
Sn  scid19  0 
Pscid18 inf
Take s such that s0p  0 Dene s  s2mJi and take m and M  0 large
enough so that s 0 M p  0 and Pscid18 inf
Sn  scid19  0 for all   0 M p We
thus have that the probability that the chain Xk k  1 avoids s  0p starting
from anywhere in s  0 M p is positive Since these two sets have positive -measure
we get by 28 Theorem 836 that Q is transient
Hence it only remains to show that 522 holds Applying Corollary 34 and Condi-
lim inf
s
0Mp
tion 38 we have
n
Mn   asP with Mn 
Jo Ik 
Mn is valued in R asP it equals  with probability 0 Let   0 1
Hence U  inf
Now under the event S0  s we have that Sn  s  Mn as long as Sk does not hit the
constraint set p
Sn  s coincides with the event U  s  s Hence
Sn  s  U  Finally we get that for all s  s and
For all s  s the event  inf
i1Ai for k  1     n
under this latter event we have inf
all   Rp
Pscid18 inf
Recall that U only depends on the unconstrained chain  In n n  0 Let us denote
for all k  1 Uk  inf
Mn so that U  M1    Mk  Uk1 Since M1     Mk  kJ
we have for all s1  kJ
Sn  scid19  P U  s  s  s 
ws1   P U  s1  P Uk1  s1   Qkws1  
Observe that ws1 is a function valued in 0 1 By Proposition 33 and 28 Section 15
Q admits a stationary distribution  and there are constants  C  0 and   0 1 not
depending on s1 such that for all  o  Rp
 and k  1
 Qkws1    Qkws1 o  C k V1  V1o 
 and M  0 Choose k large enough so that
Now x some o  Rp
c  C k V1M 1p  V1o  12 
Then we may choose s1 large enough so that s1  kJ and
 Qkws1 o  Po Uk1  s1  Po U  s1  12 
The last four displays yield that for all   0 M p and all s1 large enough
This and 523 yields 522 which concludes the proof
P U  s1  12  c  0 
55 Proof of Theorem 37  induction on q
We have already shown that the chains Q and Q are -irreducible and aperiodic and
exhibited petite sets see Theorem 31 To obtain a drift condition on the constrained
case q  1 we shall reason by induction on the number of constraints q We shall rely on
the transition kernels QJ  introduced in Section 24 for subsets J in 1     q For such
a given set J  we shall further denote by  In Sn n n  0 the chain with transition
kernel QJ  which starts at the same state as I0 S0 0 and for all x  ZqJ
by EJ x    the expectation under S0 0  x The fact that this expectation
only depends on x is explained in Remark 1
Proposition 55 Let p q  1 and dene the transition kernels Q on the space Zq
  Rp
as in Section 24 Suppose that  is invertible and that Assumption 1 holds For any
non-empty J  1     q let  In Sn n n  0 be a Markov chain on the space
0     p ZqJ
 with transition kernel QJ  dened in Section 24 and suppose
that it satises the following condition
C For all 1  0 small enough there exists 
0  0 such that for all 0  0 
w IkV11m  i  0 
EJ she0 Pm
m
sZqJ
where we denoted w is dened in 542
Then for all 1  0 small enough there exists 
exist   0 1 b  0 and m  1 such that for any initial condition x  X
0  0 such that for all 0  0 
0  there
QmV q
00  V11x   V q
00  V11 x  b 
where V1 and V0 are dened in 33 and 36 respectively
Proof Take x  s   X We already have the drift condition 32 of Proposition 32
which holds for some   0 and thus by Jensen inequality for any 1  0  By
induction for all small enough 1  0 there exists b1  0 and 1  0 such that for all
m  1
  V11x  m
 m
1 V11  b1 1  1    m
1 V11  b1 1  1 
By 210 and 53 we have in the event S0  s V q
get V q
00 S0  Hence we obtain for any 0  0
00 S1  e0J V q
00Sm  e0JmV q
00 s  then we
QmV q
00  V11 x  e0JmV q
cid16e0J 1cid17m
V q
00  V11 x 
b1e0Jm
1  1
00 s m
1 V11  b1 1  1
00 s 
Observe that for a given 1  1 we can choose 0  0 small enough so that e0J 1  1 It
follows that choosing such a 0 for all m  1 and K  1 the bound 526 implies 525
for all x  s   X such that V q
00 s  K we shall
prove the following assertion
D For all 1  0 small enough there exists 
0  there
exist m  1 K  0 b  0 and   0 1 such that 525 holds for all x  s   X
satisfying V q
00 s  K To address the case V q
0  0 such that for all 0  0 
00 s  K
To conclude the proof we now show that Assertion D holds Let m  1 and x  s  
X Observe that by 210 for all 0  0 we have in the event X0  x
00Sm  V q
00 s e0 Pm
Jj Ik  V q
00s e0 Pm
wIk 
Hence we have for all x  s   X
QmV q
00  V11 x  V q
 V q
00s Exhe0 Pm
00  V11 x Exhe0 Pm
wIkV11 mi
wIkV11 m  i 
Now the idea of the proof relies on the fact that if V q
00 S0 is large enough then it will
take some time for all the components j in a set J with cardinal J at least 1 of the
multivariate spread to reach their constraint set
Aij 
Aj  i1p
Up to this time the process dened by YJ 
 n n  0 where SJ 
is obtained by removing the j-th component of Sn for all j  J  behaves as a Markov
chain with kernel QJ  dened as Q but without the j-th constraints with j  J  see
above More precisely we use the following coupling argument For a positive integer
m we denote
 In SJ 
mj  1  mJ  maxAj 
We can then dene a Markov chain  In Sn n n  0 with transition kernel QJ 
mj j  J  the sequence  In Sn n n 
and such that in the event S0j  s
0 1     m coincides with In SJ 
 n n  0 1     m Then by construction for
all x  s  such that sj  s
mj for all j  J  denoting x  sJ   we have
Exhe0 Pm
wIkV11 m  i  EJ xhe0 Pm
Now we take K  0 such that log K  p0 max
indices j  1     q such that sj  s
implies maxs  maxs
00 s  K For 
is a nite number of such subsets we obtain Assertion D
mj We let J denote the set of all
00s  K
m Hence Equality 530 applies for all x  s   X satisfying
0 as in Condition C we can choose it independently of J since there
w IkV11 m  i 
mj The set J is not empty since V q
j1q
Condition C of Proposition 55 needs to be simplied A rst step in this direction
is given by the following lemma
Lemma 56 Let In Sn n n  0 be the Markov chain on the space 0 1     p 
  Rp
 with transition kernel Q dened in Section 24 Let w  0 1     p  R
Suppose that the following assertions hold
E-1 For all   0 small enough there exists   0 such that for all   0  Q
0  V1  -geometrically ergodic where V0 and V1  are dened
is 101p  V q
in 36 and 33 respectively
E-2 The stationary distribution  of Q satises hw  1Zq
Then for all 1  0 small enough there are positive constants   and 
all 0  0 
i  0
0 such that for
Excid2e0 Pm
k1wIk V q
0  V11 Xmcid3
V q
0  V11x
  
Proof Using Assumption E-1 for any   0 small enough we may choose  1  0 
such that Q is 10p  V q
wi Then
for any   0 there  1  0 small enough we have for all j  1 and x  s   X
0  V11 -geometrically ergodic Let w  max
0ip
Exhe0 Pj
wIk V q
0  V11Xj i  e0wj Excid2V q
 C e0wjV q
0  V11 Xjcid3
0  V11 x 
where in the last inequality we used E-1 and thus the constant C only depends on
 1 Let now m l  1 and write m  nl  j with j  0     l Then using 532 the
Holder inequality and 532 again we get
0  V11 Xnli
wIkli V q
e0 Pn1
wIk V q
wIk V q
0  V11 Xmi
Exhe0 Pm
 C e0wj Exhe0 Pnl
 C e0wj Ex l
 C e0wj   l
Exhel 0 Pn1
 C e0wj   l
C e0wli Exhel 0 Pn1
 C2e20wl   l
Exhel 0 Pn1
wIkli V q
0  V11Xnl
0  V11 Xnli1l
wIkli V q
0  V11 Xn1lii1l
wIkli V q
0  V11Xn1lii1l
Applying 28 Theorem 1501 Q has a unique invariant probability measure  and there
exists R  0 and   0 such that for all i  0     p s  Zq
 and all
positive integer m
 and   Rp
where for any signed measure  on 0     p  Zq
k Qmi s   k1  R em V q
  Rp
kk1  supcid8g  kg10p  V q
0  V11 k  1cid9 
0 s V11  
 we set
Dene
wi s   el0wiV0sV11  
for all i s   0     p  Zq
  Rp
 Then
Thus 535 yields that for all i s   0     p  Zq
cid13cid13w10p  V q
0  V11 cid13cid13  el0w 
  Rp
Qli s  w  w  R el el0w V q
0 s V11 
Now by dominated convergence we have as a  0
which is negative by Condition E-2 Hence there exists a  0 such that
cid16a1hexpaw  1Zq
cid17 
  1icid17  cid16w  1Zq
cid17  1 
b  cid16expaw  1Zq
Now by dominated convergence we may decrease  so that  1  0  implies
w  b12 for all l and 0 satisfying l0  a Then we have for these a and  1
which set the values of R and  and for all l and 0 satisfying l0  a
Qli s  w cid16b12  R el eawcid17 V q
0 s V11  
We now denote by L some integer such that b12  R el eaw  b14 for all l  L Then
provided that l0  a and l  L we get
Qli s  w  b14V q
0 s V11  
Using this bound by successive conditioning we get that for all n  1 and all 1  j  l
and x  s  if l0  a
wIkli V q
Exhel 0 Pn1
 bn14Exhel 0wIi V q
 C ea wi bn14 V q
0  V11 Xn1lii
0  V11 Xii
0  V11 x 
where in the last inequality we used el 0wIj   eaw and Condition E-1 and thus C is
some constant not depending on n Inserting this in 534 we get for m  nl  j with
j  0     l and if l0  a with l  L
Exhe0 Pm
wIk V q
 C3e3 a w bn14 V q
 C3e3 a wb12 bm4l V q
 C3e3 a wb12 b0 m4a V q
0  V11 Xmi
0  V11x
0  V11x
0  V11 x
Now this bound holds for any 0  al with l  L where the constants a and b are
chosen so that 537 holds and L only depends on a b  and 1 This yields 531 by
taking   0 such that e  b14a Note that we have shown that 531 holds for all
0  0 aL but only if a0 is an integer Nevertheless it is easy to show that this can
be extended to all 0  0 
0  by choosing  and 
0 adequately
If q  1 in Proposition 55 then we only need to prove Condition C for the chain
Q1 which then corresponds to q  0 that is V q
00  1 Hence an immediate conse-
quence of Lemma 56 is that if q  1 in Proposition 55 Condition C is implied by the
geometric ergodicity of the unconstrained chain Q see Section 24 and a simple moment
condition on the stationary distribution  of this chain see E-2
However for q  2 Lemma 56 is no longer sucient to prove Condition C of
00 in the denominator of 531 Again we
Proposition 55 because of the presence of V q
shall rely on an inductive reasoning to obtain the following result
Lemma 57 Let p q  1 Let In Sn n n  0 be the Markov chain on the space
0 1     p  Zq
 with transition kernel Q dened in Section 24 For any J 
1     q further dene the transition kernel QJ  on the space 0     pZqJ
as in Section 24 Let w  0 1     p  R Suppose that for any subset J in 1     q
the transition kernel QJ  satises Assumptions E-1 and E-2 Then for all 1  0
small enough there are positive constants 0 and 
  Rp
0  0 such that for all 0  0 
sX
Exhe0 Pm
k1 wIk0 V11 m  i   
Proof We prove this lemma by induction on q
For q  0 Lemma 56 holds with V q
enough with some 0 
initiates the induction
0  1 which implies 539 for all 1  0 small
0 only depending on 1 This provides the case q  0 which
result holds for lower values of q
Next we show the result in the case q  1 using the induction hypothesis that the
Dene for any j  1     q Aj as in 528 and
sj  1  maxAj
and s  max
j1q
sj 
If x  s   X is such that
s  A  1     s1    1     sq 
then applying Lemma 56 for all 1  0 small enough we can choose     0 such
that for all 0  0  there is some constant C0  0 such that for all m  1
0  V11 Xmi
wIkV11 mi  Exhe0 Pm
Exhe0 Pm
wIkV q
 C0 e0m V q
 C0 eqs e0m V11 
0  V11 x
We denote by  the rst hitting time of the set A
  infcid8k  0 Sk  Acid9
and we set m    m which is a stopping time with respect to the ltration Fk 
Yn 0  n  k k  0 We dene by Jm the set of indices j such that Skj stay away
of Aj for all k  0 1     m which is a random set measurable with respect to Fm and
is non-empty by denition of m By denition of m we have in the event m  m
Sm  A and thus by 540 setting C1  C0 eqs
Ehe0 Pm
km1
wIkV11 mFmi  C1 e0mm V11m
On the other hand up to n  m the chain Xn with transition kernel Q coincides with
the chain with transition kernel QJm that starts at the same state where Jm is dened
as above Hence we may write for all integer l  1 2     m all non-empty subsets J of
1     q and x  s   X satisfying s  A
Exhe0 Pm
wIke0mm V11 m 1mlJmJ i
 EJ xhe0 Pl
 e0ml EJ xhe0 Pl
w Ike0ml V11 l 1mlJmJ i
w Ik V11 li 
where  In Sn n n  0 here denotes the chain with transition kernel QJ  which
starts at the same state as I0 S0 0 Using the induction hypothesis if 1  0 is small
enough there are positive constants  and  such that for all 0  0  x  X and
l  1
EJ xhe0 Pl
w Ik V11 li  C2 e0 l V11 
for some constant C2  0 independent of l and x Inserting this bound in the previous
display and summing over all l  0 1     m and J  we get for all 0  0  and
x  s   X such that s  A
Exhe0 Pm
wIke0mm V11 mi  C3
e0ml0 lV11 
 C3 m e0mV11  
where C3  0 is independent of m and x This last bound with 541 yields for all
0  0    and x  s   X
Exhe0 Pm
wIkV11mi  Exhe0 Pm
wIkEhe0 Pm
wIkemm V11mi
 C1 Exhe0 Pm
 C4 m em V11  
wIkV11mFmii
km1
where C4 is some positive constant independent of m and x Now taking 
0  0    we get 539
Theorem 58 Let p q  1 and suppose that Assumptions 1 and 2 hold Let In Sn n n 
0 be the Markov chain on the space 0 1     p  Zq
 with transition kernel Q de-
ned in Section 24 For any J  1     q further dene the transition kernel QJ 
on the space 0     p  ZqJ
 as in Section 24 Dene
0    
  Rp
J ij
for all i  1     p
for i  0
wi 
is 101p  V qJ 
Suppose that for any subset J in 1     q the transition kernel QJ  satises
B-1 For all   0 small enough there exists   0 such that for all   0  QJ 
B-2 The stationary distribution J  of QJ  satises J hw  1Zq
Then for all 1  0 small enough there exists 
transition kernel Q is 101p  V q
00  V11 -geometrically ergodic
i  0
0  0 such that for all 0  0 
 V1 -geometrically ergodic
0  the
In practice Theorem 58 should be applied by induction so that only Conditions of
the form B-2 have to be checked out The case q  0 is treated in Proposition 33
We treat the case q  1 in the following section Then we explain in Section 35 how to
perform this induction for q  2
Proof of Theorem 58 By Conditions B-1 and B-2 we may apply Lemma 57 to show
that Condition C of Proposition 55 holds Hence applying this proposition we get the
drift condition 525
The small sets of Theorem 31 are of the form 1     Kq  0 M p Observe that
the sublevel sets of V q
00  V11
C01r cid8x  Z  Rp
  V q
00  V11x  rcid9 
r  0 
are included in such sets Hence the drift condition 525 applies to show that the
chain Q is V00  V11 -geometrically ergodic see 28 Chapter 15 The fact that Q is
10pV00V11-geometrically ergodic follows as in the proof of Proposition 33
Proof of Theorem 37 This result is obtained by induction on q using Theorem 58 and
Theorem 35 to initiate the induction at q  1
z A  B  c0ZA
ec1tdt Qmy B
 c0c1A  B 
56 Proof of Corollary 38
We rst show that for all D  0 K  1 and M  0 the set C  0 D  0     p 
1     Kq  0 M p is a petite set By Corollary 54 there exits m  1   0 and a
probability measure nu on Y such that 0     p  1     Kq  0 M p is an m  
and m  1  -small set for Q For all z   i s   C under the initial condition
Z0  z we have m1  0 M  m  1p
It follows that the density of m is
bounded from below by c0em1c1t over t  R for some positive constants c0 c1 see
the proof of Lemma 51 We get that for all Borel sets A  R and B  Y
where we used that 0     p1     Kq0 M p is an m  -small set for Q and  is
the probability measure dened by AB ZA
c1ec1tdt B Hence C is an m  -
small set for Q Similarly we have that is also an m  1  -small set Therefore we
conclude that Q is -irreducible and aperiodic and that all bounded subsets of Z are petite
Next we show that the drift condition obtained in Proposition 55 for Q extends to Q
As explained in Section 35 the assumptions of Theorem 37 imply that of Theorem 58
and thus of Proposition 55 see the proof of Theorem 37 Hence for all 1  0 small
enough there exists 
0  such
that for any initial condition x  X we have
0  0   0 1 b  0 and m  1 such that for all 0  0 
h QmV00  V11 i x   V00  V11 x  b 
By the Cauchy-Schwartz inequality and using that for all x  X m is stochas-
p 01 see the proof of
tically smaller than an exponential distribution with mean 1T
Lemma 51 we have
V22  10p  V002  V112 i x
cid16E
cid18Z 
V222 mcid1712cid16h Q
p 0cid1 e22re1T
cid01T
p 0rdrcid1912
10p  V00  V11 i  i xcid1712
 V00  V11 x  b12 
Provided that 2  1T
p 02 we thus get
V22  10p  V002  V112 i x
Hence for 2  0 small enough we have for some   0 1 and b  0
p 0cid112 h12 V002  V112x  b12i 
V22  10p  V002  V112 i x  V002  V112x  b 
cid01  221T
Hence we obtain a drift condition with an unbounded o petite set function V22 
10p  V002  V112 The geometric ergodicity follows see 28 Section 15
57 Proof of Theorem 39
We need the following lemmas to complete the proof for this theorem Denote the number
of arrivals on 0 u by Nu  Ncid010u  10pcid1 and the time interval between the last
arrival before u and u by u  u 
Lemma 59 We have
u
E1
 as P 
Proof By denition of Nu we have
k  u 
Since Q is positive Harris using 28 Theorem 1732 we get
n
k  E1  as P 
We deduce that
u
Hence the result
uPNu
k1 k
k1 k
uPNu1
 E1  as P 
Lemma 510 For all T  R we have
 01
 T  oPcid16Tcid17 
where as in the notation asP the subscript P in oP indicates that the result holds
for any initial distribution
Proof Let us dene
nT cid20 T
E1cid21 
By denition of u for all   0 1 we have that  T 
k1NT 1
For any   0 1   0 and T  R we get for all x  X
Pcid16 T  Tcid17  Pxcid18 max
k12nT
k  Tcid19  Px NT  1  2nT  
Using Lemma 59 we have lim
T 
Px NT  1  2nT   0 Observe that we have for all
k  1 k
intensity 1
 Ek where Eii1 are the inter-arrivals of a Poisson point process with
p  We get for all x  X
Pxcid18 max
k  Tcid19  lim
Ek  Tcid19  0 
Pxcid18 max
k12nT
k12nT
T 
T 
which concludes the proof
We now provide a proof of Theorem 39 using Lemmas 59 and 510
Proof of Theorem 39 For all t  0 1 T  R and x  X we have
cid0Nx10tT   w  tT Ewcid1 
wIk  Ewk  Ewx
We also observe that dening nT as in 543
wIk  Ewk  nT cid18 Nx
 gcid19  snT cid18 Nx
 gcid19 
where we used that by denition of Ew g  0 and that NtT is an integer Hence
by Lemma 510 we get
 oP T  
t01cid12cid12cid12cid12cid0Nx10tT   w  tT Ewcid1  snT cid18 Nx
 gcid19cid12cid12cid12cid12
Now by Lemma 59 we have for all t  0 1 Nx
tT nT  t as T   asP By the Dini
theorem this convergence holds uniformly over t  0 1 Applying 34 Theorem 1321
this convergence and the one in 315 implies that for any initial distribution
nT 2
g 12snT cid18 Nx
 gcid19 d Bt 
where the weak convergence holds in D0 1 This 544 2
nT T  1E1 yield 318 which achieves the proof
g  vw and the fact that
6 Conclusion
In this paper we have introduced and studied constrained multivariate Hawkes processes
The constraints are expressed using a multidimensional variable whose evolution is driven
by the point process Under the Markov setting exponential fertility functions we
have proven that the underlying Markov chain is V -geometrically ergodic under some
conditions on the parameters A converse result leading to the transience of the chain in
the case where an univariate spread variable is used q  1 illustrates the sharpness of
our conditions Moreover in the general case we used a functional central limit theorem
applying to the chain to derive the scaling limit of the integrated point process in physical
time Finally we have briey explained how the constrained multivariate Hawkes process
can be applied to model the dynamics of a limit order book The scaling limit of the
mid-price can be deduced from our ndings
We only presented the case of the order book of one asset with only two limits This
is clearly not a restriction Multi-assets limit order books can be considered yielding
multivariate boundary conditions hence q  2 In a forthcoming paper we will use this
model to provide an empirical study from real data and discuss the potential application
of this model to the dynamics of limit order books We believe that the applicability of the
constrained multivariate Hawkes process extends well beyond nancial applications as it
could model the motion of an object on a discrete net with some boundary conditions
7 Acknowledgements
This research is supported by NATIXIS quantitative research department
A Additional technical lemmas
The following result is used in the proof of Proposition 53
Lemma A1 Let p  1 and  is a pp invertible matrix Then there exists a probability
measure  such that for all M  0   0 there exists   0 such that for all g  Rp  R
and   0 M p
gu  udud  Z g d 
where D  u   0 1  0 1p 0  u  1    p
Proof Setting   u   we have
gu  udud 
det Z gu
1Du 1  u1dud 
1   1  2    p  1  p p  1   is not empty
We choose any 0    1p  1 so that the open set B    0 1p   
Denoting B      B and setting
 
 min
1  max
i1p
0Mpcid12cid121icid12cid121
we have that for all u  0    0 M p and   B u 1  u1  D We
obtain that
gu  udud 
det ZB
g Z 
udu d
LebB1
  1 det 
Z gd 
where Leb is Lebesgue measure  is the uniform probability measure on B
The following result is used in the proof of Proposition 32
Lemma A2 Let   0 and   0 Then as a  
eaet1 tdt  0 
If moreover    then we have the following asymptotic equivalence as a  
eaet1 tdt 
Proof Setting   et we get
eaet1et
 dt 
ea1
 1d 
Letting a   by dominated convergence we get A1
Now we set   a  1 and obtain that
a Z a
 1d 
ea1
e1 
 1d 
Letting a   we obtain A2 by dominated convergence
References
1 F Abergel and A Jedidi A mathematical approach to order book modeling SSRN
eLibrary 2011
2 Y At-Sahalia J Cacho-Diaz and RJA Laeven Modeling nancial contagion
using mutually exciting jump processes Working Paper 15850 National Bureau of
Economic Research mar 2010
3 S Asmussen Applied probability and queues volume 51 of Applications of Mathe-
matics New York Springer-Verlag New York second edition 2003
4 E Bacry K Dayri and JF Muzy Non-parametric kernel estimation for symmetric
hawkes processes application to high frequency nancial data Papers arXivorg
5 E Bacry S Delattre M Homann and J F Muzy Modelling microstructure noise
with mutually exciting point processes submitted to quantitative nance 2010
6 E Bacry S Delattre M Homann and JF Muzy Scaling limits for hawkes pro-
cesses and application to nancial statistics Preprint 2012
7 L Bauwens and N Hautsch Dynamic latent factor models for intensity processes
CORE Discussion Papers 2003103 Universite catholique de Louvain Center for Op-
erations Research and Econometrics CORE 2003
8 L Bauwens and N Hautsch Modelling nancial high frequency data using point
processes Social Science Research Network Working Paper Series nov 2006
9 B Biais P Hillion and C Spatt An empirical analysis of the limit order book and
the order ow in the paris bourse The Journal of Finance 5016551689 1995
10 JP Bouchaud J Doyne Farmer and F Lillo How markets slowly digest changes
in supply and demand ArXiv e-prints sep 2008
11 C Bowsher Modelling security market events in continuous time Intensity based
multivariate point process models Nueld College Economics Discussion Papers
nov 2002
12 C Bowsher Modelling security market events in continuous time Intensity based
multivariate point process models Journal of Econometrics 141876912 dec 2007
13 P Bremaud and L Massoulie Stability of nonlinear Hawkes processes Ann Probab
2415631588 1996
14 A Chakraborti I Muni Toke M Patriarca and F Abergel Econophysics review
I empirical facts Quantitative Finance 119911012 2011
15 A Chakraborti I Muni Toke M Patriarca and F Abergel Econophysics review
Ii agent-based models Quantitative Finance 1110131041 2011
16 R Cont and A De Larrard Price dynamics in a markovian limit order book market
Social Science Research Network Working Paper Series jan 2011
17 R Cont S Stoikov and R Talreja A stochastic model for order book dynamics
Oper Res 58549563 2010
18 D J Daley and D Vere-Jones An introduction to the theory of point processes Vol
I Probability and its Applications New York Springer-Verlag New York second
edition 2003 Elementary theory and methods
19 J Doyne Farmer L Gillemot F Lillo S Mike and A Sen What really causes
large price changes Technical report apr 2004
20 P Embrechts T Liniger and L Lin Multivariate hawkes processes  an application
to nancial data Journal of Applied Probability 48A367378 2011
21 E Errais K Giesecke and L R Goldberg Ane point processes and portfolio
credit risk SIAM J Financial Math 1642665 2010
22 T Fletcher Z Hussain and J Shawe-Taylor Multiple kernel learning on the limit
order book Quantitative Finance preprint 2010
23 C Gourieroux J Jasiak and G Le Fol
Financial Markets 23193226 aug 1999
Intra-day market activity Journal of
24 P Hewlett Clustering of order arrivals price impact and trade path optimisation
Workshop on Financial Modeling 2006
25 B Hollield R A Miller and P Sandas Empirical analysis of limit order markets
The Review of Economic Studies 71410271063 oct 2004
26 JH Large Measuring the resiliency of an electronic limit order book Journal of
Financial Markets 101125 2007
27 TF Liniger Multivariate Hawkes Processes PhD thesis ETH Zurich 2009
28 S Meyn and R L Tweedie Markov chains and stochastic stability Cambridge
University Press Cambridge second edition 2009 With a prologue by Peter W
29 I Muni Toke and F Pomponio Modelling trades-through in a limited order book
using hawkes processes SSRN eLibrary 2011
30 D Oakes The Markovian self-exciting process J Appl Probability 126977 1975
31 CA Parlour Price dynamics in limit order markets Review of Financial Studies
114789816 1998
32 I Rocu A dynamic model of the limit order book Review of Financial Studies
221146014641 2009
33 E Smith J Doyne Farmer L Gillemot and S Krishnamurthy Statistical theory
of the continuous double auction Quantitative Finance 3481514 2003
34 W Whitt
Stochastic-process limits
Springer Series in Operations Research
Springer-Verlag New York 2002 An introduction to stochastic-process limits and
their application to queues
35 B Zheng Detection devenements rares dans les donnees hautes frequences et appli-
cations au trading algorithmique PhD thesis Telecom ParisTech 2013
36 B Zheng E Moulines and F Abergel Price jump prediction in limit order book
SSRN eLibrary 2012
