Estimation of the Hawkes Process With Renewal
Immigration Using the EM Algorithm
Spencer Wheatley1 Vladimir Filimonov1 and Didier Sornette12
1Dept of Management Technology and Economics ETH Zurich
Zurich Switzerland
2Swiss Finance Institute co University of Geneva
July 29 2014
Abstract
We introduce the Hawkes process with renewal immigration and make its statis-
tical estimation possible with two Expectation Maximization EM algorithms The
standard Hawkes process introduces immigrant points via a Poisson process and
each immigrant has a subsequent cluster of associated ospring of multiple genera-
tions We generalize the immigration to come from a Renewal process introducing
dependence between neighbouring clusters and allowing for overunder dispersion
in cluster locations This complicates evaluation of the likelihood since one needs
to know which subset of the observed points are immigrants Two EM algorithms
enable estimation here The rst is an extension of an existing algorithm that treats
the entire branching structure - which points are immigrants and which point is
the parent of each ospring - as missing data The second considers only if a point
is an immigrant or not as missing data and can be implemented with linear time
complexity Both algorithms are found to be consistent in simulation studies Fur-
ther we show that misspecifying the immigration process introduces signcant bias
into model estimation especially the branching ratio which quanties the strength
of self excitation Thus this extended model provides a valuable alternative model
in practice
Keywords Expectation-maximization algorithm Branching process models Re-
newal Cluster process models Point process models non-parametric estimation
swheatleyethzch
vlimonovethzch
dsornetteethzch
Introduction
The Hawkes process Hawkes 1971ba is a linearly self-exciting conditional Poisson
point process It can be mapped onto a a branching process in which initial immigrant
events can produce subsequent ospring events Further all realized ospring may pro-
duce ospring in the same way Thus each immigrant along with its multi-generational
tree of ospring forms a cluster This model has attracted a lot of attention since it par-
simoniously combines exogenous activity immigration with endogeneous self exciting
dynamics ospring
The seminal application of the Hawkes model was within seismology Kagan and Knopo
1981 1987 Ogata 1988 where its spatio-temporal marked extension is being successfully
used for modeling so-called triggered seismicity the self-generated aftershock sequence
after individual earthquakes see for instance review in Ogata 2013 Recent applications
include modeling genomic events along DNA Reynaud-Bouret and Schbath 2010 neu-
ral spike trains Krumin et al 2010 brain seizures Sornette and Osorio 2010 and the
spread of violence Lewis et al 2012 and crime Lewis and Mohler 2011a In nancial
and econometrical applications the Hawkes process is becoming the gold standard for
modeling high frequency uctuations of nancial prices see for instance Bowsher 2007
Bauwens and Hautsch 2009 Filimonov and Sornette 2012 Bacry et al 2012
In the theory of Hawkes processes the immigration process ie the location of clusters
is a Poisson process This implies that the cluster locations are independent In this form
the likelihood of the Hawkes model can be evaluated and thus Maximum Likelihood Esti-
mation MLE can be performed An extension of this model with inhomogenous Poisson
immigration Lewis et al 2012 may also be estimated by maximum likelihood
Poissonian immigration corresponds to exponentially distributed waiting times between
immigrants Here we introduce a natural extension the Hawkes process with renewal
process immigration The renewal immigration process like the Poisson process has iid
independent and identically distributed waiting times but with a general waiting time
distribution instead of the exponential distribution The exponential distribution has a
dispersion index value of one the ratio of the variance to the mean of interevent times
and is thus called equi-dispersed The renewal process can describe both under- and over-
dispersed immigration dispersion index less than and greater than 1 respectively For
instance with a Weibull waiting time distribution one obtains this exibility by intro-
ducing only one extra parameter relative to the Poisson process This exibility comes at
the cost of making the evaluation of the likelihood impossible thus making direct MLE
practically impossible
To the best of our knowledge there are no existing mathematical papers focused on this
Hawkes model with Renewal immigration and more generally for renewal cluster pro-
cesses and branching process with renewal process immigration There have been some
similar models proposed for applications in climatology but with either very restrictive
model assumptions or less desirable estimation properties In Cowpertwait 2001 a re-
newal cluster model was proposed for clustering of rainfall events In this model clusters
are separated from the end point of the last cluster to the starting point of the next
cluster by a renewal process Thus no overlap in clusters is allowed which is a severe
assumption in many applications This simplication makes maximum likelihood estima-
tion easy Further using Bartlett-Lewis type clustering Cox and Isham 1980 only the
most recent generation point is fertile in this model That is the ospring are distributed
after their immigrant in a nite renewal process with random termination size In Salim
2003 a Bartlett-Lewis cluster process with renewal process immigration was considered
for clustering of rainfall events Introducing overdispersion into the immigration process
was motivated by the occasional observation of long periods without rainfall The authors
maximized a quasi-likelihood to estimate the model
In the present paper we propose a novel way to calibrate such generalized renewal Hawkes
processes using the Expectation Maximization EM algorithm Dempster et al 1977
We show that the problem of missing data the branching structure which is neces-
sary for the derivation of the complete data likelihood function can be easily addressed
within the EM approach The EM algorithm has already been used for the estimation of
the standard Hawkes process
Marsan and Lengline 2008 Veen and Schoenberg 2008
Lewis and Mohler 2011b Here we extend this approach to the case of renewal process
immigration and introduce another EM algorithm with a reduced set of missing data
The structure of the paper is as follows Section 2 presents the general structure of the
standard Hawkes process with Poisson immigration together with the Hawkes process
with renewal immigration Section 3 introduces the complete data EM algorithm for
the estimation of Hawkes process with renewal immigration Section 4 introduces the
semi-complete data EM algorithm using a minimal set of missing data
In Section 5
the computation of likelihood and performance of goodness of t tests for estimates of
the Hawkes model with renewal immigration are discussed Section 6 presents results of
Monte Carlo studies of the complete data EM algorithm including starting point selection
non-parametric methods consistency model selection and robustness of branching ratio
estimation under immigrant process misspecication
In Section 7 the semi-complete
data EM algorithm is shown to be a computationally ecient method for the estimation
of the Hawkes process with inhomogeneous Poissonian immigration In section 8 we con-
clude with a discussion on the signicance and relevance of our ndings and directions
for further research
2 The Hawkes Process With Renewal Immigration
Consider a sequence of random event times TiiN such that Ti  Ti1 with inter-
event waiting times Wi  Ti  Ti1 This sequence denes an univariate point pro-
cess with counting process Nt  Pi 1tit Denote a realization of the point process
t1n  t1     tn on 0 r with stopping time r where n  Nr When necessary we
denote the history of the process Ht  t1     ti  ti  t on time window 0 t A
point process Ti can be dened by its conditional intensity tHt which is the in-
stantaneous conditional probability of an event occurring Daley and Vere-Jones 2003
The compensator of the point process is the expected value of the counting process at
time t tHt R t
0 sHsds  ENtHt
The Hawkes process Hawkes 1971ba is a self-exciting conditional Poisson process with
the following linear conditional intensity function Hawkes 1971ba
tHt    tHt
where   0  is the background intensity and the conditional self-exciting term is
tHt where
tHt  Xitit
The function ht  tN t is the intensity of an inhomogeneous Poisson process originat-
ing at each observed point ti It is also called the memory kernel The function h
ht  ti
0 1
Figure 1 Illustration of the conditional intensity functions for I the Hawkes process 1
and II the Hawkes process with over-dispersed renewal process immigration 3 The
dotted line represents the intensity of immigration and the solid line corresponds to the
total intensity The arrows indicate parenthood and the numbers in parentheses indicate
the generation of ospring
is the ospring density a pdf probability density function only giving mass to positive
support The parameter  is the branching ratio a non-negative constant determining
the strength of self-excitation
The Hawkes process can also be considered as a branching process  is the immigra-
tion intensity and ht  tN t is the ospring intensity  an inhomogeneous Poisson
process triggered by each observed point The branching ratio  is the expected number
of ospring of each point and the ospring density provides the law for the parent-
child inter-event times Due to the autoregressive nature of the process
it becomes
non-stationary for   1 the case   1 is borderline stationary with non-standard
scaling properties Saichev and Sornette 2014 The branching process is constructed
as follows the Poissonian immigration process T 0
i  introduces immigrant points into
the zeroeth generation each immigrant generates a subsequent ospring process which
introduces rst-generation ospring events T 1
i  each ospring may introduce second-
generation ospring T 2
i  in the same way and so on over many generations The
union of the immigrants and ospring of multiple generations denes the Hawkes process
T 0
i       Further by summing the mutually independent immigration and
ospring intensities one recovers the conditional intensity 2 A realization of this con-
ditional intensity is in the top panel of Fig 1
i   T 1
The standard denition of the Hawkes process 1 assumes constant or time-varying
but deterministic immigration intensity t or in other words a Poissonian immigration
process T 0
i  Here we extend the denition by introducing the Hawkes Process with
Renewal immigration For this we allow the immigration process T 0
i  to be a general
Renewal process where waiting times Wi  0 are iid from some pdf gw that is not
necessary exponential The conditional intensity of this process is then given by
tHt INt  t  tIN t  tHt
where we have dened the index function for immigrants
INt  k  1     Nt 
which provides the point index k of the most recent immigrant event tk before t in the
Hawkes realization t1n The conditional intensity of ospring  is given by the same
equation 2 and the intensity w of the renewal immigration process is dened with
w 
1  Gw
where Gw R w
0 gsds is the CDF cumulative distribution function of waiting times
Wi The density g may be expressed using expression 8 below Constant intensity
then corresponds to a Poisson process with exponentially distributed inter-event times
that are equi-dispersed and a strictly decaying intensity will provide a sub-exponential
distribution of inter-event times that are over-dispersed The intensity t integrates to
innity and thus the process does not go extinct A realization of this process together
with renewal immigrantion is presented in the lower panel of Figure 1
Where an immigrant together with its associated ospring form a cluster the Hawkes
process is a Poisson cluster process and the Hawkes process with renewal immigration
is thus a Renewal cluster process Thus the model 3 introduces nearest neighbour
dependence into the location of clusters allowing for both under- and over-dispersion in
the immigration process itself In some sense the over-dispersed renewal process having
one step memory can be considered as the simplest case of a self-exciting process
Thus the Hawkes process with renewal immigration is a step towards a model with two
stages of self excitation
A challenging aspect of this model is the estimation procedure The general form of the
log-likelihood of a realization t1n on 0 r is given by Daley and Vere-Jones 2003
log L t1n 
log tiHt  rHt
where  is the parameter vector of the model Maximizing this log likelihood 6 with
respect to  has the interpretation of maximizing the intensity at observed points and
minimizing intensity where no points are observed For the standard Hawkes model the
conditional intensity 1 can be evaluated and thus MLE can be performed For the
Hawkes process with renewal immigration to evaluate the intensity 3 and thus the
likelihood 6 one needs to know which events are immigrants Since this information
is unobserved all events  immigrants and descendants  are identical direct MLE
using 6 is not possible In order to account for this missing data in the following section
we will employ an Expectation Maximization EM algorithm
It is worth explaining the structure of the likelihood as the details are relevant in the
following sections The likelihood 7
L t1n  f t1n Pr Nr  Ntn  0t1n 
is the product of the joint inter-event time density and the probability that no events
occur between the last point and the stopping time The joint inter-event time density
within 7 can be factored into a product of conditional Poisson marginal inter-event time
densities
ftHt  tHtexp Z t
sHsds 
which is the conditional probability of observing a point at t times the probability of no
points between the previous point tN t and t For an inhomogeneous Poisson process the
density 8 becomes unconditional and for a homogeneous Poisson process it becomes
an exponential density
3 Complete Data EM Algorithm for the Hawkes Pro-
cess with Renewal Immigration
31 General description of EM algorithms for Hawkes processes
An Expectation Maximization EM algorithm rst introduced in Dempster et al
1977 is an iterative algorithm for performing MLE in the presence of missing data that
if known would simplify the likelihood Consider the complete data likelihood function
L X Z that has an explicit form for known sets of observed data X and missing data
Z Set X together with set Z forms the complete data Maximization of log L X Z
with respect to  then results in parameter estimates When Z is unknown one can
account for the missing data probabilistically using the following iterative procedure
First one needs to guess the initial parameter estimates 
 Then each mth iteration
consists of two steps Given the estimates of parameters 
in the expectation E step
one needs to calculate the expected value of the complete data log-likelihood with respect
to the conditional distribution of missing data Z given the observed data X and current
estimates of parameters 
QX 
  EZX 
mh log L X Zi
The conditional expectation 9 requires the derivation of the conditional pdf f ZX 
which is nothing more than the likelihood function for estimation of missing data Z
given 
and X In the maximization M step the expected likelihood 9 is maxi-
mized to obtain new estimates of parameters 
 arg max
QX 
The algorithm then proceeds by iterating the E and M steps until the parameter estimates
stabilize With each iteration parameter estimates are guaranteed not to make the
observed data likelihood worse Dempster et al 1977
An EM algorithm for the Hawkes process was identied in Marsan and Lengline 2008 and
formalized in Veen and Schoenberg 2008 Lewis and Mohler 2011a In particular this
EM algorithm has had strong convergence results proven and tested Lewis and Mohler
2011a and in practice converges in less than 50 iterations given sensible initial parameter
estimates Here this algorithm is extended to the case of Renewal process immigration
and an algorithm with a reduced set of missing data is also presented in Section 4
For the case of the Hawkes process with renewal immigration X is given by t1n and
unobserved data Z is given by the branching structure of the process which contains
information of i immigrant events and ii parenthood of ospring events see Figure 1
This branching structure is typically described with the lower-triangular matrix Z nn with
diagonal elements Zii  1 if point ti is an immigrant and Zii  0 if not and sub-diagonal
elements Zij  1 j  i if point tj is direct parent to point ti Since a point can be either
an immigrant or an ospring of a single parent then each row of the matrix has only one
unit element and the rest of the entries are zero
Consider the joint density f t1n Z nn  f t1nZnnf Z nn When the branching
structure Z nn for the self-excited Hawkes process with renewal immigrants 3 is known
the conditional density f t1nZ nn can be split into a product of marginal inter-event
time densities for independent inhomogeneous Poisson sub-processes ie densities of the
form 8
f t1nZ nn 
i1Yj1cid20ti  tje R ti
stj dscid21Zii1Iij nYi1
i1YjJicid20hti  tje R ti
hstj dscid21Zij
The rst term in square brackets is the immigrant inter-event time density g introduced in
relation with expression 5 and Ii is dened in 4 When a lag ti  tj j  i  1     n
is an immigrant inter-event time ie Zii1Iij  1 then g is evaluated at that lag
The second term in the square brackets is the ospring intevent time density When a
lag ti  tj j  i  1     n is a parent-child inter-event time ie Zij  1 then the
ospring inter-event time density is evaluated at that lag To avoid undened values
of 11 the ospring inter-event time density is only evaluated at lags within the support
of the ospring density h This is done by dening this index function
Ji  minj  1     i  1  hti  tj  0
that takes the index i  1     n of point ti and returns the index of the most distant
previous point tj with ti in the support of its ospring density ht  tj This issue is not
present for g since the immigration intensity never vanishes
Following 7 the complete data likelihood L t1n Znn is constructed as a product of
the joint pdf of observed events f t1n Z nn and a compensator term which accounts for
the probability of observing no event after the last event in each independent subprocess
Thus after substituting 11 into 7 and rearranging the complete data log-likelihood
of the Hawkes process with renewal immigration is written as
log L t1n Znn  log fZnn 
i1XjJi
Zii1Iij log ti  tj 
 nXi1
i1Xj1
Zij log hti  tj Z r
1IijZ ti
n1Xi1
i1Xj1
sHsds
s  tjds 
For compact notation in 13 we have also denoted t0  0 as the starting time and
tn1  r as the stopping time Neither of these points are included in the sample As
it is seen the complete data log likelihood is decoupled into a sum of independent terms
for ospring and immigrant processes in square brackets Thus for a given branching
structure Z nn the estimation of parameters  for the model amounts to independent
estimation from iid independent and identically distributed samples of immigrant inter-
event times and parent-child inter-event times respectively
The following subsections describe the E step and M step for the corresponding EM-
algorithm that accounts for the unobserved branching structure Znn
 log hti  tj Z r
sHsds
mh log L t1n Z nni 
i1XjJi
PrZij  1t1ib
 nXi1
i1Xj1
PrZii1Iij  1t1ib
n1Xi1
i1Xj1
PrIi  jt1ib
 log ti  tj
s  tjds 
32 E Step
The E step involves evaluating the Q function 14 which is the expected value of the
complete data log-likelihood 13 given the observed data t1n and previous estimates of
parameters 
Qt1n 
  EZ nnt1n 
where we have omitted the expectation of the rst term in 13 which is constant with
respect to  and is thus irrelevant to the determination of the parameters 
To compute 14 the missing data Z nn should be dened probabilistically We denote
the probability weights as
ij  PrZij  1t1i
weights sums to one Pi
and introduce the abbreviation i  ii for immigrant probabilities By denition the
j1 ij  1 i  1  n The rst event i  1 has 1  11  1
and is thus an immigrant The second event i  2 has 22  21  1 and thus can
either be an immigrant or an ospring with the respective probabilities Each next event
has one more parameter in the probability distribution than its predecessor All these
probabilities for the n observed points can be presented as a lower-triangular matrix nn
that is at each iteration of the EM algorithm equal to the expected value of the branching
structure matrix
nn  EZ nnt1n 
Finally we denote conditional probability weights ijk  PrZij  1t1i Ii  k j  i
that are abbreviated ik  iik for immigrants In this notation probabilities in 14
can be written in the form
PrZij  1t1i  ij
PrIi  jt1i  ij  j j1j    i1j
PrZii1Iij  1t1i  PrIi  jt1iij  ijij
where we have introduced weights ik and the bar denotes the complementary probabil-
ity ijk  1  ijk The rst line of 17 is just the denition 15 The second line
denes the probability that j is the last immigrant in the series of i events up to time ti
as the product of the probability j that j is an immigrant times the probabilities that
all following events are not immigrants conditional on j being an immigrant The third
line denes the probability that j is the last immigrant before immigrant i in the series
of i events up to time ti
To derive the probability weights ij dened by 15 we will exploit the branching struc-
ture of the Hawkes process with Renewal immigration 3 which consists of a superposi-
tion of independent subprocesses According to the thinning property Daley and Vere-Jones
2003 that was originally exploited for a similar purpose of stochastic declustering
in Zhuang et al 2002 the probability that an observed event ti comes from one of the
subprocesses is equal to the proportion of the subprocess conditional intensity at ti in
the total conditional intensity at the same time ti
Conditional probability weights ijk can be calculated using the complete data conditional
intensity 3 where the immigrant events t0
i  are known To derive unconditional prob-
ability weights ij one needs to introduce the incomplete data conditional intensity
tiHti  tiHti  tiHti
where the incomplete data conditional intensity of immigration tiHti is a weighted
mixture of immigrant intensities
tHti 
N tXj1
N tj  t  tj
with weights N tj 17 equal to the probability that the event j at time tj is the most
recent immigrant before tN t
Finally the estimation of probability weights for given observed data t1n and parameters
can be written in the following form
ij 
tiHti
tiHti  tiHti
hti  tj
tiHti  tiHti
ik 
ti  tk
ti  tk  tiHti
k  i  2  N
ijk 
hti  tj
ti  tk  tiHti
j k  i i  2  N20
Probability weights  and  which enter the Q function 14 can be jointly computed in
a recursive way iterating over all observed events For each event i at time ti we denote
the probability weight vectors i  i1     ii and i  i1  ii1 The rst
event is set to be an immigrant 11  1 21  1 Looking at the weight vector makes
the recursive relation clear
    i1cid1
i  cid0121    i11 
 cid0cid0i1  i11  i1j  i1i2cid1  i1cid1
    j j1j    i1j 
This recursive equation 21 expresses that the weight vector i is the Hadamard product
eg a bc d  ac bd of the previous weight vector i1 and a vector of complement
probabilities and with i1 concatenated on the end of the product That is taking the
weight vector i discarding the last element from the vector and then removing the last
 probability weight from each remaining element of the vector one obtains the previous
weight vector i1 Having the weight vector i1 then makes it possible to compute the
necessary  probablility weights using 20 to compute the next weight vector i This
iteration is done for i  2     n producing all necessary probability weights for the E
33 M Step
After the estimates of probability weights  and  for the given estimates of parameters
and observed data t1n are obtained one can maximize the expected complete data
log-likelihood Q function 14 with respect to the parameter vector  to obtain new
estimates 
 However rather than perform multivariate optimization of 14 one can
exploit the decoupling of the immigrant and ospring terms in 14 Decomposition of
the Q function 14 into the expected log-likelihood of the immigration process intensity
 and the ospring process intensity h allows one to estimate the two processes
independently when they do not share any common parameters
By recalling the form of an inter-event time density for an inhomogeneous Poisson process
8 it can be seen that the M step estimation of the immigration process intensity 
 ie maximization of the expected complete data log-likelihood presented in the second
square brackets in 14  is simply the maximization of the expected complete data log-
likelihood for the inter-event times t0
i1 of the inter-event time density gw g with
parameter vector g
i  t0
g  arg max
i1Xj1
ijij log gti  tj g
sample With the determination of the estimate bg the immigrant in-
where the weights ijij denote the probability PrZii1Iij  1t1i that tj and ti are
immigrants with no other immigrant events between them as dened by expression 17
In other words expression 22 is the maximum likelihood density estimation with a
weighted iid
tensity can then be computed using 5 A non-parametric estimate of the density is
possible but numerical stability issues arise when computing the estimate for  as the
denominator becomes very small
Estimation of the ospring intensity requiring maximization of the expected complete
data log-likelihood presented in the rst brackets in 14 is perfomed by separately esti-
mating the branching ratio  and the ospring density h
The explicit MLE for the branching ratio parameter  can be obtained by analytically
maximizing 14 with respect to 
i1Pi1
b  Pn
j1bij
i1 bHr  ti
where H is the CDF Ht R t
n Pn
i1bi
i1 bHr  ti
0 hsds The estimated branching ratio 23 is the ratio
of the expected number of ospring to a number which is slightly smaller than the total
number n The denominator inates the estimate of the number of ospring in the
nite observation window to account for unobserved ospring expected to occur after the
stopping time r Saichev and Sornette 2006 2007 Sornette et al 2008
Estimation of the ospring density ht h parameterized by h is density MLE with an
iid sample with sample weights
h  arg max
i1XjJi
ij log hti  tj h
where the sample weights ij are the probability that tj is parent to ti 20 Non-
parametric estimation of the ospring density h is straight-foward for example assum-
ing it to be a piecewise-constant function on intervals of length  The estimator is then
given by
i1Xj1
bht 
ij1titjt2t2
34 Computational Eciency  Approximations
sample size eg the expected number of ospring points nh  n Pn
In the proposed EM algorithm one needs to store On2 probability weights and
inter-event times for the estimation of the ospring density from iid data as shown from
expression 24 Estimation of the immigration density 22 and the branching ratio 23
only require the immigrant probabilities ie On probability weights and inter-event
times One approach to address the quadratic complexity of the estimation of h is to
consider a reduced set of missing data This is done in the following section However
within the current algorithm there are two approaches that may be taken to speed up
the estimation of h
The rst one is a Monte Carlo approach which works as follows Choose an eective
i1 i take
a sample with replacement of size nh from all positive inter-event times ti  tj j 
i  1     n where the probability of selecting an inter-event time is proportional to
its corresponding sample weight ij Then estimate h on this unweighted sample
In 25 and other simple non-parametric density estimation techniques the inclusion of
sample weights is easy However this approach also allows for other non-parametric
techniques where considering sample weights is not as natural Thus more complicated
and potentially less suitable non-parametric estimation methods  for example choosing a
smoothness penalty for the estimate and solving for the estimate using variational calculus
as in Lewis et al 2012  should not be necessary
The second approach assumes that the ospring density has nite memory ie a nite
support with upper endpoint tf  Then take nf  maxNti  Ntj  ti  tj  tf 
to be the largest number of points observed within the support of the density Thus the
E step and M step only need to be performed on lags ti  tj i  1     n j  max1 i 
nf      i  1 This reduces the memory requirements and computational complexity
from On2 to Onnf  with nf  n without introducing error into the procedure Taking
nf too small will bias downward the estimation of the branching ratio  this is clear
from 23 where the denominator will be too large However for Hawkes processes with
light tailed ospring distributions this may provide a good approximation Further nf
may be adaptively chosen at each iteration of the EM algorithm as one obtains an idea
on which support most of the mass is distributed
4 The Semi-Complete-Data EM Algorithm
In this section an alternative EM algorithm with a reduced set of missing data is
proposed It may be used for more computationally ecient estimation of the Hawkes
process with renewal process immigration It may also be used to estimate the Hawkes
process with deterministic inhomogeneous Poissonian immigration intensity t  the
most ecient implementation allowing this to be done in linear time see Sec 7
Instead of the missing data being the entire branching matrix here it is reduced to
only the diagonal elements diagZ nn  Ziii1n ie it is reduced to the indicator
variables for if a point is an immigrant or not This is abbreviated by Z 1n and called
the immigrant vector Thus given the semi-complete data t1n Z1n the semi-complete
data log-likelihood 26 may be written
log L t1n Z 1n 
1  Zi log tiHti Z r
i1Xj1
Zi1Iij log ti  tj 
sHsds
n1Xi1
i1Xj1
1IijZ ti
s  tjds
The derivation is similar to that of the complete data log-likelihood 13 Here immi-
gration and ospring processes are separated but the ospring processes are not decou-
pled from each-other unlike in 13 where they are decoupled The Q function follows
by taking the expectation of 26 with respect to Z 1n given the observations and pa-
rameter values The full expression is omitted for brevity its structure is already known
from 26 Because the parts of 13 and 26 concerning immigration are identical the
immigration part of Q is identical to the immigration part in 14 The ospring part will
be discussed shortly For the E-step the weights are computed using 20 except that
only the immigrant-specic probabilities i and pik are needed Thus the E-step memory
requirements here are On rather than On2 as in the complete data case Regarding
the M-step estimation of  will be the same as in the complete-data case 22 The
ospring density h and the branching ratio  will be jointly estimated by numerically
maximizing the part of the Q function concerning the memory kernel
bhb  arg max
h
1  i logXjtjt
hti  tj h Z r
0 Xjtjs
While this method is very useful for parametric estimation see Sec 7 the non-
parametric estimation of h will be dicult due to the fact that for example unit mass
and positivity must be enforced Moreover the ospring density must be evaluated at
On2 lags ti  tj The Monte Carlo approach proposed in Sec 34 cannot reduce the
computation here since ij j  i are unknown However the second trick of assuming
nite support of h can reduce the computation to Onnh Further using an exponential
ospring density or any linear combination of them a recursive relationship Ozaki 1979
reduces the complexity to On
hs  tj hds 27
Inference and Goodness of Fit
51 Computation of likelihoods and p-values
Computing likelihoods and performing goodness of t tests to obtain p-values for es-
timates of the Hawkes model with Renewal immigration requires evaluating the complete
data conditional intensity 3 Thus the immigrant vector Z 1n  Ziii1n  0 1n
must be known
As will be shown likelihoods and p-values must be computed for each immigrant vector
and aggregated In general there are 2n1 possible valid immigrant vectors the rst point
is set to be an immigrant Immigrant vectors are indexed as zi
1n i  1     2n1 where
1n  1 0    0 0 z2
the index i is one more than the decimal representation of the binary number in the im-
migrant vector excluding the rst element ie z1
1n  1 0    0 1
1n  1 0     1 0 etc To simplify computation a Monte Carlo approach can be
used where sample averages of likelihoods and p-values are taken Specically given the
probabilistic description of the branching structure obtained in the E step probability
weights 17 an ensemble of realizations of the immigrant vector may be generated
and likelihoods and p-values computed for each realization Ensemble average likelihoods
and p-values may then be taken A Monte Carlo study of the inferential power of these
statistics is conducted in Sec 6
52 Simulating the Immigrant Vector
One needs to simulate realizations z1n  z1     zn of the random variable Z 1n
with binary state space of dimension n For this an acceptance-rejection thinning type
algorithm Lewis and Shedler 1979 is used  Initialize by setting z1n  1 0     0 since
the rst point is treated as an immigrant Next for each following event ti i  2     n
Bernoulli random variables with probabilities i1 20 are generated and the rst success
is taken at i  k as the second immigrant so zk  1 then the third immigrant is
selected in the same way with probabilities ik i  k  1     n and so on This thinning
procedure is repeated until the stopping time r is reached resulting in a realization
z1n  za
1n where a  1     2n1 This procedure can be repeated l times and the
sample set aii1l contains the possibly repeating indices of the sampled immigrant
vectors
53 Likelihood
We now present a way to calculate a likelihood value for the Hawkes model with
renewal immigration This procedure is valid for both the complete and semi-complete
data EM algorithms The goal is to have a function by which Hawkes models with
and without renewal immigration may be compared in an objective statistical way To
accomplish this we treat the renewal process immigration as an inhomogeneous Poisson
process with deterministic intensity
jt  t  tIN tzj
which can be evaluated knowing the immigrant index vector zj
1n Thus plugging in the
Hawkes conditional intensity 1 with inhomogeneous Poisson immigration intensity 28
into the log-likelihood equation 6 and then transforming to a likelihood one obtains
the conditional incomplete data likelihood
L t1nzj
nYi1cid0jti  tiHticid1 expcid18Z r
js  sHsdscid19 
for the immigrant vector j By conditioning the incomplete data likelihood may then be
written
L t1n 
L t1nzj
1nPrZ 1n  zj
1n
which is a weighted sum of the conditional incomplete data likelihood 29 The weighting
probabilities in 30 may be computed by probabilities from the E step 17 However
2n1Xj1
this is computationally burdensome Instead a Monte Carlo approximation of the likeli-
hood 30 
L t1n 
Lcid16 t1nzai
1ncid17 
may be done with sampled immigrant vector indices aii1l The approximate log-
likelihood may be obtained by taking the logarithm of this average 31 One must be
careful with the implementation of these calculations as numerical precision issues may
be encountered in the averaging The logarithm of the incomplete data likelihood 30 or
its approximation 31 may be directly compared with the log-likelihood of the standard
Hawkes process 6
p-Values
To perform a hypothesis test for an estimated point process model one often does
residual analysis Ogata 1988 based on the time change property Papangelou 1972 for
point process TiiN with compensator tHt the set of transformed times  TiiN
Ti  TiHt are generated by a unit rate Poisson process Thus for an observed
realization t1n one can estimate its conditional intensity transform it to t1n and test
if the resultant process is unit Poissonian For instance one can test if the transformed
inter-event times are standard exponential distributed A popular Portmanteau-type test
for this is the Kolmogorov Smirno KS test Massey 1951 This test measures the
KS distance between the empirical transformed inter-event time distribution and the
standard exponential null distribution Under the null hypothesis the distribution of the
KS distance is known and thus a p-value may be computed
More generally dene the test statistic eg the KS distance as a random variable
S  ST 1n Z1n which under the null hypothesis has known reference distribution
F0 Here the observed test statistic St1n zj
1n transforms a realization of points t1n
1n For semi-complete data sets t1n zj
given the immigrant vector for those points zj
the null hypothesis H j
1n Then the
semi-complete data p-values are
is an event where the model is true for Z 1n  zj
pj  PrS  St1n Z1nH j
0   1  F0St1n zj
1n j  1     2n1
For the incomplete data set t1n the null hypothesis H0 is that the model is true The
test statistic for this St1n Z 1n is unknown because the immigrant vector is unknown
Thus by conditioning the incomplete data p-value is
p  PrS  St1n Z1nH0 
2n1Xj1
PrZ 1n  z1npj
which may be expressed in terms of the semi-complete data p-values 32 A Monte-Carlo
approximation of the p-value 33 may be done
paj 
by taking the average of the semi-complete data p-values having their indices in the
sampled set ajj1l
6 Monte Carlo Study of the Complete Data EM Al-
gorithm
In this section we discuss the convergence of the EM algorithm consistency the
power of the goodness of t test of Sec 5 and the robustness of Hawkes process estimation
in the case of mis-specication of the immigration process
61 Parametrization of the Hawkes process with Renewal immi-
We consider a particular type of renewal process for immigration namely a renewal
process whose inter-event durations W have a Weibull distribution with conditional in-
tensity
t 
t  0 
parametrized with the shape parameter   0 and scale parameter   0 In this case
the pdf of inter-event times W is given by
gw  w expcid18Z w
cid18w
cid191
expcid18cid18w
cid19cid19 
The case   1 for which the intensity 35 is constant corresponds to the standard
Hawkes process 1 with   1 When   1 the intensity decays implying that the
inter-event time density 36 is sub-exponential
In this case the immigration process
is over-dispersed in comparison with the respective Poisson process for   1 On the
other hand as    the inter-event density 36 weakly converges to a delta-function
gw  w   and the immigration process becomes deterministic with regular event
spacing 
For the ospring density ht we consider both the exponential pdf originally suggested
by Hawkes Hawkes 1971b
cid18 t
cid191
sdscid19 
with shape parameter 0  0 and the Omori-type heavy-tailed pdf Ogata 1988
hexpt 
expcid18
0cid19 1t0
hOmorit 
t  c1 1t0
with shift parameter c  0 and Pareto tail index   0
The exponential ospring density 37 which is typical for nancial and econometric ap-
plications Bowsher 2007 Bauwens and Hautsch 2009 Filimonov and Sornette 2012
Embrechts et al 2011 At-Sahalia et al 2011 ensures Markovian properties to the
model Oakes 1975 With respect to calibration it reduces the computational com-
plexity of evaluation of the log-likelihood from On2 to On by taking advantage of a
recursive relation Ozaki 1979 and is more robust to outliers than heavy tailed alter-
natives Filimonov and Sornette 2014 A heavy-tailed ospring density 38 is typical
for seismological applications Ogata 2013 where it accounts for the power law decay
of aftershock activity with time Omoris law  in the so-called Epidemic-Type Aftershock
Sequence ETAS models While the computational complexity of evaluation of the log-
likelihood is On2 and cannot be reduced in practical applications one can approximate
the power law 38 with a sum of weighted exponential functions Hardiman et al 2013
62 Starting Points Convergence  Nonparametrics
We now discuss the sensitivity to starting values the speed of convergence and the
use of non-parametric estimation in the complete data EM algorithm The EM algorithm
is iterative and requires starting parameter estimates Further EM algorithms in general
can get stuck in local optima and have a linear rate of convergence Dempster et al 1977
Thus selecting reasonable starting points and understanding the speed of convergence are
important However it was shown in Lewis and Mohler 2011a that the EM algorithm for
the standard Hawkes process is a projected gradient descent algorithm with superlinear
convergence But the speed of convergence worsens towards linear convergence as
clusters are increasingly overlapping This is intuitively clear as the branching structure
becomes less obvious as clusters overlap This was explored in detail in Sornette and Utkin
2009 A comprehensive study of this phenomenon will not be done for this extended
algorithm as new insights are not expected Instead a couple of illustrative examples are
Example I A realization of 1000 points of a standard Hawkes process 1   1  
08 h  02expt5 with high branching ratio was simulated Then the Hawkes model
with renewal immigration 3 was estimated on this data using the complete data EM
algorithm The initial parameter estimates were chosen to be very close to a pure Weibull
renewal process with parameters estimated by MLE   06   01 A small ospring
component was included in the initial estimate with uniform density on a large support
  005 ht  0010  t  100
Example II A realization of 1000 points of a Hawkes process with Weibull renewal
immigration 3 36   07   1   02 h  02expt5 with low branching
ratio is simulated Then the Hawkes model with renewal immigration was estimated
on this data using the complete data EM algorithm The initial parameter estimates
included Poissonian immigration a higher branching ratio and a uniform ospring density
  1   2   05 ht  0010  t  100
The results are shown in Fig 2 with example I in the top row and example II in the
bottom row The estimates of the parameters and the ospring density converge well
within 50 iterations however they do not become completely stable This is due to the
nonparametric density estimation discussed below Despite the convergence from poor
starting estimates for these dierent synthetic examples for analysis of real data the
authors recommend taking multiple starting points and keeping the best result
The local likelihood non-parametric density estimation technique implemented in
R as loct was used Loader 1996 This exible technique estimates the log density
using splines in a locally adaptive way The technique budgets function complexity only
allowing the estimated function to be complex in regions where the data suggests that
this is necessary  avoiding over-tting and over-smoothing However it still requires the
selection of a smoothing bandwidth parameter
If insucient smoothness is required
over-tting will occur The risk of over-tting is worsened by the iterative nature of
the algorithm But the loct method allows for an eective measure of the degrees of
freedom of the estimated function to be computed With this one can use eg AIC for
the estimated Hawkes model to select the smoothing parameter Sample weights were
considered by using the Monte Carlo method explained in Sec 34 Thus from iteration
to iteration the parameter estimates will never become completely stable
In the examples above only an exponential ospring density was considered for the data
generating process Heavy tailed sub-exponential ospring densities will be dicult
kkkkkkkkkkkkkkkkkkkkkkkkkkk
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
bbbbbbbbbbbbbbbbbbbbbbbbbb
kkkkkkkkkkkkkkkkkkkk
eeeeeeeee
bbbbbbbbbbbbb
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk
Iteration
Figure 2
Convergence of complete data EM estimates of the Hawkes process with
renewal immigration for simulated data Row I corresponds to example I and II to
example II The rst column provides the dierence between the estimated parameter and
the true value with parameters   and  being represented by k b and e respectively
The right column provides the estimated ospring density bh The starting value is the
dotted line and the true function is the bold dashed line Over iterations the estimated
functions solid lines become increasingly dark
to estimate non-parametrically For instance most non-parametric density estimation
techniques will estimate the tail poorly due to sparse observations The inclusion of
mass in the estimate beyond the data can be achieved only by requiring a degree of
smoothness from the estimated function However the assumption of high smoothness
will cause problems when estimating regions of the density with high curvature eg a
steep mode
If a heavy tailed density is suspected it may be worth starting with a
parametric density such as the Weibull 36
63 Consistency
This section discusses the bias and eciency of the Complete Data EM estimator for
the Hawkes process with renewal immigration 3
We have considered synthetic realizations of the process 3 with parameters  and  pre-
sented in Table 1 The Weibull shape parameter  was given values 05 075 1 125 15
ranging from highly over-dispersed to highly under-dispersed For each value of  the
scale parameter  was chosen such that the expected immigrant inter-event time was
equal to 10 ie  was given values in 5 84 10 107 111 The characteristic time 0
Table 1 Results of the EM estimation Section 3 of the Hawkes Process with Weibull
Renewal immigration 3 and exponential ospring density on synthetic data For each
combination of parameters this table presents the average bias and standard deviation
in brackets of estimates over 50 synthetic realizations
EN0 
b  
002 002
006 003
016 015
004 004
006 007
012 013
b  
055 074
170 132
089 213
b  
002 006
003 006
-004 005
b0  0
-005 204
-041 052
-046 051
101 122
116 152
-100 314
006 006
002 006
-005 005
031 151
-025 048
-052 037
002 005
-002 007
002 015
046 076
-066108
-158 299
003 004
-003 005
-004 005
171 297
-008 048
-028 060
-003 008
-006 011
-012 020
004 063
-069 121
-316 253
001 004
-004 007
-007 005
623 659
-005 059
-030 049
-006 009
-015 010
-029 026
-009 06
-079 109
-317 296
000 003
-003 006
-005 005
391 535
003 056
-036 042
of the exponential ospring density 37 was chosen to be 0  3
For each combination of parameters 50 independent realizations each of size 500 events
were simulated Ecient simulation was performed using the algorithm of Mller and Rasmussen
2005 which exploits the branching process formulation of the Hawkes process The model
parameters    0 were then estimated using the EM algorithm We intentionally
chose bad starting values for the estimation procedure to demonstrate the convergence
of the method we selected 0  1 the scale parameter 0 was chosen as the true value
 multiplied by a uniform random number in 025 4 the branching ratio 0 was chosen
as a uniform random number in 01 09 and the characteristic time of the ospring
density 0 was chosen as a uniform random number in 05 10
The bias and standard deviation of the estimates are presented in Table 1 In general
most parameters were well estimated especially the branching ratio  Due to the xed
sample size of 500 points when  is larger the expected number of immigrants EN 0r
is smaller Thus the bias and the variance of estimates of immigration process parameters
 and  are larger with larger  and are worst for   09 ie when the EN 0r  50
Another factor that introduces systematic error into the results is when  is large and
thus clusters are overlapping Intuitively it is clear that when clusters triggered by dier-
ent immigrant events signicantly overlap it is hard to discern the branching structure
Systematic studies have conrmed that both MLE and EM estimation of the Hawkes
process are indeed worse in the case of overlapping clusters Sornette and Utkin 2009
Lewis and Mohler 2011a However the bias decreases with increasing sample size
64 Model Selection
In this section we address the question of model selection when the immigration
process is unknown For this we simulate the Hawkes Process with Weibull Renewal
immigration 3 and exponential ospring density 37 and then test the null hypothesis
H0 that observed events t1n are generated with the standard Hawkes model with
Poisson immigration 1 versus the alternative hypothesis H1 that t1n are generated
from a Hawkes Process with Weibull Renewal immigration 3 In both models H0 and
H1 the ospring density is assumed to be exponential 37
We consider three statistical test i comparison of the AIC values of H0 and H1 ii
the Wilks likelihood ratio test with level 005 Wilks 1938 where H0 is nested in H1 and
iii the KS test of residuals transformed time events with level 005 for H0 discussed in
Section 5 The option iii is not a test of H0 against alternative H1 but the Portmanteau-
type test of H0 against the alternative hypothesis H1 that is loosely specied ie not
H0
The parameters for the process 3 35 were chosen as follows the Weibull shape pa-
rameter  was given values 05 075 1 125 15 and other parameters were not swept
taking values of   1   06 and 0  03 For each combinations of these param-
eters we have simulated 100 independent realizations of size 250 500 750 and 1000
events Then both models were estimated on each sample the true model 3 which
corresponds to H1 is estimated using the complete-data EM algorithm and the misspeci-
ed model 1 which corresponds to H0 is estimated using straightforward maximization
of the log-likelihood 6 The monte-carlo approximation of the likelihood for the true
model 31 was done with 200 sampled likelihoods
Table 2 summarizes the results In general the larger the sample and the further from
equidispersed immigration when  is away from 1 the more powerful the test AIC
provides a very powerful decision rule for comparing the models even for small sample
sizes eg n  250 and moderately over and under dispersed immigration eg   075
and   125 respectively When the null model is true ie   1 both models
provide approximately equal AIC For this reason the more complex model should be
chosen when the dierence in AIC is signicantly greater than zero otherwise the AIC
decision would have a high level The Wilks test is very powerful in general for sample
sizes with 500 or more points and at even smaller sample sizes given high over or un-
derdispersion eg   05 and   15 respectively in the immigration However for
simulations from the null model when   1 the Wilks test has too low a level often
rejecting less than 5 percent of the time This could be because of limited accuracy in the
approximation of the likelihood using 31 with l  100 samples or numerical imprecision
when averaging the likelihoods The KS test is understandably the least powerful as it
species no alternative model Even on large sample sizes n  1000 EN 0r  400
and for signicant immigrant overdispersion   05 the test has very low power less
than 05
Following from the analysis presented above model selection can be successfully re-
solved using AIC andor the Wilks test In the following section we will see that mis-
specication of the model misspecication of the immigration process can signicantly
bias parameter estimates
EN 0r   05   075   1   125   15
Table 2 Results of model selection tests EN 0r denotes the expected number of
immigrant events in the sample AIC provides the fraction of the 50 repetitions in which
the H1 model had superior AIC to the H0 model Wilks provides the fraction of the 50
repetitions in which the H0 model was rejected when compared to the H1 model using
the Wilks test at level 005 KS provides the fraction of the 50 repetitions in which the
H0 model was rejected when using the KS test at level 005
65 Robustness of Branching Ratio Estimation under Mis-specication
of the Immigration Process
In this section we explore the robustness of the estimation of the branching ratio 23
when the immigrant process is mis-specied in the Hawkes model For this we consider
again the Hawkes Process with Weibull Renewal immigration 335 and exponential o-
spring density 37 We xed parameters   05 and   01 and varied the immigration
shape parameter  from highly over-dispersed 04 to under-dispersed 14 As before the
scale parameter  was chosen so that for any given  the expected immigrant inter-event
time was xed in this case ET 0
For each value of  we have simulated 50 independent realizations Each realization was
used for parametric MLE of the standard Hawkes process with Poisson immigration 1
and i exponential ospring density 37 and ii Omori-type density 38 Figure 3
presents results of the estimation of the branching ratio  as a function of the shape pa-
rameter  of the underlying immigration process
i  T 0
i1  4
As seen from Figure 3 both models with Poisson immigration have a signicant bias
in the estimation of  In the case of under-dispersed immigration   1 one observes
a relatively small negative bias which is similar for exponential 37 and Omori-type 38
ospring densities In contrast for over-dispersed immigration   1 the bias is positive
and much stronger For instance when   05 the branching ratio has median positive
bias of 017 and 031 for the Hawkes process with exponential and Omori-type ospring
densities respectively
Figure 3 Estimates of the branching ratio  23 using the Hawkes model with Pois-
sonian immigration and exponential ospring density black and Omori-type density
grey when the true process is generated with the Hawkes model with Weibull Renewal
immigration with shape parameter  The true branching ratio 05 is presented with a
horizontal dashed line Solid lines correspond to median values and dotted lines present
quartiles of estimates for both kernels
7 Monte Carlo Study of The Semi-Complete Data
EM Algorithm
In this section a Monte Carlo study is done using the semi-complete-data EM algo-
rithm to estimate the standard Hawkes process 1 with deterministic immigration inten-
sity 0  t   t Of course this algorithm may also estimate the Hawkes process
with Renewal process immigration For computational eciency an exponential ospring
density 37 is chosen In this case both the E and M steps of the semi-complete-data EM
algorithm are On and it thus becomes possible to estimate the model on large datasets
with a standard PC eg estimation on a sample of tens of thousands of points takes a
few minutes The immigration intensity will be estimated using kernel estimation
ikt  ti b10tr  ct 
dt 
where the kernel function kt b is a pdf with bandwidth parameter b This estimator 39
distributes mass i around each point ti The higher the bandwidth the more dispersed
the mass is One practical issue is that mass may be distributed outside of the interval
0 r This may easily be solved by symetrically reecting any mass outside of the
interval back into the interval This operation is denoted by the term ct  0 0  t  r
Another practical issue is the selection of a kernel density and the bandwidth In general
this involves managing the trade o between model complexity and goodness of t For
more detail on how to select the bandwidth see Silverman 1986 Turlach 1993 A nice
i1 i ie it is an unbiased estimator
for the total number of immigrant points in the sample An important consequence of
this is that there is not systematic error in the estimation of the branching ratio 23
feature of this estimator 39 is thatR r
0 dt Pn
This Monte Carlo study involves simulating the Hawkes process with sinusoidal im-
Figure 4 The solid thin black line is the true sinusoidal immigration intensity used in
simulation Lines are also plotted for the median heavy solid quartiles dashed and
005 and 095 quantiles dotted of all estimates
migration intensity t  sin2t250  15 exponential ospring density 37 with
scale parameter 0  01 and branching ratio values  sweeping 01 to 09 by 01 For
each set of parameters 50 simulations of this process on one period of the immigration
intensity 0 250 were performed The median sample size was 1200 with quartiles 520
and 1310 Two models were estimated on each realization using the Semi-Complete Data
EM algorithm see section 4 the rst being the true model and the second the false
model being the true model but with homogeneous immigration ie t   The
initial parameter estimates were randomly chosen uniformly at random in the following
intervals   01 09 0  01 10 and   01 5 The EM algorithm was allowed
to perform 200 iterations but in 90 percent of the time converged in less than 100 itera-
tions The convergence criterion was that the cumulative sum of the absolute dierences
of estimated parameters for the previous 3 iterations were within 106
In Fig 4 the true immigration intensity and a summary of the estimated immigration
intensity across all samples is given for the estimated true model The immigration in-
tensity is well estimated including cases when most of the points are ospring when
  09
In Fig 5 the errors in the estimation of the branching ratio for the true model grey
and the false model black are summarized For the true model estimation is consistent
and ecient For the false model the branching ratio is consistently overestimated in
particular for low values of the branching ratio  ie an upward bias of more than 06
when the true branching ratio   01 and still an upward bias of approximately 01 when
  05 The overestimation is due to the fact that the inter-event time process of the in-
homogeneous immigration is over-dispersed and contains apparent clustering Estimation
improves with increasing  because as the number of ospring points increases the mem-
ory of the estimated ospring becomes concentrated on the shorter ospring timescale
As a consequence the dispersion  clustering in the immigration process can no longer
be attributed to the memory kernel
Figure 5 The dierence between the estimated branching ratio and the true branching
ratio from repeated simulation and estimation The horizontal axis is the value of the
true branching ratio The grey lines are for the true model and the black lines are for the
false model The median heavy solid quartiles dashed and 005 and 095 quantiles
dotted of all estimates are given
8 Discussion
In this article the Hawkes process with renewal immigration 3 was proposed and
estimation was made possible by the introduction of two expectation-maximisation EM
algorithms the rst being an extension of Veen and Schoenberg 2008 These estima-
tion techniques were shown to be consistent in simulation studies and easily allow for
non-parametric estimation more easily than in Lewis et al 2012 Further a compu-
tationally ecient implementation of the semi-complete data EM algorithm was shown
to be useful for estimating an inhomogeneous Poissonian background intensity The im-
portance of correctly specifying the immigration process on branching ratio estimation
was highlighted  indicating strong potential for the overestimation of the branching ratio
when poissonian immigration is falsely assumed
As has been discussed the Hawkes model has been used in many areas We recommend
as a best practice that the Hawkes process with renewal immigration be considered as
an alternative model in such studies in particular when quantication of the branching
ratio is of interest and one observes highly dispersed locations of clusters in the data
Alternatively when one observes that the rate of events is changing the inhomogeneous
specication of the immigration process should be chosen
Let us nish by providing a few examples of the relevance of the results of this paper to the
existing literature Attempts to quantify the branching ratio for high frequency prices uc-
tuations of the SP 500 e-mini futures contracts where the rate of events changes signi-
cantly over the day Filimonov and Sornette 2012 Hardiman et al 2013 can prot from
using the semi-complete data EM algorithm with non-parametric estimation of the inho-
mogeneous Poissonian background intensity Further in Filimonov and Sornette 2014 it
was shown that the empirical inter-event time distribution of the SP 500 e-mini futures
contracts price uctuations has too heavy of a tail to be explained by a Hawkes process
with Poissonian immigration Allowing for overdispersed renewal immigration could be
helpful here Either of these approaches should lower the estimated branching ratio from
the levels reported in Hardiman et al 2013 For the modeling of rainfall this approach
provides a richer model than Cowpertwait 2001 and superior estimation to Salim 2003
There are a number of further methodological research directions suggested by this paper
In general the EM algorithm enables the maximum likelihood estimation of multi-type
point processes where the type is unobserved for instance in other types of cluster pro-
cesses potentially with renewal process immigration Within the Hawkes model the EM
algorithm may also be extended to the case of the marked Hawkes model  in which
the size of an event inuences its expected number of ospring via its fertility function
 allowing for easy non parametric estimation of the fertility function Additionally the
Hawkes model could be further extended to have self-exciting immigration that is a
model with two stages of clustering
References
Y At-Sahalia J Cacho-Diaz and Roger JA Laeven Modeling nancial contagion using
mutually exciting jump processes NBER Working Paper No 15850 2011
E Bacry K Dayri and JF Muzy Non-parametric kernel estimation for symmetric
Hawkes processes Application to high frequency nancial data Eur Phys J B 85
157 2012
L Bauwens and N Hautsch Modelling Financial High Frequency Data Using Point
Processes In Thomas Mikosch Jens-Peter Krei Richard A Davis and Torben Gustav
Andersen editors Handbook of Financial Time Series pages 953979 Springer May
C Bowsher Modelling security market events in continuous time
Intensity based
multivariate point process models  Journal of Econometrics 1412876912 2007
P Cowpertwait A Renewal Cluster Model for the Inter-Arrival Times of Rainfall Events
International Journal of Climatology 214961 2001
D Cox and V Isham Point Processes CRC Press 1980
DJ Daley and D Vere-Jones An Introduction to the Theory of Point Processes Volume
II General theory and structure volume 1 of Probability and Its Applications Springer
Verlag 2nd edition edition 2003
A Dempster N Laird and D Rubin Maximum likelihood from incomplete data via the
EM algorithm Journ of the Royal Statistical Society Serie B Methodological pages
138 1977
P Embrechts T Liniger and L Lin Multivariate Hawkes processes an application to
nancial data  Journal of Applied Probability 48367378 2011
V Filimonov and D Sornette Quantifying reexivity in nancial markets Toward a
prediction of ash crashes Physical Review E 855056108 2012
V Filimonov and D Sornette Apparent criticality and calibration issues in the Hawkes
self-excited point process model application to high-frequency nancial data Quanti-
tative Finance in press httpssrncomabstract2371284 2014
S Hardiman N Bercot and J Bouchaud Critical reexivity in nancial markets a
Hawkes process analysis European Journal of Physics B 86 442 2013
AG Hawkes Point Spectra of Some Mutually Exciting Point Processes Journal of the
Royal Statistical Society Series B Methodological 333438443 1971a
AG Hawkes
Spectra of some self-exciting and mutually exciting point processes
Biometrika 5818390 1971b
Y Y Kagan and L Knopo Stochastic synthesis of earthquake catalogs J Geophys
Res 8628532862 1981
Y Y Kagan and L Knopo Statistical short-term earthquake prediction J Geophys
Res 23614671563 1987
M Krumin I Reutsky and S Shoham Correlation-based analysis and generation of
multiple spike trains using Hawkes models with an exogenous input Frontiers in com-
putational neuroscience 4 2010
E Lewis and G Mohler A Nonparametric EM algorithm for Multiscale Hawkes Processes
J Nonparametric Statistics 2011a
E Lewis and GO Mohler A Nonparametric EM algorithm for Multiscale Hawkes Pro-
cesses Preprint pages 116 May 2011b
E Lewis GO Mohler PJ Brantingham and AL Bertozzi Self-exciting point process
models of civilian deaths in Iraq Security Journal 25244264 2012
PAW Lewis and GS Shedler Simulation of nonhomogeneous poisson processes by
thinning Naval Research Logistics Quarterly 263403413 1979
CR Loader Local likelihood density estimation Ann Statist Vol 24 Num 4 pages
16021618 1996
D Marsan and O Lengline Extending Earthquakes Reach Through Cascading Science
319586610761079 February 2008
F Massey The Kolmogorov-Smirnov test for goodness of t Journal of the American
statistical Association 466878 1951
J Mller and JG Rasmussen Perfect simulation of Hawkes processes Advances in
applied probability 373629646 2005
D Oakes The Markovian Self-Exciting Process Applied Probability Trust 1216977
Y Ogata Statistical models for earthquake occurrences and residual analysis for point
processes Journal of the American Statistical Association 83401927 1988
Y Ogata A Prospect of Earthquake Prediction Research Statistical Science 284
521541 2013
T Ozaki Maximum likelihood estimation of Hawkes self-exciting point processes Annals
of the Institute of Statistical Mathematics 311145155 December 1979
F Papangelou
Integrability of expected increments of point processes and a related
random change of scale Transactions of the American Mathematical Society 165483
506 1972
P Reynaud-Bouret and S Schbath Adaptive estimation for Hawkes processes application
to genome analysis The Annals of Statistics 38527812822 October 2010
A Saichev and D Sornette Universal Distribution of Inter-Earthquake Times Ex-
plained Phys Rev Letts 97078501 2006
A Saichev and D Sornette Theory of Earthquake Recurrence Times J Geophys Res
112B04313 doi1010292006JB004536 2007
A Saichev and D Sornette Super-linear scaling of osprings at criticality in branching
processes Physical Review E 89012104 2014
A Salim Extensions of the Bartlett-Lewis Model for Rainfall Processes Statistical
Modelling 37998 2003
BW Silverman Density Estimation for Statistics and Data Analysis Chapman and
Hall 1986
D Sornette and I Osorio Prediction chapter in Epilepsy The Intersection of Neuro-
sciences Biology Mathematics Physics and Engineering Editors Osorio I Zaveri
HP Frei MG Arthurs S CRC Press Taylor  Francis Group pages 203237
httparxivorgabs10072420 2010
D Sornette and S Utkin Limits of declustering methods for disentangling exogenous
from endogenous events in time series with foreshocks main shocks and aftershocks
Physical Review E 796061110 June 2009
D Sornette S Utkin and A Saichev Solution of the Nonlinear Theory and Tests of
Earthquake Recurrence Times Physical Review E 77066109 2008
B Turlach Bandwidth selection in kernel density estimation A review CORE and
Institut de Statistique 194 pages 133 1993
A Veen and FP Schoenberg Estimation of space-time branching processmodels in seis-
mology using an EM-type algorithm J Amer Statist Assoc 103 pages 614624
S Wilks The large-sample distribution of the likelihood ratio for testing composite
hypotheses The Annals of Mathematical Statistics 916062 1938
J Zhuang Y Ogata and D Vere-Jones Stochastic declustering of space-time earthquake
occurrences Journal of the American Statistical Association 97458369380 2002
