Second order statistics characterization of Hawkes
processes
and non-parametric estimation
E Bacry and JF Muzy
Abstract
We show that the jumps correlation matrix of a multivariate Hawkes process is related to the Hawkes kernel matrix through
a system of Wiener-Hopf integral equations A Wiener-Hopf argument allows one to prove that this system in which the kernel
matrix is the unknown possesses a unique causal solution and consequently that the second-order properties fully characterize a
Hawkes process The numerical inversion of this system of integral equations allows us to propose a fast and efcient method
which main principles were initially sketched in 1 to perform a non-parametric estimation of the Hawkes kernel matrix In this
paper we perform a systematic study of this non-parametric estimation procedure in the general framework of marked Hawkes
processes We describe precisely this procedure step by step We discuss the estimation error and explain how the values for
the main parameters should be chosen Various numerical examples are given in order to illustrate the broad possibilities of this
estimation procedure ranging from 1-dimensional power-law or non positive kernels up to 3-dimensional circular dependence
processes A comparison to other non-parametric estimation procedures is made Applications to high frequency trading events in
nancial markets and to earthquakes occurrence dynamics are nally considered
Stochastic processes Covariance matrices Estimation Microstructure Earthquakes Inverse problems Discrete-event systems
Multivariate point processes
Index Terms
I INTRODUCTION
A multivariate Hawkes process is a counting process which intensity at each time is given by a linear regression over past
jumps of the process 2 3 This self- and mutually- exciting nature of Hawkes processes makes them very appealing
to account within a simple tractable model for situations where the likelihood of future events directly depends on the
occurrence of past events For this reason there has been during last decade a growing interest for Hawkes processes in
various elds where endogenous triggering contagion cross-excitation can be naturally invoked to explain discrete events
dynamics Originally Hawkes models have been introduced to describe the occurrence of earthquakes in some given region 4
5 but they also became popular in many other areas like high-frequency nance trading and order book events dynamics
68 neurobiology neurons activity 9 sociology spread of terrorist activity 10 11 or processes on the internet viral
diffusion across social networks 12 13
A D-dimensional Hawkes process N t is mainly characterized by its D  D kernel matrix t  ijt1ijD where
the kernel ij t describes how events of the jth process component inuence the occurrence intensity of the ith component
As far as estimation of Hawkes process is concerned in most studies one assumes a specic parametric shape for the kernel
components ij t eg an exponential decay and performs either a moment method based eg on the bartlett spectrum
14 15 or a maximum likelihood estimation 16 17 However when one has no a priori on the shape of the kernel
components it is necessary to perform a non-parametric estimation The rst approach devoted to this goal was a method
based on Expected Maximization EM procedure of a penalized likelihood function 10 18 It has been designed for
monovariate Hawkes processes and can be hardly used to handle large amounts of data in situations where the kernel function
is not well localized as compared to the exogenous inter-events time see section VI Another approach proposed in 9 19
20 consists in minimizing a contrast function assuming that the kernels ij t1ijD can be decomposed over atoms of
some dictionary The estimation is regularized using a Lasso penalization which provides sparse estimations The so-obtained
kernels are for instance piece-wise constant functions with very few non zero pieces Though it is clearly the right choice
when the dimension D is large or when the kernels are known to be very well localized this seems to be the case when
modeling networks of neurons 9 it does not make sense when modeling earthquakes or nancial time-series for which a
large amount of data is available and the kernels are known to be power-law Let us also mention an approach proposed in
21 where the authors estimate the kernel components ijt from the jumps correlation matrix through a spectral method
This technique is however exclusively adapted to symmetric Hawkes processes
In this paper our main purpose is two-fold We rst provide a complete overview of Hawkes processes second order
properties and show that they uniquely characterize the process ie there is a one-to-one correspondence between the matrix
E Bacry is in the Centre de Mathematiques Appliquees Ecole Polytechnique 91128 Palaiseau France
JF Muzy is in the Laboratoire Sciences Pour lEnvironnement CNRS Universite de Corse UMR 6134 20250 Corte France
t and a matrix gt associated with the jumps dN t correlation function In fact we prove that t is the unique causal
solution of a system of Wiener-Hopf equations that directly involves the correlation function We then show that this property
allows us to propose a new simple non-parametric estimation method based on the explicit resolution of the Wiener-Hopf
system using a Gaussian quadrature method In many applications it is interesting to consider a marked version of Hawkes
processes where the conditional intensities of the Hawkes components may also depend on some random variables the marks
associated with each event through a matrix of mark functions We write the new system of equations which links t with
the correlation function which is no longer a Wiener-Hopf system In the case the mark functions are piecewise constant we
show that a simple variant of our method allows one to solve this system ie to recover both the kernel and the mark functions
matrices We provide various numerical examples ranging from a 1-dimensional process up to a 3-dimensional process We
also provide some heuristics about the estimation error and convergence issues as well as some procedures to x the various
parameters of the method We compare this method to existing non-parametric methods and show that it is relatively simple
to implement and allows one to handle very large data sets and lead to reliable results in a wide number of situations Our
estimation framework is then illustrated on two different applications First along the same line as in Refs 21 22 we study
the arrival of market orders of 2 liquid future assets on the EUREX exchange We show that the estimated kernel is strikingly
well tted by a power-law function with an exponent very close to 1 Second we estimate a Hawkes model of earthquake
events marked by the event magnitudes from the Northern California EarthQuake Catalog NCEC 23 To our knowledge
the only attempt to estimate a non-parametric self-exciting from earthquakes was provided in Ref 18 In our case we conrm
that the ETAS model specications ie of power-law shape of the kernel t and an exponential law for the mark function
The paper is structured as follows In section II we introduce the main mathematical denitions and review the second
order properties of multivariate Hawkes processes We notably provide the explicit expression for the Laplace transform of the
jump correlation function We also introduce the conditional expectation matrix gt and show how it is basically related to
the jump correlation function Finally we recover a former result by Hawkes 3 by virtue of which the kernel matrix t
satises a Wiener-Hopf equation with gt as a Wiener-Hopf kernel We show that the Wiener-Hopf operator has a unique
causal solution and thus t is uniquely determined by the shape of gt Our estimation method relies on this property and
is described in section III More precisely by reformulating a marked Hawkes process with piecewise constant mark functions
as a multivariate Hawkes process in higher dimension we propose a numerical method that allows one to estimate both the
kernel and the mark functions This method mainly uses a Nystrom method to solve the system of Wiener-Hopf equations
It is illustrated in Section V on four different examples  a 2-dimensional marked process two 1-dimensional processes one
involving slowly decreasing kernels and one involving a negative-valued kernel and a 3-dimensional process involving circular
dependance and non decreasing kernels Section IV presents some heuristics about the analysis of the estimation errors and
discusses some procedures to x the main parameters of the method namely the bandwidth and the number of quadrature
points We then briey discuss the link to former approaches for non-parametric kernel estimation in section VI while the
aforementioned applications to nancial statistics and geophysics are considered in section VII Conclusion and prospect are
given is section VIII
II MULTIVARIATE HAWKES PROCESSES AND THEIR SECOND ORDER PROPERTIES
A The framework
We consider a D-dimensional point process Nt  N i
t 1iD Each component N i
t is a 1d point process whose jumps are
all of size 1 and whose intensity at time t is i
t Thus the intensity vector of Nt is t  i
t1iD
We consider that Nt is a Hawkes process 2 ie that at time t each intensity component i
t can be written as a linear
combination of past jumps of Nt ie
i  1 D i
t  i 
DXj1Zt
ij t  sdN j
   i1iD are exogenous intensities
 each kernel function ij t is a positive and causal ie its support is included in R It codes the inuence of the
t In the following the kernel matrix will denote the D  D matrix function
past jumps of N j on the current intensity i
t  ij t1iD
Using matrix notations the D equations 1 can be rewritten in a very synthetic way as
where   i1iD and the operator  stands for regular matrix multiplications where all the multiplications are replaced
by convolutions
Let us remind that the process Nt has asymptotically stationary increments and the process t is asymptotically stationary
if the following hypothesis holds 2 
t      dNt
H the matrix   ij 1iD has a spectral radius  strictly smaller than 1
where g stands for g R gtdt In the following we will always consider that H holds and we shall consider that Nt
corresponds to the asymptotic limit ie Nt has stationary increments and t is a stationary process
In that case the vector  of mean event rates associated with each component reads 2
  Et  I  1
In the following i will refer to the ith component of 
Remark Inhibitory effects in Hawkes processes Let us point out that Bremaud and Massoulie 24 have shown that the
stability condition criterium remains valid when t is a nonlinear positive Lipschitz function of   dNt and where the kernels
ij are not restricted to be positive A particular interesting generalization of Eq 2 notably considered in 20 is
where x  x if x  0 and x  0 otherwise This extension allows one to account for inhibitory effects when ij t can
take negative values
t      dNt
B Characterization of a multivariate Hawkes process through its second-order statistics
In this section we recall the main properties of the correlation matrix function associated with multivariate Hawkes processes
and prove that it fully characterizes these processes
The second-order statistics are summed up by the innitesimal covariances 
CovdN i
t  dN j
As already explained under assumption H Nt can be considered to have stationary increments consequently CovdN i
only depends on tt Moreover these measures are non singular measures except for i  j for which it has a Dirac component
t Thus the non-singular part of this covariance can be written as
t  ijdtdt
1  i j  D
t  dN j
t   EdN i
ij t  tdtdt  EdN i
t  ijdtdt  iij t  tdt
1  i j  D
where ij is the Kronecker symbol which is always 0 except when i  j in which case it is equal to 1
Let us point out that since all the jumps of the process N are of size 1 the second order statistics can be rewritten in terms
of conditional expectations see 1 Indeed for all 1  i j  D let gijt be the non-singular part of the density of the
measure EdN i
t  idtdN j
0  1 ie
gijtdt  EdN i
t dN j
0  1  ijt  idt
It follows that
ij t  tdtdt  EdN i
 EdN j
 EdN j
 igjit  tdtdt
t dN i
ttdN i
t   ijdtdt  iijt  tdt
t  1P robdN i
t  1  ijdtdt  iijt  tdt
0  1idt  ijdtdt  iijt  tdt
t  gT t
where gT t stands for the transpose of the matrix gt
In 21 it has been shown that the innitesimal covariance matrix t  ijt0ijD can be directly related to the
kernel matrix  
k1 kt where k stands for the matrix convolution          where
Proposition 1 from 21 Let t P
 is repeated k times Let et  t Then
where  is the diagonal matrix dened by ii  i and where we use the convention   t  t In the Laplace domain
this last equation writes
t  I e  I  T t  t
z  I  zI  T z  
Moreover
I  z  I  z1
which gives
I    gt  tI eT t1  tI  t
I    gt  eT t1  t
where the Laplace transform of a L1 causal function st is dened as
sz Z 
steztdt z  C 
From Eqs 8 and 9 it results
or alternatively in the Laplace domain
gt  T t1  I    I eT t1  tI
gz  I  zI  T z1  I
convoluting both hand sides of 13 by tI  t leads to
I    I  t  tI
Since all the elements of t are causal functions ie supported by R and since t is just expressed as convolution
products of the matrix  all the elements of t are also causal functions Writing this last equation for t  0 thus leads
to the following Proposition
Proposition 2 The kernel matrix functions t statises the D2-dimensional Wiener-Hopf system
gt  t    gt
t  0
Wiener-Hopf equations have been extensively studied in the past century 2527 and arise in wide variety of problems in
physics This last system of equation was rst established by Hawkes in 3 see also 1 in order to express gt considered
as the unknown as a function of t He proved that it has a unique solution in gt One can work the other way around
and consider it as a system of equations that t the unknown satises gt being known In Appendix A thanks to the
famous factorization technique introduced by Wiener and Hopf 27 we prove that this system 18 admits a unique solution
in t
Theorem 1 Let Nt be a D-dimensional Hawkes process with exogenous intensity  and kernel matrix t as dened in
Section II-A Let t satises hypothesis H as explained above we then can consider that Nt has stationary increments
Let gt be the matrix gt  gijt1ijD dened by 7 Then the matrix t is the only solution whose elements are
all causal and in L1R of the system of equations in which t is the unknown
gt  t  t  gt t  0
One can then state the corollary 
Corollary 1 A multi-dimensional Hawkes process with stationary increments is uniquely dened by its rst-order statistics ie
the expectation of its intensity t and its second-order statistics given by either its correlation function 5 or equivalently
by its conditional expectations 13
Indeed this is a direct consequence
 of the Theorem 1 which proves that the second-order statistics fully characterize the kernel matrix t
 and of 3 which allows to express  as a function of  and the rst-order statistics 
III NON-PARAMETRIC ESTIMATION OF A MULTI-DIMENSIONAL MARKED HAWKES PROCESS  FRAMEWORK AND MAIN
PRINCIPLES
As we shall see at the end of this Section the results of previous Section naturally lead to a non-parametric estimation
method for multidimensional Hawkes processes Actually we shall develop our estimation framework in a slightly more general
framework than the one presented above which is very useful in applications  the framework of multi-dimensional marked
Hawkes process
A The marked Hawkes process framework
Using the same notation as in Section II-A each component N i
t is now associated with observable iid marks i
t jumps In the following we note pix the density of the law of the random variable i
t is non
t conditionally
zero only at time when N i
to the fact N i
t jumps We then replace 1 by the new equation
i  1 D i
t  i 
DXj1Zt
ij t  sf ij j
where the past observed marks j
t through the unobserved mark positive function f ijx
Since f ijx is only involved through the product ij tf ijj  it is dened up to a multiplication factor We x this factor
by choosing f ij such that Ef ijj   1
s inuence the current intensity i
As in the unmarked case it is easy to show that under the condition H one can consider that Nt has stationary increments
and that 3 still holds
In place of the functions gijt for an non-marked Hawkes process see 7 we now dene the function Gij t x as
Gij t xdtdx  EdN i
t  dN j
0  1 and j
0  x x  dx  ij tdx  idtdx
Let us note that gijt R Gij t xpixdx In Appendix B we prove that Gij satises a system of integral equation as stated
by the following proposition
Proposition 3 Let i  1 D xed The kernels ij t1jD of the marked Hawkes process dened in Section III-A satisfy
the following system of integral equations 
j  1 D t  0 x Gij t x  ij tf ijt 
ik  K ijk
x t  Gkj t x1R t 
j Z dzf ikzpkzGjkt z1Rt
B The Wiener-Hopf equation in the case of piece-wise constant f ij mark functions
In a non-parametric estimation framework the unknown of the system 22 are both the kernels ij and the mark functions
f ij In the case of non-marked Hawkes process we already showed see Eq 18 that this system is a Wiener-Hopf system
We proved the unicity of the solution and one can use standard methods for solving it The system 22 is no longer a
Wiener-Hopf system which makes things much harder
In the particular case of piece-wise constant mark functions f ij with M number of pieces it is easy to prove that the
process N basically corresponds to a non-marked Hawkes process of dimension DM  each components corresponds to the
jumps of a component of the marked Hawkes process associated with one of the M mark function values Thus it is clear
that the system 22 can be written in terms of a D2M Wiener-Hopf system of the type of 18 It will be the base of our
non-parametric estimation procedure
Remark  Before moving on let us point out that in the case the marks ij inuence the intensity of the process only through
a nite number M of values one could consider the more general framework where the kernels themselves depend on the
marks ie
i  1 D i
t  i 
ij t  s j
DXj1Zt
and following the same argument as above estimate all the kernels ij   solving a D2M Wiener-Hopf system This can
be achieved following the exact same lines as the algorithm described in the next Section For the sake of simplicity we will
describe the algorithm in the case ij t   ij tf ij 
We consider that for any j there exists a covering of R with a nite number of intervals I jl1lM j such that for any
i and for any l f ijx restricted to x  I jl is a constant function which value is f ij
Since the marks ij are involved in the process construction only through the functions f ijij  it is clear that the functions
x  Gijt x are also piece-wise constant Thus we note
x  I jl f ijx  f ij
x  I jl Gijt x  Gij
In the same way we note
For xed i and j and for a xed x  I jl Equations 22 and 23 then rewrite
t  0 Gij
l t  ij tf ij
l t 
l t1R t 
m t1Rt
pjxdx  pj
ZI j l
ik Gkj
Since Ef ikik  1 one hasPM k
mt  ikt we get
t  0 Gij
l t  ij
l t 
We nally get the Wiener-Hopf system
m1 f ik
m  1 then if we make the change of variable ik
mt  f ik
m ikt consequently
m cid18pk
l t1R t 
m t1Rtcid19
Proposition 4 Let i  1 D xed The marked kernels ij
system 
l t  f ij
l ij t1jD1lMj satisfy the following Wiener-Hopf
t  0 Gij
l t  ij
l t 
Xm1Z 
msK ijk
t  sds
Moroever
t  pk
l t1R t 
m t1Rt
ikt 
Thus we get D Wiener-Hopf systems of dimension DM where M  PD
j1 M j The unicity of the solution is actually
deduced from the result of Section A where we proved the unicity of the solution of the system 18 Indeed as we explained
in the previous Section the marked Hawkes process we considered here is equivalent to a non-marked Hawkes process of
dimension DM 
Let us point out that in the case the functions f ij are constant functions and thus equal to 1 since Ef ij ij
t   1 then
we recover the system 18 which corresponds to D Wiener-Hopf systems of dimension D Indeed in that case we have
l  1 and for all t  0 gijt  i
l t  gijt ij
l t  ij t pj
j gijt
C Discretizing the system 22 using Nystrom method
Solving the Wiener-Hopf systems 30 is the main principle of our estimation procedure There is a huge literature about
numerical algorithm for solving Wiener-Hopf equations 27 28 One algorithm which is particularly simple and which works
particularly well is the Nystrom method 29 It basically consists in replacing convolutions in time by discrete sums using
quadrature method with Q points Then for each i solving 30 amounts in solving a linear QDM dimensional standard
linear system which can be solved by simply inverting the corresponding QM D  QM D matrix Of course in order to get
the full estimation of the kernels ij and the constants f ij
 one has to solve D such systems one for each value of i Let
us point out that when the kernels have been estimated on the quadrature points using quadrature formula one can compute
these estimations on any ner grid
If we suppose that the kernels are supported by 0 A one gets
t  0 Gij
l t  ij
l t 
msK ijk
t  sds
Xm1Z A
However when using the Nystrom method ie computing the integral using quadrature methods one has to be careful since
the kernel K ijk
t is generally discontinuous at t  0 A standard way to deal with a Wiener-Hopf kernel which is singular
non exploding on the diagonal is to rewrite 33 in the following way 
t  0 Gij
l t  ik
l t 
Xm1Z A
ms  ik
mtK ijk
t  sds  ik
mtZ A
t  sds
The term in the rst integral is then no-longer discontinuous quadrature error will be one order smaller and the second term
can be estimated directly estimating directly the primitive function of the Gij
l t functions and using the formula
t  sds  pk
l sds 
j Z At
m sds 
D Main steps od our non-parametric estimation
We are now ready to present the main steps of our estimation algorithm We refer the reader to Section V-A for a more
detailed description of the algorithm The main steps for non-parametric estimation of multi-dimensional Hawkes processes
 For all j  1 D x a priori the M j intervals I jl1lM j on which the mark function f ijx is considered as
constant
 For all i j  1 D and l  1 M  estimate the conditional-law functions Gij
l  as dened by 21 by
replacing the expectation by empirical averages These functions are are density measures in particular they are positive
cf 13 though they do not sum to 1 It is very natural to use classical kernel-based non-parametric estimation techniques
used for estimating the density of a random variable from iid realizations 30 This classically involves a bandwidth
parameter h which corresponds to the size of the support of the kernel This well be developed in the Section IV-A
l t  Gij
l t x  I j
 Solve in  the Wiener-Hopf system 22 using the Nystrom method as explained in Section III-C using Q Gaussian
quadrature points
 Using quadrature formula the so-obtained estimation of  at the quadrature points can be re-sampled on any grid with
an arbitrary resolution
This method mainly involves two key parameters  the bandwidth h and the number Q of quadrature points The next section
gives some insights on how one should x these two parameters
IV SELECTION OF THE BANDWITH h AND THE NUMBER Q OF QUADRATURE POINTS
The goal of this Section is to give qualitative arguments for controlling the error of the estimation procedure presented
previously and to understand how to choose the estimation parameters h the bandwidth and Q the number of quadrature
points It will be illustrated by numerical simulations
For the sake of simplicity we shall consider that the Hawkes process is not marked The arguments are exactly the same in
the case of a marked Hawkes process
There are mainly two sources of errors 
E1 the rst one comes from the estimation of the conditional expectation density gijt 7 This error is basically controlled
by the amount of data available ie by the number J of jumps available and by the value of the bandwidth parameter
E2 The other one comes from the inversion of the Wiener-Hopf system 18 This error is basically controlled by the number
Q of quadrature points
In the error analysis it is very hard to take into account the fact that the kernel of the Wiener-Hopf system is a random
function ie the empirical estimation of the conditional expectation This problem has somewhat already been addressed in
20 in a particular case see Section VI Clearly this problem should be solved for understanding deeply the performance of
our estimator However in the general case this is a very difcult problem which is still open as of today
A Conditional expectation density estimation - Bandwidth h selection
One of the main step of the algorithm presented in Section III-D consists in estimating the functions gijt1 dened by 7
for t  0 for negative t one can use the formula gijt  gjiti1
These functions are density measures in particular they are positive cf 13 though they do not sum to 1 It is very natural
to use classical kernel-based non-parametric estimation techniques used for estimating the density of a random variable from
iid realizations 30
Let Kx be a kernel function of order l ie a localized function such that R Kudu  1 R K 2udu   and
R unKudu  0 for all n 1  n  l Since we want to perform estimations only for t  0 it is convenient to choose the
support of Ku to be in R For the sake of simplicity we consider that we have R iid realizations Ntr1rR of the
Hawkes process on an interval 0 tmax such that gtmax  0 For each realization r we call tj
nr the nth jumping time
of the jth component N j
t r For a given bandwidth h  0 it is natural to consider the following estimator of gijt  i for
 t 
RXr1Z tmax
urK  u  tj
1r  t
1In the non marked case the functions Gij
l t are such that Gij
l t  gij t t
The mean square error is dened as
where we denoted the estimation bias bt  gijt  Egij
Appendix C
M SEh  EE 2
1   Ecid0gijt  gij
 t2cid1  V argij
 t  b2t
 t The following classical bound of this error is proven in
Proposition 5 Convergence speed If gijt is Holder  and if the kernel K is of order l     then mean square
error MSE satises
The minimum is obtained for2
for which one gets the usual adaptive non-parametric convergence speed
M SEh  C2
2 h2 
h cid18 C1
21 
2cid19 1
1   Ocid16R 2
21cid17 
M SEh  EE 2
Thus for instance in the special case where the ij ts are Holder 1 ie   1 using a simple order 0 kernel such as
Ku  101u one gets that if one chooses h of the order of R13 we expect the MSE to be of the order of R23
where R is the number of iid realizations of the Hawkes process Let us point out that in practice one often has a single
realization One can then estimate gij  i by averaging on the different jumps of this realization More precisely we replace
36 which used R realizations on the time interval 0 tmax by the following estimation that uses a single realization on the
time interval 0 T  with T  tmax 
 t 
uKcid18 u  tj
n  t
cid19 
where J is the number of events of the realization After a certain time the realization can be considered as independent of
its beginning One should then get an error which is of the order of
JXn1Z T
21cid17 
E1  Ocid16J  
so for   1 that gives an error of the order of J 13
These results are illustrated in Fig 1 where we have computed the integrated MSE MISE on gt in a 1-dimensional
Hawkes model with an exponential kernel t  01e02t   005 for different realization sizes J increasing from 8103
to 106 by a factor 2 In order to estimate the MISE for each parameter we have generated 500 trials of the model and
estimated the MISE using the analytical expression of gt One can see in the log-log representation that for each sample size
J the error decreases in the small h regime as expected from Eq 72 as h1 For large values of h one clearly observes
the bias contribution that is expected to behave like h2 We have checked that the optimum value h behaves for large J as
h  CJ 033 In the right panel gure is reported in log-log scale the minimum MISE error as a function of the sample
size As predicted by Eq 39 one gets a power-law with an exponent close to 23
Bandwdith selection using cross-validation From a practical point of view in order to choose the optimal value of the
bandwidth h from a single realization R  1 on the time interval 0 T  one can use a cross-validation method Indeed in
the MISE computation the only terms that depend on h read
M h  Ecid18Z tmax
 Ecid18Z tmax
 t2dt  2Z tmax
 t2dt  2iZ tmax
gijtgij
 tdtcid19
 tdt  2Ecid18Z tmax
 tdN itdN j
0  1cid19cid19
t dN j
where we have considered that gijt has a support included in 0 tmax and where we used the denition gijt  EdN i
1idt Replacing the last term in the expectation of the previous equation by an empirical average it results that the following
contrast function provides an unbiased estimator of M h 
Ch Z tmax
 t2  2igij
 tdt 
l tmaxtj
 ti
l  tj
2Notice that the minimum h depends on i and j but we chose to omit the superscripts i j for the sake of simplicity
log2 h
log2 J
Fig 1 Mean integrated square error MISE as a function of the kernel width h left panel and the sample size J right panel for a 1-dimensional Hawkes
model with   005 and t  01e02t The errors have been estimated using 500 Monte-Carlo samples of the process In the left panel are represented
the MISE associated with various sample sizes J  8103 16104 32104     124105 The results are in good agreement with Proposition 5
006
008
010
012
log2 h
Fig 2 Estimation of M h  see 46 as compared to the theoretical M h solid lines see 42 for a 1-d Hawkes sample M h corresponds to the
h dependent part of the MISE The top lines corresponds to a sample size J  104 events while the bottom curves correspond to a sample size J  5104
All curves are plotted as a function of log2h In each case the Hawkes model corresponds to the exponential kernel t  01e02t with   005 The
estimated curves  are in good agreement with the theoretical curves solid lines The abscissa where the minimum is reached provides an estimation of
optimal bandwidth h In both cases we choose R  10 in Eq 46
where J stands for the number of events of N j the rst sum is taken on all the jumping times tj
k of the component N j and
k A cross-validation
the second sum is taken on all the jumping times ti
method can be used to estimate the expectation of Ch For doing so one divides the overall realization time interval 0 T 
in R intervals of equal size ie Ir  r  1 T
R  for r  1 R Then for each interval Ir the conditional expectation
gij is estimated following the same ideas as 40 averaging only on the jumps of N j which do not take place in Ir More
l of the component N i such that tj
R  r T
l  tmax  tj
precisely we get the estimation gij
r dened by
rt 
J  Jrh Xtj
n IrZ T
uKcid18 u  tj
n  t
cid19 
t  0 tmax
where Jr corresponds to the number of jumps of N j that take place in the time-interval Ir The contrast function 43 is then
estimated on Ir ie
Crh Z tmax
rt2  2igij
rtdt 
kIr Xtj
l T tj
l  tj
The estimation of M h  ECh is thus naturally given by averaging on all the so-obtained quantities for all the possible
choices of n 
M h 
Crh
Examples of M h curves are provided in Fig 2 on a simple 1-d example of Hawkes process The estimation M h is
close the theoretical quantity M h The abscissa corresponding to the minimum of the so-obtained M h curve gives an
estimation of the optimal bandwidth h
B Overall error - Selection of the number of quadrature points Q
h  argmin
M h
If one supposes that gt is estimated with no error it remains to study the error due to the quadrature approximation The
function Kt s  gt  s is the kernel of the Wiener-Hopf system 18 Even if the ij t functions are regular this is a
singular kernel since it is generally discontinuous on its diagonal except if the dimension D  1 There is a huge literature
on how to solve numerically Wiener-Hopf systems with a singular kernel on its diagonal though generally the singularity is
much stronger than a simple discontinuity It is out of the scope of this paper to compare all these methods and try to
understand which is more appropriate for our estimator A pretty popular method is the Nystrom method already described
above It consists in rewriting 18 as we did when we rewrote 33 into 34 ie isolating the singular behavior of the kernel
gt  t Z sgt  sds  t Z s  tgt  sds  tZ gt  sds
The last integral term can be estimated directly ie estimating the primitive function of gt The other integral term is
approximated by a quadrature method we shall use Gaussian quadrature
Let us suppose again that each element of t is Holder  we assume here that   1 and that they are all bounded by a
1 
constant  Again using 13 and 71 one can easily show that each element of gt is bounded by  g  A1
where A1 and A2 are some constants Let us also suppose that all the elements of the derivative t are bounded by a constant
 Then the terms in s  tgt  s are of class Holder  everywhere except on the diagonal s  t for which the
derivative might be discontinuous If the quadrature method uses Q points and is basically of order greater than max2 
 g
the error for the non diagonal terms is of the order of  g
The total quadrature error is of the order of
Q while the error on the diagonal terms is of the order of 
1 A2 1
Quadrature error  gcid18 
Qcid19
I  gz1  I  T z1I  z
Solving the Wiener-Hopf equation amounts in applying the convolution operator whose Laplace transform is see 14
This operator has a norm which is bounded by a constant times  Thus the error E2 resulting from the Wiener-Hopf inversion
is of the order of the quadrature error 
Since as we have just seen the Wiener-Hopf inversion involves an operator whose norm is bounded by a constant controlled
by  the Wiener-Hopf kernel estimation error E1 related to to error in the estimation of gt does not change of magnitude
order when inversion is performed We deduce that the order of the overall error when h  h should basically be of the
order of the sum of the two errors see 41
E2  Ocid0Q2  Qcid1
overall error  E1  E2  Ocid16J  
21cid17  Ocid0Q2  Qcid1
RMSE on gt
L  error on t
log2 J
Fig 3 Root mean square error on gt and L error on t as functions of the sample size in log-log scale for the same Hawkes process as in Fig 1
In both case h  h and the number of quadradure points Q is kept xed Q  30 Both errors behave as J 13
Again as explained in the introduction of this section we left apart the fact that the inversion of the system involves a random
kernel that we need to control in order to control the error In that respect one can always choose Q large enough so that the
quadrature error is negligible as compared to the estimation error E2  E1 so that the overall error will always behave as
In Fig 3 we have reported the L error on t as a function of the sample size for the n-dimensional Hawkes process
used previously We set Q  30 and chose for each J h  h ie the optimal bandwidth One can see that the L error
behaves as the the root mean square error RMSE on gt ie as J 13
21cid17
Ocid16J  
20 40 60 80 100 120 140 160
20 40 60 80 100 120 140 160
Fig 4 Estimation error dependence as a function of the number of quadrature nodes Q Left panels The relative L2 error is displayed as function of Q for
a 1D Hawkes process J  107 events with an exponential kernel top or power-law kernel bottom Right panels The empirical L2 relative variation RQ
Eq 48 as a function of Q in the exponential case top and power-law case bottom One can see that in both cases it is sufcient to choose Q  20 40
to be very close to the best estimation for very large Q
Selection of the number of Quadrature points Q From a practical point of view in order to choose the number Q of
quadrature points that are used one can start with a relatively small value for Q eg Q  20 compute the estimated kernels
and compare them to the estimated kernels that are obtained when increasing the value of Q One should stop increasing Q
when the two estimations are sufciently close In order to decide whether Q is large enough one can eg check if the
relative L2 variation
 Q  2Q2
 Q2
is small enough for instance RQ  1 This is illustrated in Fig 4 where we have plotted as a function of Q both the
relative L2 estimation error   Q22 and RQ for 2 examples of 1D Hawkes processes involving respectively an
exponential top and power-law kernel bottom One can see that in both situations Q  20 40 is large enough For all
the numerical illustrations and applications presented in this paper a value in that range has been chosen Empirically we
observed that for a wide variety of kernels shapes and for sample sizes between 104 and 107 this range is sufcient to be
close to optimal results
002
005
002
005
Fig 5 Non-parametric estimation of the 2-dimensional marked Hawkes model dened in Section V-B following estimation procedure of Section V-A
t  We used h  05 and Q  50 The solid lines represent
Estimation is based on a realization with 45 105 resp 4 105 events for component N 1
the analytical curve and the symbols  the empirical estimated values The four plots at the top show the kernel matrix  estimation The two plots at the
bottom show the estimation of the mark functions See Fig 6 for goodness of ts
t resp N 2
The following section gives a detailed description of the algorithm and the next one gives several numerical illustrations
V DESCRIPTION OF THE ALGORITHM - NUMERICAL ILLUSTRATIONS
Exp quant
Exp quant
Fig 6 Q-Q plots goodness of ts for estimation of the 2-dimensional marked Hawkes model dened in V-B see Fig 5 for estimation results The solid
lines represent the expected diagonal and the symbols  the empirical estimated values
A Description of the algorithm
In this Section we describe precisely each step of our non-parametric estimation procedure within the framework of marked
Hawkes processes presented in Section III
 Estimation of the vector  simply using as an estimator of i the number of jumps of the realization of N i divided by
the overall time realization
 For all j  1 D one must a priori choose M j and the intervals I jl1lM j
 For all j  1 D and for all l  1 M j estimation of the probabilities pj
needs to count the number of realized marks j
s that falls within the interval I jl
l as dened by 27 In order to do so one just
 One must estimate Gij
l nhn on an a priori chosen support 0 tmax using empirical averages as explained in Section
IV-A For this purpose a value for the bandwidth h must be chosen Section IV-A explains for the sake of clarity this
section only deals with the simpler case of non-marked Hawkes process but the generalization is obvious how this value
can be obtained using cross-validation
 Fix the number of quadrature points Q to be used as well as the support for all the kernel functions we use gaussian
quadrature In general Q  30 is sufcient however at the end of Section IV-B we explain how this value can be chosen
adaptively Then for each i  1 D solve the QM linear system obtained by discretizing the convolutions in 29 using
the quadrature points This leads to an estimation of all the functions ij
l on the quadrature points
 The estimations of the kernels on the quadrature points are simply obtained using the formula ij t PM j
The L1 norm ij  R 
ij tdt as well as a re-sampling of the kernels on a high resolution grid can be obtained
 The stability condition of the so-estimated Hawkes process should be checked ie the spectral radius of the D  D
using again quadrature formula
matrix made of the L1 norms ij  must be strictly smaller than 1
 The estimation of the piece-wise values f ij
of the mark functions f ijt can be obtained via the formula f ij
l ij 
B Numerical illustrations
In this section we illustrate the performances of the previous estimation method on various examples accounting for different
situations marked process non decreasing lagged kernels slowly decreasing kernels and kernels that can be negative
In order to perform numerical simulations of D-dimensional Hawkes models various methods have been proposed We chose
to use a thinning algorithm as proposed eg in 31 It is an incremental algorithm the jumping times are generated one
after the other In its simplest version in the case of decreasing kernels at a given time t it basically consists in picking up
k1 k
tt the jump is rejected If not rejected it is
the next potential jumping time t  t using an exponentially distributed random variable t with parameter t PD
Then a uniform random variable F on 0 t is drawn If F  t PD
assigned to the ith component such that i is the maximum index i which satises F  t Pi1
k1 k
k1 k
tt
Fig 7 Non-parametric estimation of the 3-dimensional Hawkes model with circular interactions The estimation is based on a realization with around 105
events for each component We used h  02 and Q  50 The solid lines represent the analytical kernels and the symbols  the empirical estimated values
A marked 2-dimensional Hawkes process with exponential kernels
The rst example we consider is a 2-dimensional marked hawkes process with exponential kernels The matrix t of the
process reads
t cid18 01e02t
03e09t
01e02t
03e04t cid19
with 1  005 2  01 We consider that N 2
is marked with a mark m that follows an exponential distribution of mean
value 1 We choose the mark functions f 12m  m and f 22  1 ie the mark m only impacts linearly the intensity of
the process N 1
In Fig 5 are reported the estimated kernels and mark functions obtained using a realization of this 2-dimensional process
with 45 105 resp 4 105 events for component N 1
t  For the mark function estimation we supposed that f m
is piecewise constant on intervals k2 k  12 for k  0     20 One can see in the four top gures that each of the
exponential kernels are well estimated see the next section for a discussion of the error values In the last two gures we
show that one also recovers the mark functions
t resp N 2
In the estimation procedure we chose h  05 and Q  50 see Section IV for discussion on how to choose these values
In order to check our estimation and test the Hawkes model on a set of data one can perform a goodness-of-t test by simply
0 judu is an homogeneous
Poisson process In that respect the inter events times expressed in t must be exponentially distributed ie for each j if tj
denote de jumping times of N j then
noting that each point process component N jt considered as a function of a time t R t
judu
k Z tj
must be iid exponential random variables From the estimated kernels baseline intensities and mark functions one can perform
estimations of all the  j
k were estimated
k s In Fig 6 are displayed the Q-Q plots of the empirical quantiles distribution  1
k and  2
10 8 6 4 2
log2 t
Fig 8 Non parametric estimation of the 1-dimensional Hawkes model with a power-law decreasing kernel The estimation is based on a realization with
around 105 events We used h  05 and Q  50 Left panel Estimated  and theoretical solid line kernels in linear scale Right panel Estimated 
and theoretical solid line kernels in log-log scale
004
Fig 9 Non parametric estimation of a Hawkes model with inhibitory effets The kernel of the model solid line is negative a rst interval and positive
over another one If in Eq 2 the probability that t  0 is negligible the estimation method provides reliable results 
from the last 3 103 intervent times of each components versus the exponential quantiles One can check in both case that
both curves are very close to the expected diagonal
A three dimensional example with circular interactions
In this example we aim at illustrating two features rst one can faithfully estimate Hawkes kernels that are not necessarily
decreasing localized around t  0 One can also in a multidimensional Hawkes process disentangle in the complex dynamics
of the events occurrence the causality in the sense of Granger causality relationship between these events For that purpose we
consider a 3-dimensional Hawkes process with circular interactions ie the process N 1t is excited only by the processes
N 2t itself excited by the process N 3t which events are triggered by the events of N 1t Thus in the Hawkes matrix only
the terms 12t 23t and 31t are non zero We choose the shape of these kernels to be triangular functions with different
positions In Fig 7 we report the results of the estimation of such process on a sample where each process has around 105
events we can see that one remarkably recovers both the causality relationship between the 3 processes and the triangular
shapes of the interaction kernels
Kernel with heavy tail
In Fig 8 is reported the estimation of a 1D Hawkes model with the power-law decreasing kernel t    t with
    01 and   3
2  Unlike the previous examples this kernel has an algebraic decay for large t One can see in both
panels of Fig 8 corresponding to linear and log-log representation that for a sample of 105 events our estimation is very
close to the expected kernel on a wide range to time scales Let us notice that in order to estimate a kernel that is slowly
decaying over a support extending over several decades the regular sampling schemes of gt and t is not suited since it
would involve an exponentially large matrix to invert For that purpose in ref 32 we propose a variant of the method of
section III that relies on a different ie logarithmic time sampling and that allows one to estimate g when it varies over a
time interval of several orders of magnitude
Kernel with non-positive values
The last example we provide concerns a 1D Hawkes process that involves a kernel with negative values Indeed according the
remark II-A one can consider Hawkes processes with inhibitory impact of past events instead of exciting when the kernel
t takes some negative values In that situation if in Eq 4 the events corresponding to  R t  udNu  0 occur
with a negligible probability the model remains linear and one can expect our estimation method to be still reliable This
is illustrated in Fig 9 where the estimation is performed using a sample of 105 events of a 1D Hawkes model with the
kernel represented by the solid line this kernel is either piecewise constant or piecewise linear and is negative on a whole
interval before becoming positive According to this model the occurrence of some event begins by decreasing the probability
of occurrence of further events while after some time lag this event has an opposite impact and increases the process activity
By comparing estimated and real kernel values one can see that even in that case the method of section III provides provides
a fairly good estimation of the kernel shape
VI LINK WITH OTHER APPROACHES
In the academic literature there are very few non parametric estimators of the kernel matrix of a Hawkes process In the
particular case the kernel matrix is known to be symmetric which is always true if the dimension D  1 the method
developed in 21 uses a spectral method for inverting 10 and deduces an estimation from the second-order statistics It can
be seen as a particularly elegant way of solving the Wiener-Hopf equation when the kernel is symmetric and in that respect
it is very similar to our approach though not at all as general of course
Apart from this method there are essentially two other approaches for non parametric estimation
The rst one initiated by 10 corresponds to a non parametric EM estimation algorithm It is based on regularization via
L2 penalization of the method initially introduced by 18 in the framework of ETAS model for seismology see Section VII-B
for ETAS model It has been developed for 1-dimensional Hawkes process The maximum likelihood estimator is computed
using an EM algorithm 
 The E step basically corresponds to computing for all n and m the probability pnm that the nth jump tn has been
initiated 3 by the mth jump tm where tm  tn knowing an approximation of the kernel t and of 
 And the M step corresponds to estimating t and  knowing all the pnm
In 10 some numerical experiments on particular cases are performed successfully even when the exogenous intensity 
depends slowly on time  the whole function t is estimated along with the kernel t with a very good approximation
However as emphasized in 10 the convergence speed of the EM algorithm drastically decreases when the decay of the
kernel t is getting slower eg power-law decaying kernel Equivalently it also drastically decreases when one increases
the average number of events that occur on an interval of the same size order as the one of the support of t keeping
constant the overall number of events J ie shortening the overall realization time T  This can be performed for instance
by simply increasing the baseline  keeping constant J
This result is illustrated in Fig 10 where we have compared for a xed estimation precision the computation time TEM of
the EM method without any regularization and the computation time TW H of our approach based on solving the Wiener-Hopf
equation All our tests are using a simple 1d Hawkes process with an exponential kernel In a rst experiment we compared
the ratio of the convergence times TEM TW H as a function of the overall number of events J in the sample As illustrated
by the curve represented by symbols  in Fig 10 we observed that up to a logarithmic behavior the computation times of
both methods are comparable In a second experiment solid line curve in Fig 10 we xed the total number of jumps J and
let the number of events over the support of the kernel t vary by simply changing the baseline intensity  In that case
one clearly observes that as  increases the EM approach becomes slower as compared to our method
3Here we refer to the branching structure of the Hawkes process
A second important drawback of the EM approach is illustrated in the gure 11 where we have tested the EM algorithm on
the example of Fig 9 where the Hawkes process involves a kernel with negative values While our method is able to handle
inhibitory situations provided the inhibitory effect does not leads to negative intensities the probabilistic interpretation of the
kernel values involved in the EM method prevent any such possibility One can see in Fig 11 the EM method only allows
one to estimate the positive part of t
log2 R
Fig 10
Comparison of Wiener-Hopf and EM complexity The ratio of the computation time of EM and Wiener-Hopf methods is plotted as a function of
log2R in the case of a 1d Hawkes model with exponential kernel For the lower curve symbol  all the parameters are xed and R represents simply the
ratio of the number of events JJ0 where J0  103 and J varies from J0 to 27J0 On can see that in that case up to an eventual logarithmic correction
both methods provide a comparable estimation time For the upper curve solid line the number of events is xed to J  105 events while R represents a
normalized average number of events over the support of the kernel t More precisely  R is the ratio 0 where the baseline rate  varies from   0
to   270 One can see that the convergence time of the EM method strongly increases as  becomes larger
004
Fig 11 Comparison of Wiener-Hopf and EM estimation of the Hawkes model with inhibitory effect of gure 9 Both methods have been tested on the
sample sample of size J  105 events One can see that while our method provides a good estimation of the negative part of the kernel  the EM based
method is only able to estimate its positive part N
In a recent series of papers 19 20 some authors proposed within a rigourous statistical framework a second approach
for non-parametric estimation It relies on the minimization of the so-called L2 contrast function Given a realization of a
Hawkes process Nt associated with the parameters  t  on an interval 0 T  the estimation is based on minimizing
the contrast function C  
   argmin

C 
C    DXi1Z T
t d N i
t 2dt  2Z T
DXj1Z t
t   i 
ijt  sd N j
Let us point out that minimizing the expectancy of the contrast function is equivalent to minimizing the L2 error on the
intensity process Indeed if Ft is the information available up to time t since Ed N i
tdt one has
t Ft  i

EC   argmin

 argmin

DXi1cid16Ei 2  Ei icid17
Ecid16i   i2cid17 
The minimum zero is of course uniquely reached for    and    Since i
t is expressed linearly in terms of i and of
the ijj minimizing the L2 error is equivalent to solving a linear equation which is nothing but the Wiener Hopf equation
18 Consequently minimizing the expectancy of the contrast function is equivalent to solving the Wiener-Hopf equation
In 20 the authors chose to decompose  on a nite dimensional-space in practice the space of the constant piece-wise
functions and to solve directly the minimization problem 50 in that space For that purpose in order to regularize the solution
they are essentially working with some applications in mind for which only a small amount of data is available and for which
the kernels are known to be well localized they chose to penalize the minimization with a Lasso term which is well known
to induce sparsity in the kernels ie the L1 norm of the components of  Let us point out that minimizing the contrast
function and minimizing the expectancy of the contrast function are two different stories The contrast function is stochastic
and nothing guarantees that the associated linear equation is not ill-conditioned In 20 the authors prove that in the case
i the component of  are picked up from an orthogonal family of functions and
ii any two components of  are always either equal or orthogonal one to each other
then the linear equation is invertible ie the associated random Gram matrix is almost surely positive denite In applications
they study real signals from neurobiology 9 they choose the components of  to be piece-wise constant and give a lot of
examples of the resulting estimations
In the present work our approach is quite different and is motivated for modeling large amount of data eg earthquakes
nancial time-series which are well known to involve very regular non localized kernels We directly solve the linear equation
ie the Wiener-Hopf system In that case we also introduce a regularization component by the mean of the choice of the
quadrature method Using a Gaussian quadrature with Q points for instance amounts in considering that the kernel term in
the Wiener-Hopf equation is polynomial of order Q Let us point out that though we proved that the Wiener-Hopf equation is
invertible we do not have any result on the invertibility of the stochastic version of the Wiener-Hopf equation in which the
conditional expectations are replaced by empirical averages As we will see in the next Sections in all our applications and
simulations it does not seem to be a problem This is clearly due to the fact that we always consider that a large amount of
data is available eg nancial high frequency time-series earthquake time-series It seems that if a very small amount of
data is available both approaches described above should be more appropriate than our approach For our approach to work
we would certainly need to add a regularization term for inverting the discrete linear system This will be addressed in a future
A Application to nancial time-series
VII EXAMPLES OF APPLICATION
Because of their natural ability to account for self and mutual excitation dynamics of specic events Hawkes processes
have sparked an increasing interest in high frequency nance 1 68 21 22 33 In this section we consider as
a rst application a 1-dimensional Hawkes model for market order arrivals The trading rate in nancial markets has non
trivial statistical features and is one the key factors that determines volatility We use intraday data of most liquid maturity
of EuroStoxx FSXE and EuroBund FGBL future contracts Our data correspond to all trades at best bidask during 1000
trading days covering the period from may 2009 to september 2013 The number of events market orders per day is close to
5 104 for FSXE and 4 104 for FGBL It is well known that market activity is not stationary and is characterized by a U-like
Eurostoxx
EuroBund
log10ts
log10ts
Fig 12 Non parametric estimation of a 1-dimensional Hawkes model of market order arrivals for Eurostoxx FSXE and EuroBund FGBL Left Estimated
kernel t for FSXE blue and FGBL green data in log-log representation Right Estimated kernel t for FSXE using over varying time spans and
time resolutions in log-log scale In both gures the slope is close to   1
shape In order to circumvent this difculty one can perform an estimation at a xed time period within the day However
as emphasized in 1 it appears that the kernel shape is constant for each period the non-stationarity of the trade arrival
rate can be associated with a varying baseline intensity  and that estimating this kernel on each of these small periods and
averaging on all the so-obtained estimations lead to the same estimation This is why we did not consider the problem of
intraday non-stationarity and performed the estimation over a whole trading day In left Figure 12 we have reported the kernels
of trades associated with FSXE and FGBL as estimated using the method described in section V-A without considering any
mark The curves are displayed in log-log representation since both kernels are obviously very close to a power-law They
are well tted by
t  t
with   1 and   005 In right Figure 12 we have reported the same estimation for FSXE market orders but with 4
different values of the sampling parameter h we chose h  0005 005 05 2 seconds in order to cover a wide range of
times t One sees that all curves consistently fall on the analytical expression 53 This gure where a scaling behavior of
t can be observed over a range of 5 decades is very similar to the estimation performed by Bouchaud et al on the SP
500 mini 224 Let us notice that origin of the power-law nature of Hawkes kernels for market data is a challenging question
already raised in ref 1 21 It is also remarkable that the shape of the kernel appears to be almost constant for different
markets Let us nally point out that in order to have   1 expression 53 must be truncated at both small and large
time scales This point is discussed in Refs 21 22 However it is important to notice that the expression 53 has to be
integrated over 9 decades in order to reach   1 ie if the minimum time resolution is 0001 s even after one month
the integral of  is still smaller than 1
B Application to earthquake time-series
Various point processes models have been proposed in order to reproduce the dynamics of seismic events earthquakes in
some given geographic region see eg 4 34 for a review Among theses models the Epidemic Type Aftershock Sequence
ETAS proposed by Ogata 35 is one of the most popular This model accounts for the triggering of future events aftershocks
by former earthquakes simply by assuming that the shocks dynamics corresponds to a Hawkes process marked by the events
magnitude More precisely the one dimensional version of this model 5 is dened as follows  is the baseline intensity the
kernel t is
t 
1  tcp
while the mark function the productivity law has an exponential like form
f m  Aem 
4It is noteworthy that these authors found values of  and  that are consistent with the previous reported values
5There exists a space-time version of the ETAS model that accounts for both the time and the location of earthquakes
Fig 13
Earthquake Catalog As expected an exponential shape of the form 56 with M0  2 and a  1 ts well the empirical data
log10 N M  as a function of M where N M  is the number of events of magnitude m  M as estimated from data of the Northern California
Notice that the probability distribution of earthquake magnitudes is given by the famous Gutenberg-Richer law according to
which the probability that an earthquake magnitude m is greater than M large enough ie greater than a given threshold
M0 reads
P robm  M   10abM  M  M0
4 3 2 1 0
Fig 14 Non paramatric estimation of a 1-dimensional marked Hawkes model of earthquake data from NCEC
In Fig 13 we have displayed log10 N M  as a function of M where N M  is the number of events of magnitude m  M
as estimated from data of the Northern California Earthquake Catalog 23 NCEC This catalog contains events of magnitude
m  0 in the region of Northern California from january 1990 to october 2013 The total number of events is around 5 105
One can check that the Guttenberg-Richter law 56 provides a good t of the data Notice that despite the large number of
studies devoted to ETAS model application to earthquake data see eg 4 34 to our knowledge only ref 18 performed
a non parametric estimate within the general class of linear self-exciting point processes As previously mentioned see section
VI these authors obtained an estimation of the kernel shape t by applying an Expected Maximization iterative method
A precise comparison of the EM-based method to the one presented in this study is out of the scope of this paper Let us
just mention that the authors in 18 mainly found using data from southern California Catalog a value of the exponent p
that weakly depends on the magnitude threshold but stays in the range p  06 08 while the reported value of  in the
productivity law 55 is   07 In Fig 14 are reported the results of the non-parametric estimation of t and f m from
NCEC data One sees that the obtained estimates for both f m and t are consistent with ETAS model in particular one
nds that the kernel t is well tted by the shape 54 with p  07 and c  1 mn while the law 55 is well veried over
the whole range of magnitudes with   075 It is noteworthy that the values we obtain are relatively close to the estimates
performed in 18
VIII CONCLUSION AND PROSPECTS
In this paper we have discussed some issues related to Hawkes processes an important class of point processes that account
for the self and mutual excitation between classes of events We have notably shown that this family of processes are fully
characterized by their conditional density function or equivalently by its jumps self-correlation matrix which is related to the
kernel matrix  through a system of Wiener-Hopf equations A numerical inversion of this system by the means of Gaussian
quadratures provides an efcient method for non-parametric estimation of Hawkes multivariate models A simple variant of
this method allows one to also recover the mark functions for marked Hawkes processes For Holder  kernels the estimation
error is shown to converge as J 121 where J is the number of events provided one chooses a number of quadrature
points large enough The two examples from nance and geophysics we considered illustrate the reliability of the approach and
allow one to conrm the slowly decaying nature of trading activity impact on future activity and to recover the specications
of the Ogata ETAS model for earthquakes
As far as the prospects are concerned we intend to perform a systematic comparison of our method performances to former
methods based on the minimization of a cost function It also remains to base our error analysis on more solid mathematical
and statistical foundations We can also improve the method by regularity constraints in the case a very small amount of data
is available The estimation of the mark functions also raises interesting problems for example one could test within the
framework of this paper whether the kernels are separable ie t m  tf m or not
As we mentioned in the introduction since they naturally and simply capture a causal structure of event dynamics associated
with contagion cross and self activation phenomena Hawkes processes are promised for many applications In that respect we
hope that the method proposed in this paper will enter in the toolbox of standard techniques used for empirical applications of
point processes Besides an improvement of the applications to nance eg by accounting for order book events price events
or exogenous events and geophysics eg by accounting for the space dependence of earthquake mutual excitations we plan
to consider other elds where Hawkes processes are pertinent like social networks information diffusion internet activity or
neural networks
ACKNOWLEDGMENTS
The authors thank Francois Alouges Stephane Gaiffas Marc Hoffmann Patricia Reynaud-Bouret Mathieu Rosenbaum and
Vincent Rivoirard for useful discussions We gratefully acknowledge nancial support of the chair Financial Risks of the Risk
Foundation of the chair Mutating Markets of the French Federation of Banks and of the chair QuantValleyRisk Foundation
Quantitative Management Initiative
The nancial data used in this paper have been provided by the company QuantHouse EUROPEASIA httpwwwquanthousecom
We also aknowledge the Northern California Earthquake Data Center NCEDC Northern California Seismic Network US
Geological Survey Menlo Park Berkeley Seismological Laboratory University of California Berkeley
PROOF OF THE UNICITY OF THE SOLUTION OF THE SYSTEM 18 IN t
APPENDIX A
Let us show that we can use a standard Wiener-Hopf factorization argument to prove that equation 18 admits a unique
solution matrix t which components are L1 causal functions For that purpose let us suppose that t is another causal
solution and let us consider the matrix
t  t  t 
We want to prove that t is equal to 0 for all t
Let us set
Bt  t    gt 
Since both t and t satisfy 18 one has
Bt  0 t  0
consequently Bt is in L1 and anti-causal In the Laplace domain 57 writes
Bz  z I  gz
Thanks to 14 and 11 one has
and consequently
Bz  zcid16I  zcid17 cid16I  T zcid17 1
 zcid16I  zcid17 cid16I  T zcid171
Bzcid16I  T zcid17  zcid16I  zcid17 
On the one hand since the matrices t and t are causal and in L1 the left hand side of this last equation is analytic in
the left half-plane z z  0 On the other hand since the the matrices Bt and t the Laplace transform of t
is z are in L1 and anti-causal the right hand side of this last equation is analytic in the right half-plane z z  0
Since both sides are equal they actually are analytic on the whole complex plane ie their elements are entire functions
Let us x 0    1 and i j  1 D We choose z  C such that z  r  R Then for any causal function f t  L1
one has
f z Z 
f tetrdt  Z r
f tetrdt Z 
f tetrdt Z r
f tdt  er1
f 1 
r
Since both t and t are causal and in L1 the analytic function of 58 goes to 0 when z   By Liouville
theorem we conclude that it is zero everywhere and consequently t R t  0 This ends the proof of the uniqueness of
the solution of 18 
For a x t  0 one has from denition 21
APPENDIX B
PROOF OF PROPOSITION 3
Gij t xdtdx  Ei
tdt  dN j
0  1 j
0  x x  dx  idtdx
Using 20 we get
Gij t xdx  i  idx 
DXk1Z ikt  sEf ikk
k1R dsikt  s thus
Then using 3 one gets i  i  kPD
Gijt xdx 
DXk1Z ikt  scid16Ef ikk
Splitting the integral in 3 parts  s  0 s  0 and s  0 we get
s dN k
s  dN j
0  1 j
0  x x  dx
s dN k
s  dN j
0  1 j
0  x x  dx  kdsdxcid17 
Gij t x  ij tf ij x  At x  At
At xdx 
DXk1Zs0
iktscid16EdN k
DXk1Zs0
At 
s  dN j
0  1 j
0  x x  dx  kdsdxcid17 
ikt  scid16Ef ikk
s dN k
s  dN j
DXk1Zs0
0  1  kdscid17 
iktsGkj s xdx 63
Since for s  0
Ef ikk
s dN k
s  dN j
Consequently
We nally get
Gij t x  ij tf ijx 
This proves proposition 3
At 
DXk1Zs0
P robk
P robk
s  1 dN j
s  z dN k
P robdN j
s  1 dN j
s  z dN k
0  1  Z dzf ikz
 Z dzf ikz
j Z dzf ikzpkzEdN j
j Z dzf ikzpkzcid0Gjks z  jcid1 
ikt  s Z dzf ikzpkzGjks z
j Zs0
0  k
s  z dN k
ikt  sGkj s x 
j Zs0
ikt  s Z dzf ikzpkzGjks z
The proof of proposition 5 follows a path that is very classical in the study of density kernel estimations or regressions
APPENDIX C
PROOF OF PROPOSITION 5
First the variance of gt can be bounded
V argt 
Using the stationarity of the increments of Nt
V argt 
2
R2h2 E  RXk1Z tmax
Rh2 E Z tmax
uKcid18 u  t
uK  u  tj
1  t
1k  t
ukK  u  tj
2 
0  1Kcid18 u  t
Rh2 E cid18Z tmax
Rh2Zu0tmaxZv0tmax
h cid19cid192
h cid19 Kcid18 v  t
h cid19 
Straightforward computations see 21 for examples show that EdN i
0  1 can be decomposed in the sum
ij uu  v  bu vdudv where  is the Dirac distribution and bu v is a polynomial in ij taken at different points
Let us consider that all the ij ts are bounded by a constant  Then if F t is a matrix function with positive elements
one can easily check that each element of the matrix   F t are bounded by 1F  where 1 is the matrix whose
elements are all equal to 1 and F  the matrix made of the L1 norm of the elements of F t Then applying this result to
F t P
k0 kt and t    F t shows that
each element of t is bounded by    1I  1  C
1  
where C is a constant and  the spectral radius of I   Consequently since H is supposed to hold ie   1 when
h is small the dominant term in 70 is of the form
Rh2Zu0tmaxZv0tmax
ij uu  vKcid18 u  t
h cid19 Kcid18 v  t
h cid19 
Rh2Zu0tmax
h cid192
Kcid18 u  t
which is of order 1h Thus for h small enough there exists a constant C1 such that
V argt 
1k  t
ukK  u  tj
0  0Kcid18 u  t
0  0Kcid18 u  t
  gijt  i
h cid19  gijt  i
h cid19  gijt  i
tuhdN j
0  0Ku  gijt  i
EdN i
tuhdN j
0  0  EdN i
t dN j
0  0duKu
gij t  uh  gijtKudu
For the bias the computation is also standard 
bt  Egt  gijt  i 
E Z tmax
hZ tmax
hZ tmax
 Z tmax
 Z tmax
 Z tmax
If follows that if the density of EdN i
t dN j
0  0 is Holder  and if the kernel K is of order l     for all small
  0 6 ie l is the largest integer smaller than    then there exists a constant C2 such that
bt  C2h
The proposition directly results from Eqs 72 and 79
REFERENCES
1 E Bacry and J Muzy Hawkes model for price and trades high-frequency dynamics ArXiv e-prints 2013
2 A Hawkes Spectra of some self-exciting and mutually exciting point processes Biometrika vol 58 pp 8390 April 1971
3  Point spectra of some mutually exciting point processes Journal of the Royal Statistical Society Series B Methodological vol 33-3 pp
438443 April 1971
4 Y Ogata Seismicity analysis through point-process modeling A review Pure and Applied Geophysics vol 155 no 2-4 pp 471507 Aug 1999
Online Available httpwwwspringerlinkcomcontentwqg0lxg6bmumaxmq
5 A Helmstetter and D Sornette Subcritical and supercritical regimes in epidemic models of earthquake aftershocks Journal of geophysical research
vol 107 no B10 p 2237 2002
6 L Bauwens and N Hautsch Modelling nancial high frequency data using point processes ser In T Mikosch J-P Kreiss R A Davis and T G
Andersen editors Handbook of Financial Time Series Springer Berlin Heidelberg 2009
7 P Hewlett Clustering of order arrivals price impact and trade path optimisation in Workshop on Financial Modeling with Jump processes Ecole
Polytechnique 2006
8 E Bacry S Delattre M Hoffmann and J F Muzy Modelling microstructure noise with mutually exciting point processes Quantitative Finance
vol 13 pp 6577 2013
9 P Reynaud-Bouret V Rivoirard F Grammont and C Tuleau-Malot Goodness-of-t tests and nonparametric adaptive estimation for spike train
analysis Hal e-print 00789127 To appear in Journal of Mathematical Neuroscience
10 E Lewis and G Mohler A nonparametric em algorithm for multiscale hawkes processes Preprint 2010
11 G Mohler M Short P Brantingham F Schoenberg and G E Tita Self-exciting point process modeling of crime Journal of the American Statistical
Association vol 106 pp 100108 2011
12 R Crane and D Sornette Robust dynamic classes revealed by measuring the response function of a social system Proceedings of the National
Academy of Sciences vol 105 no 41 pp 15 64915 653 2008 Online Available httpwwwpnasorgcontent1054115649abstract
13 S Yang and H Zha Mixture of mutually exciting processes for viral diffusion Proceedings of the 30th International Conf on Machine Learning
vol 28 2013
14 M S Bartlett The spectral analysis of point processes Journal of the Royal Statistical Society Series B Methodological vol 25 no 2 pp
1963 Royal Statistical Society Online Available
264296 Jan 1963 ArticleType research-article  Full publication date 1963  Copyright
httpwwwjstororgstable2984295
15  The spectral analysis of Two-Dimensional point processes Biometrika vol 51 no 34 pp 299311 Dec 1964 ArticleType research-article 
Full publication date Dec 1964  Copyright 1964 Biometrika Trust Online Available httpwwwjstororgstable2334136
16 T Ozaki Maximum likelihood estimation of hawkes self-exciting point processes Annals of the Institute of Statistical Mathematics vol 31 no 1
pp 145155 Dec 1979 Online Available httpwwwspringerlinkcomcontenthr3q7667x3522235
17 Y Ogata and H Akaike On linear intensity models for mixed doubly stochastic poisson and self- exciting point processes Journal of the Royal
Statistical Society Series B Methodological vol 44 no 1 pp 102107 Jan 1982 ArticleType research-article  Full publication date 1982 
Copyright 1982 Royal Statistical Society Online Available httpwwwjstororgstable2984715
18 D Marsan and O Lengline Extending earthquakes reach through cascading Science vol 319 p 1076 2008
19 P Reynaud-Bouret and S Schbath Adaptive estimation for hawkes processes application to genome analysis Ann Statist vol 38 pp 27812822
20 N Hansen P Reynaud-Bouret and V Rivoirard Lasso and probabilistic inequalities for multivariate point-processes Arxi e-prints 12080570 To
appear in Bernoulli
21 E Bacry K Dayri and J Muzy Non-parametric kernel estimation for symmetric hawkes processes application to high frequency nancial data
Eur Phys J B vol 85 no 5 p 157 2012 Online Available httpdxdoiorg101140epjbe2012-21005-8
22 S J Hardiman N Bercot and J-P Bouchaud Critical reexivity in nancial markets a Hawkes process analysis European Physical Journal B
vol 86 p 442 2013
23 Data freely available at wwwncedcorg
6The use of  here is just to take car of the case the ij s are Holder n with n being an integer
24 P Bremaud and L Massoulie Stability of nonlinear hawkes processes Annals of Probability vol 24 no 3 pp 15631588 1996
25 N Wiener and E Hopf ueber eine klasse singulrer integralgleichungen Sem-Ber Preuss Akad Wiss vol 31 pp 696706 1931
26 I Gokhberg and M Krein Systems of integral equations on the half-line with kernels depending on the difference of the arguments Uspekhi Mat
Nauk vol 13 pp 372 1958
27 B Noble Methods based on the Wiener-Hopf technique for the solution of partial differential equations Pergamon 1958
28 K Atkinson A Survey of Numerical Methods for the Solution of Fredholm Integral Equations of the Second Kind Society for Industrial and Applied
Mathematics 1976
29 E Nystrom uber die praktische ausung von integralgleichungen mit anwendungen auf randwertaufgaben Acta Mathematica vol 54 pp 185204
30 E Parzen on estimation of a probability density function and mode Annals of Mathematical Statistics vol 33 1962
31 Y Ogata On lewis simulation method for point processes Ieee Transactions On Information Theory vol 27 pp 2331 January 1981
32 E Bacry T Jaisson and J Muzy  Estimation of slowly decreasing Hawkes kernels Application to high frequency order book modelling ArXiv
e-prints 2014
33 P Embrechts T Liniger and L Lu Multivariate hawkes processes an application to nancial data To appear in Journal of Applied Probability 2011
34 J Zhuang D Harte M Werner S Hainzl and Z S Basic models of seismicity temporal models Community Online Resource for Statistical
Seismicity Analysis Available at httpwwwcorssaorg 2012
35 Y Ogata Statistical models for earthquake occurrences and residual analysis for point processes Journal of the American Statistical Association
vol 83 pp 927 1988
