Thymic selection of T-cell receptors as an extreme value problem
Andrej Kosmrlj1 Arup K Chakraborty2 Mehran Kardar1 and Eugene I Shakhnovich3
1Department of Physics Massachusetts Institute of Technology Cambridge MA 02139 USA
2Departments of Chemical Engineering Chemistry and Biological Engineering
Massachusetts Institute of Technology Cambridge MA 02139 USA
3Department of Chemistry and Chemical Biology
Harvard University Cambridge MA 02138 USA
Dated July 12 2009
T lymphocytes T cells orchestrate adaptive immune responses upon activation T cell activation
requires suciently strong binding of T cell receptors TCRs on their surface to short peptides p
derived from foreign proteins which are bound to major histocompatibility MHC gene products
displayed on antigen presenting cells A diverse and self-tolerant T cell repertoire is selected
in the thymus We map thymic selection processes to an extreme value problem and provide an
analytic expression for the amino acid compositions of selected TCRs which enable its recognition
functions
PACS numbers 8710-e 0250-r8719xw 8714ep 8714ef
The adaptive immune system clears pathogens from
infected hosts with the aid of T lymphocytes T cells
Foreign antigenic and self-proteins are processed into
short peptides p inside antigen-presenting cells APC
bound to MHC proteins and presented on the surface of
APCs Each T-cell receptor TCR has a conserved re-
gion participating in the signaling functions and a highly
variable segment responsible for antigen recognition Be-
cause variable regions are generated by stochastic rear-
rangement of the relevant genes most T cells express
a distinct TCR The diversity of the T cell repertoire
enables the immune system to recognize many dierent
antigenic short pMHC complexes Peptides presented
on MHC class I are typically 811 amino acids long 1
which is enough to cover all possible self-peptides the
human proteome consists of P  107 amino-acids 2 3
as well as many antigenic peptides TCR recognition
of pMHC is both specic and degenerate It is specic
because most mutations to the recognized peptide amino
acids abrogate recognition 4 5 It is degenerate because
a given TCR can recognize several antigenic peptides 6
The gene rearrangement process ensuring the diversity
of TCR is random It may thus result in T cells poten-
tially harmful to the host because they bind strongly
to self peptide-MHC complexes or useless T cells which
bind too weakly to MHC to recognize antigenic pep-
tides Such aberrant TCRs are eliminated in the thy-
mus 7 8 9 10 where immature T cells thymocytes
are exposed to a large set 103  104 of self-pMHC Thy-
mocytes expressing a TCR that binds with high anity
to any self-pMHC molecule are deleted in the thymus
a process called negative selection However a thy-
mocytes TCR must also bind suciently strongly to at
least one self pMHC complex to receive survival signals
and emerge from the thymus a process called positive
selection
Signaling events gene transcription programs and
cell migration during T cell development in the thymus
7 8 9 10 11 12 13 14 15 16 have been studied exten-
sively Despite many important advances how interac-
tions with self-pMHC complexes in the thymus shape the
peptide-binding properties of selected TCR amino acid
sequences such that mature T cells exhibit their special
properties is poorly understood To address this issue
in Ref 17 we numerically studied a simple model where
TCRs and pMHC were represented by strings of amino
acids Fig 1 These strings indicate the amino-acids on
the interface between TCRs and pMHC complexes and
it is assumed that each site on a TCR interacts only with
a corresponding site on pMHC The binding interface of
TCR is actually composed of a region that is in contact
with the MHC molecule and a segment that is in con-
tact with the peptide It is the latter part that is highly
variable while the former is more conserved We shall
therefore explicitly consider only the former amino-acids
but not the latter Similarly there are many possible
peptides that can bind to MHC and their sequences are
considered explicitly whereas those of the MHC are not
there are only a few types of MHC in each individual
human 1 We could in principal add a few sites to the
TCR and pMHC strings to account for any variability in
the segments not considered
Simplied representations of amino-acids eg as a
string of numbers or bits were employed earlier 15 16
18 in the context of TCR-pMHC interactions mainly
to report that negative selection reduces TCR cross-
reactivity In Ref 17 we numerically studied the model
in Fig 1 and described below to qualitatively describe
the role of positive and negative selection on the amino-
acid composition of selected TCRs By randomly gen-
erating TCR and pMHC sequences and implementing
thymic selection in silico we showed that selected TCRs
are enriched in weakly interacting amino acids and ex-
plained how this leads to specic yet cross-reactive TCR
T cell
AP E L F N T P D I
V D V C L P F E R G
peptide
FIG 1 Schematic representation of the interface between
TCR and pMHC complexes The segment of TCR that is
in contact with peptides is highly variable and modeled by a
string of N amino-acids The peptide is also modeled by a
sequence of length N  and the binding energy is computed as
a sum of pairwise interactions We dont explicitly consider
TCR sites in contact with MHC as they are more or less
conserved and only assign them a net interaction energy Ec
recognition of antigen a long-standing puzzle
In this
paper we show that the model can be solved exactly in
the limit of long TCRpeptide sequences The result-
ing analytic expression for the amino-acid composition
of selected TCRs is surprisingly accurate even for short
peptides and provides a theoretical basis for previous nu-
merical results Furthermore we are able to obtain a
phase diagram that indicates the ranges of parameters
where negative or positive selection are dominant lead-
ing to quite dierent bias in selectionfunction
To assess the eects of thymic selection as well as anti-
gen recognition we evaluate the free energy of interaction
between TCR-pMHC pairs for brevity free energy will
be referred to as energy The interaction energy is com-
posed of two parts a TCR interaction with MHC and a
TCR interaction with the peptide The former is given a
value Ec which may be varied to describe dierent TCRs
and MHCs The latter is obtained by aligning the TCR
and pMHC amino-acids that are treated explicitly and
adding the pairwise interactions between corresponding
pairs For a given TCR-pMHC pair this gives
Eintcid0t scid1  Ec 
Jti si
where Jti si is the contribution from the ith amino
acids of the TCR ti and the peptide si and N is the
length of the variable TCRpeptide region The matrix J
encodes the interaction energies between specic pairs of
amino-acids For numerical implementations we use the
Miyazawa-Jernigan MJ matrix 19 that was developed
in the context of protein folding
Immature T cells interact with a set S of M self-pMHC
complexes where typically M is of the order of 103  104
To mimic thymic selection sequences that bind to any
self-pMHC too strongly Eint  En are deleted nega-
tive selection However a thymocytes TCR must also
bind suciently strongly Eint  Ep to at least one
self-pMHC to receive survival signals and emerge from
the thymus positive selection A thymocyte expressing
TCR with string t will thus be selected if the strongest in-
teraction with self-pMHC is between thresholds for neg-
ative and positive selection ie
En  min
sScid8Eintcid0t scid1cid9  Ep
Recent experiments 11 show that the dierence between
thresholds for positive and negative selection is relatively
small a few kBT 
Equation 2 casts thymic selection as an extreme value
problem 20 enabling us to calculate the probability
Pselt  that a TCR sequence t will be selected in the
thymus Let us indicate by xt  the probability den-
sity function PDF of the interaction energy between the
TCR t and a random peptide The PDF xt  of the
strongest minimum of the M independent random in-
teraction energies is then obtained by multiplying  with
the probability of all remaining M 1 energy values be-
 where P E  xt  is
the cumulative probability and noting the multiplicity
M for which energy is the lowest The probability that
TCR t is selected is then obtained by integrating xt 
over the allowed range as
ing larger cid01  Pcid0E  xtcid1cid1M 1
Pselcid0tcid1  Z Ep
cid0xtcid1  M cid0xtcid1cid01  Pcid0E  xtcid1cid1M 1
cid0xtcid1 dx with
For M  1 this extreme value distribution EVD con-
verges to one of three possible forms 20 depending on
the tail of the PDF for each entry Equation 1 indicates
that in our case as each energy is the sum of N contribu-
tions xt  should be a Gaussian for large N  in which
case the relevant EVD is the Gumbel distribution 20
To obtain an explicit form for xt  we model the
set S of self-peptides as M strings in which each amino-
acid is chosen independently The probability fa for
selecting amino-acid a at each site is taken to be the
frequency of this amino-acid in the self-proteome For
a specic TCR sequence t the average interaction en-
ergy with self peptides follows from Eq 1 as Eavt  
i1 Eti with Eti  Jti aa where we
have denoted the average over self amino-acid frequen-
a1 faGa Similarly the variance
i1 Vti where
a For large N  we can
approximate xt  with a Gaussian PDF with the above
mean and variance From standard results for the Gum-
bel distribution 20 we conclude that in the limit of
M  1 the peak of the distribution xt  is located at
Ec  PN
cies by Gaa  P20
of the interaction energy is V t   PN
Vti  cid2Jti a2cid3a  Jti a2
E0cid0tcid1  Eavcid0tcid1 q2Vcid0tcid1 ln M 
and its width is 0t   q2V t 12 ln M  Since the
PDF xt  originates from a bounded set of energies
it is strictly not Gaussian in the tails Hence once the
extreme values begin to probe the tail of the distribu-
tion the above results will no longer be valid Indeed in
the limit when M  O20N  the EVD will approach a
delta-function centered at the M independent value cor-
responding to the optimal binding energy
In the limit of long TCRpeptides N  1 we can
exactly calculate the statistics of the amino-acid com-
position of selected TCRs To obtain a proper thermo-
dynamic limit we need to set Ec Ep En  N  and
ln M  N  The latter ensures that the peak of the dis-
tribution E0t  is proportional to N  and also results
in a width 0t  which is independent of N  The re-
lation ln M  N can be justied with the expectation
that M should grow proportionately to the proteome size
P  while N  ln P to enable encoding the proteome In
this large N limit the EVD is suciently narrow that the
value of the optimal energy can be precisely equated with
the peak E0t  and Eq 2 for the selection condition
can be replaced with
En  Ec 
Eti vuut2 ln M
Vti  Ep 
Thus for each sequence t we have to evaluate the Hamil-
tonian E0t  and the sequence is accepted if this energy
falls in the interval En Ep This is somewhat similar
to the micro-canonical ensemble in Statistical Physics
with the restriction of the energy to an interval rather
than a narrow range only a minor elaboration see be-
low From the equivalence of canonical and micro-
canonical ensembles for large N  we know that the proba-
bility for a sequence is governed by the Boltzmann weight
pt   cid16QN
i1 fticid17 expE0t  Here fa indicate the
natural frequencies of the dierent amino-acids prior to
selection while the eect of thymic selection is captured
in the parameter  which is determined by solving for
the average energy
The appearance of p2 ln M Pi Vti in the Hamilto-
nian initially appears as a complication that makes exact
computation of the average energy from expE0t 
impossible However this apparent coupling is easily
dealt with by standard methods such as Legendre trans-
forms or Hamiltonian minimization 21 This can be
justied easily as follows We need to solve a Hamilto-
nian HU V which depends on two extensive quanti-
i1 Vti The corre-
sponding partition function can be decomposed as Z 
ties U  PN
PUV U V eHUV  but can be approximated with
i1 Eti and V  PN
its largest term Note that the same density of states
U V   eSUV kB appears irrespective of the specic
form of HU V  In particular the choice H0  Ec U 
i1EtiVtiln M2
V ln M2  Ec PN
corresponds to a set of non-interacting variables with
pt  
fti expcid20  cid0Eti  Vticid1cid21
for which thermodynamic quantities such as entropy
are easily computed By judicious choice of  we can
then ensure that the same average energy appears for
H0t  and our E0t  Using Legendre transforms which
is equivalent to minimizing H0t  with respect to 
one nds that the required E0t  is obtained by setting
  qln M2N hVi where h   i refers to the
average with the non-interacting weight eU V 
Finally the value of  has to be determined by con-
straining the average energy determined above to the
range in Eq 5 while maximizing entropy Given the
bounded set of energies the inverse temperature  can be
either negative or positive The 20N possible values for
E0t  span a range from Emin to Emax and a correspond-
ing number of states which is a bell-shape between these
extremes with a maximum at some Emid If Emid  Ep
In this case
  0 positive selection is dominant and stronger amino-
acids are selected If Emid  En we must set  such that
we must set  such that cid10E0t cid11  Ep
cid10E0t cid11  En   0 negative selection is dominant and
weaker amino-acids are selected For En  Emid  Ep
we must set   0 and there is no modication due to
selection
Figure 2 depicts the variation of  as a function of
lnM N and threshold for negative selection En with
Ep  EnN  05kBT  Consider TCRs that do not
bind too strongly or weakly to MHC as such TCRs are
WEAK AA
STRONG AA
En  EcN
FIG 2 Color Color representation of the dependence of the
inverse temperature  on the number of self-peptides ln MN
and the threshold for negative selection energy EnN with
Ep  EnN  05kB T in the limit of large N  The region
between the black lines corresponds to   0 to the right
left of which negative positive selection is dominant and
weak strong amino-acids are selected Note that as Ep 
EnN goes to zero the intermediate region disappears The
dotted lines indicate the relevant parameter values for thymic
selection in mouse see text that result in   037kB T 1
simulation
EVD in large N limit
L F I V M W C Y A H T P G R Q S N E D K
captured by the parameter  which was not elucidated
from the limited numerical data Furthermore the phase
diagram in Fig 2 indicates how upon raising the num-
ber of self-peptides there is a transition from preference
for strong amino-acids   0 positive selection dom-
inant to weak amino-acids   0 negative selection
dominant which may be feasibly tested in future exper-
iments along the lines in Ref 4
This work was supported by National Institutes of
Health NIH Grant 1-PO1-AI071195-01 and a NIH Di-
rectors Pioneer award to AKC
FIG 3 Amino-acid composition of selected TCR sequences
ordered in increasing frequency along the abscissa The data
points in black are obtained numerically with the parameters
relevant to mouse see caption of Fig 2 and text The error
bars reect the sample size used to generate the histograms
and dierences for dierent realizations of M self-peptides
The dashed line is the result of the EVD analysis in the large
N limit from Eq 7 and the agreement is quite good In both
cases we have used the Miyazawa-Jernigan matrix J 19 and
amino acid frequencies fa from the mouse proteome 3 17
unlikely to be selected eg En  Ec  21kBT  For
the set of parameters that are relevant for thymic selec-
tion in mouse 17 ie N  5 Ep  En  25kBT and
M  103 we nd   037kBT 1 which means that
negative selection is dominant and weaker amino-acids
are selected Also   083kBT 1 indicating a pref-
erence for amino-acids with smaller variations in bind-
ing energy With these parameters we can calculate the
amino-acid frequencies of selected TCRs as
f sel
fa expcid2  cid0Ea  Vacid1cid3
b1 fb expcid2  cid0Eb  Vbcid1cid3
It is important to ask if the above expression exact in
the limit of N   has any relevance to the actual
TCRpeptides with N  5  10 We thus numerically
simulated the case of N  5 by generating a random
set of 106 TCR sequences and selected them against
M  103 self-peptides The selected TCRs were used to
construct the amino-acid frequencies depicted in Fig 3
The dashed line in this gure comes from Eq 7 with
the same J and fa The agreement between the two is
remarkable given the small value of N  5 and may be
indicative of small corrections to the N   result
Equation 7 thus provides an analytical expression
that captures the characteristics of TCR amino-acids se-
lected against many peptides in the thymus In accord
with previous numerical results 17 and some available
data from normal mouse and human it predicts since
  0 that TCR sequences are enriched in weakly inter-
acting amino-acids small E This result was used pre-
viously 17 to explain their specicity However Eq 7
further indicates the role of promiscuity of amino-acids
1 J Kuby T J Kindt B A Osborne and R A Goldsby
Immunology W H Freeman 2006 6th ed
2 N J Burroughs R J de Boer and C Kesmir Immuno-
genetics 56 311 2004
3 P Flicek B L Aken K Beal B Ballester M Caccamo
Y Chen L Clarke G Coates F Cunningham T Cutts
et al Nucleic Acids Research 36 D707 2008
4 E S Huseby F Crawford J White P Marrack and
J W Kappler Nat Immunol 7 1191 2006
5 E S Huseby J White F Crawford T Vass D Becker
C Pinilla P Marrack and J W Kappler Cell 122 247
2005
6 E R Unanue Annu Rev Immunol 2 395 1984
7 H von Boehmer I Aifantis F Gounari O Azogui
L Haughn I Apostolou E Jaeckel F Grassi and
L Klein Immunol Rev 191 62 2003
8 G Werlen B Hausmann D Naeher and E Palmer
Science 299 1859 2003
9 O M Siggs L E Makaro and A Liston Curr Opin
Immunol 18 175 2006
10 K A Hogquist T A Baldwin and S C Jameson Nat
Rev Immunol 5 772 2005
11 M A Daniels E Teixeiro J Gill B Hausmann
D Roubaty K Holmberg G Werlen G A Hollander
N R J Gascoigne and E Palmer Nature 444 724
2006
12 P Bousso N R Bhakta R S Lewis and E Robey
Science 296 1876 2002
13 J A M Borghans A J Noest and R J de Boer Eur
J Immunol 33 3353 2003
14 A Scherer A Noest and R J de Boer Proc R Soc
London Ser B 271 609 2004
15 V Detours R Mehr and A S Perelson J Theor Biol
200 389 1999
16 V Detours and A S Perelson Proc Natl Acad Sci
USA 96 5153 1999
17 A Kosmrlj A K Jha E S Huseby M Kardar and
A K Chakraborty Proc Natl Acad Sci USA 105
16671 2008
18 D L Chao M P Davenport S Forrest and A S Perel-
son Eur J Immunol 35 3452 2005
19 S Miyazawa and R L Jernigan J Mol Biol 256 623
1996
20 M R Leadbetter G Lindgren and H Rootzen Ex-
tremes and related properties of random sequences and
processes Springer-Verlag 1983
21 M Kardar Phys Rev Lett 51 523 1983
